{"version":3,"file":"js/527.8053fb3b.js","mappings":"kUAImyB,MAAMA,EAAEC,WAAAA,GAAcC,KAAKC,aAAa,KAAKD,KAAKE,kBAAkB,KAAKF,KAAKG,kBAAkBC,UAAU,MAAMC,cAAcC,GAAGN,KAAKC,aAAaM,QAAQC,EAAAA,EAAAA,IAAER,KAAKS,gBAAgB,GAAGT,KAAKU,aAAaC,SAASX,KAAKY,wBAAwB,CAACC,iBAAiBb,KAAKE,kBAAkBY,WAAWd,KAAKC,aAAac,YAAYD,WAAWE,KAAKC,GAAGA,EAAEC,OAAOC,OAAOF,UAAUG,EAAAA,EAAAA,IAAEb,IAAGc,EAAAA,EAAAA,IAAEJ,GAAG,MAAMK,GAAEC,EAAAA,EAAAA,IAAEhB,EAAE,CAACiB,aAAaxB,KAAKC,aAAauB,aAAaC,MAAK,EAAGpB,cAAcC,IAAI,KAAIoB,EAAAA,EAAAA,IAAE1B,KAAKC,aAAa0B,iBAAiBC,EAAAA,IAAG,IAAI,MAAMP,KAAKC,EAAE,MAAMD,EAAEQ,WAAWR,EAAEQ,UAASC,EAAAA,EAAAA,KAAEC,EAAAA,EAAAA,KAAEC,EAAAA,EAAAA,IAAEX,EAAEQ,SAAS7B,KAAKC,aAAauB,cAAa,GAAG,GAAII,EAAAA,GAAE5B,KAAKC,aAAa0B,oBAAoB,IAAIM,EAAE,EAAE,IAAI,MAAMZ,KAAKC,EAAE,CAAC,MAAML,EAAE,CAAC,GAAEiB,EAAAA,EAAAA,IAAElC,KAAKmC,aAAalB,EAAEI,EAAEe,YAAW,GAAIf,EAAEe,WAAWnB,EAAE,MAAMI,EAAEe,WAAW9B,KAAKe,EAAEgB,SAAShB,EAAEe,WAAW9B,GAAG2B,IAAI,CAAC,OAAOX,CAAC,CAAC,CAACgB,OAAAA,GAAUtC,KAAKC,cAAcqC,UAAUtC,KAAKC,aAAa,IAAI,CAAC,UAAMsC,CAAKtB,EAAEX,GAAG,MAAMkC,cAAcjC,EAAEkC,uBAAuBnB,EAAEK,iBAAiBD,EAAEgB,OAAOd,EAAEJ,aAAaM,EAAEa,YAAYX,EAAE3B,cAAc0B,EAAElB,iBAAiB+B,GAAG3B,EAAEjB,KAAKU,aAAasB,EAAEhC,KAAKE,kBAAkB0C,EAAE5C,KAAKS,eAAeF,EAAEP,KAAKY,wBAAwBU,EAAEtB,KAAKmC,aAAa,IAAIU,EAAAA,EAAEjB,SAAS5B,KAAK8C,iBAAiBpB,IAAGL,EAAAA,EAAAA,IAAEf,GAAGN,KAAKC,aAAa,IAAI8C,EAAAA,EAAE,CAACL,OAAOd,EAAEJ,aAAaM,EAAEkB,MAAK,EAAGvB,MAAK,EAAGpB,cAAc0B,EAAEJ,iBAAiBD,EAAEuB,SAAS,KAAKC,aAAa,IAAIjB,EAAAA,EAAE,CAACT,aAAaM,EAAEkB,MAAK,EAAGvB,MAAK,MAAO,MAAML,QAAQpB,KAAKG,kBAAkBG,EAAEa,QAAQ,OAAOnB,KAAKC,aAAaiD,aAAaC,QAAQ/B,GAAG,CAACgC,cAAcpD,KAAKC,aAAaoD,0BAA0BC,WAAW,CAAC,gBAAMC,GAAa,MAAM,IAAIjD,EAAAA,EAAE,mCAAmC,4CAA4C,CAAC,mBAAMkD,CAAcvC,EAAE,CAAC,EAAEX,EAAE,CAAC,GAAG,aAAaN,KAAKyD,wBAAwBzD,KAAKC,aAAayD,aAAazC,EAAEX,EAAEa,OAAO,CAAC,uBAAMwC,CAAkB1C,EAAE,CAAC,EAAEX,EAAE,CAAC,GAAG,aAAaN,KAAKyD,wBAAwBzD,KAAKC,aAAa2D,qBAAqB3C,EAAEX,EAAEa,OAAO,CAAC,oBAAM0C,CAAe5C,EAAE,CAAC,EAAEX,EAAE,CAAC,GAAG,aAAaN,KAAKyD,wBAAwBzD,KAAKC,aAAa6D,mBAAmB7C,EAAEX,EAAEa,OAAO,CAAC,iBAAM4C,CAAY9C,EAAE,CAAC,EAAEX,EAAE,CAAC,GAAG,aAAaN,KAAKyD,wBAAwBzD,KAAKC,aAAa+D,sBAAsB/C,EAAEX,EAAEa,OAAO,CAAC,mBAAM8C,CAAchD,EAAEX,EAAE,CAAC,GAAG,aAAaN,KAAKyD,wBAAwBzD,KAAKC,aAAaiE,wBAAwBjD,EAAEX,EAAEa,OAAO,CAAC,aAAMgD,CAAQ9C,GAAG,OAAOrB,KAAKE,kBAAkBmB,EAAErB,KAAKoE,eAAeC,QAAQrE,KAAKoE,eAAcnD,EAAAA,EAAAA,IAAEjB,KAAKG,mBAAmBH,KAAKoE,cAAcE,QAAQC,MAAMtD,IAAIjB,KAAKC,aAAaiD,aAAasB,QAAQvD,GAAGjB,KAAKC,aAAaiD,aAAaC,QAAQlC,EAAE,IAAIA,IAAIjB,KAAKC,aAAaiD,aAAasB,SAAQlD,EAAAA,EAAAA,IAAEL,IAAIV,EAAAA,EAAEkE,UAAU,4BAA4BC,MAAM,IAAIpE,EAAAA,EAAE,6BAA6B,kDAAkD,CAACoE,MAAMzD,IAAI,UAAUjB,KAAKyD,wBAAwB,CAACL,cAAcpD,KAAKC,aAAaoD,0BAA0BC,WAAW,CAAC,2BAAMG,GAAwB,GAAGzD,KAAKoE,gBAAgBpE,KAAKoE,cAAcO,SAAS,CAAC,UAAU3E,KAAKoE,cAAcE,OAAO,CAAC,MAAM,CAAC,OAAOtE,KAAKyD,uBAAuB,CAAC,CAAC,sBAAMX,CAAiB7B,GAAG,UAAU2B,EAAAA,EAAAA,IAAEhB,EAAAA,GAAEX,EAAE,CAAC,MAAM,MAAM,IAAIX,EAAAA,EAAE,yBAAyB,2BAA2B,CAACqB,iBAAiBV,GAAG,CAAC,E,2PCA/jH,MAAMa,EAAE/B,WAAAA,GAAcC,KAAK4E,KAAK,KAAK5E,KAAK6E,YAAY,IAAI,EAAE,MAAMzD,EAAErB,WAAAA,CAAYkB,GAAGjB,KAAK0E,MAAM,IAAI5C,EAAE9B,KAAK8E,SAAS,KAAK9E,KAAKqC,SAAS,KAAKrC,KAAK+E,SAAQ,EAAG/E,KAAKgF,SAAS,KAAKhF,KAAK0E,MAAMG,YAAY5D,CAAC,EAAE,SAASe,EAAEf,GAAG,OAAO,IAAIG,EAAEH,EAAE,CAAC,MAAMK,EAAEvB,WAAAA,CAAYkB,GAAGjB,KAAK8E,SAAS,KAAK9E,KAAK+E,SAAQ,EAAG/E,KAAKqC,SAASrC,KAAKgF,SAAS/D,CAAC,EAAE,SAAS8B,EAAE9B,GAAG,OAAO,IAAIK,EAAEL,EAAE,CAAC,MAAM4B,EAAE,IAAIoC,IAAI,SAASnF,EAAEmB,EAAES,EAAEnB,EAAEc,GAAE,EAAGS,GAAGe,EAAE2B,QAAQ,IAAI,MAAMpD,KAAKb,EAAE,CAAC,MAAMe,EAAEL,EAAEiE,IAAI9D,GAAG,IAAIE,EAAE,SAAS,MAAMyB,EAAExC,EAAEa,GAAGtB,EAAEyB,EAAED,EAAEyB,GAAG,GAAGjD,IAAIiD,GAAGjB,GAAGA,EAAEqD,KAAK,CAACjE,KAAK,qBAAqBkE,QAAQ,wDAAwDC,QAAQ,CAACC,MAAMhE,EAAEiE,cAAcxC,EAAEyC,eAAe1F,KAAK+C,EAAE4C,IAAInE,EAAEJ,MAAMI,IAAID,GAAGC,EAAEoE,UAAU,CAAC,MAAMzE,GAAEX,EAAAA,EAAAA,IAAEgB,EAAExB,GAAG,GAAGmB,EAAE,OAAOe,GAAEJ,EAAAA,EAAAA,IAAEX,EAAEK,EAAExB,IAAI4B,EAAEJ,EAAEJ,MAAMpB,CAAC,CAAC,CAAC,IAAI,MAAMQ,KAAKW,GAAG0E,gBAAgB,GAAG,IAAI9C,EAAE+C,IAAItF,EAAEY,MAAM,OAAOc,EAAE,2BAA2B1B,EAAEY,SAAS,OAAO,IAAI,CAAC,SAASK,EAAEN,EAAEX,GAAG,IAAIsB,EAAEtB,EAAE,MAAM,iBAAiBA,IAAGoB,EAAAA,EAAAA,IAAET,GAAGW,EAAEiE,WAAWvF,GAAG,MAAMA,IAAGC,EAAAA,EAAAA,IAAEU,IAAI,iBAAiBX,IAAIsB,EAAEkE,OAAOxF,KAAIe,EAAAA,EAAAA,IAAEO,EAAE,CAAC,IAAIK,EAAE,SAASF,EAAEzB,EAAEsB,GAAG,IAAItB,KAAIW,EAAAA,EAAAA,IAAEW,GAAG,OAAOtB,EAAE,GAAG,UAAUA,GAAG,UAAUA,EAAE,CAAC,GAAG,MAAM2B,EAAE,MAAM,IAAI8D,UAAU,8BAA8B,OAAO9D,EAAE+D,SAASpE,EAAEtB,EAAE,CAAC,OAAOA,CAAC,CAACF,eAAe8B,IAAI,OAAO,MAAMD,IAAIA,QAAQ,iCAAsDA,CAAC,CAAC7B,eAAewC,EAAEtC,EAAEsB,KAAIX,EAAAA,EAAAA,IAAEX,IAAI,wBAAwBsB,GAAG,yBAAyBA,SAASM,GAAG,C","sources":["webpack://sun-glare-project/./node_modules/@geoscene/core/layers/graphics/sources/WFSSourceWorker.js","webpack://sun-glare-project/./node_modules/@geoscene/core/layers/graphics/sources/support/sourceUtils.js"],"sourcesContent":["/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport{createTask as e}from\"../../../core/asyncUtils.js\";import t from\"../../../core/Error.js\";import r from\"../../../core/Logger.js\";import{throwIfAborted as s,isAbortError as a}from\"../../../core/promiseUtils.js\";import{equals as i,WGS84 as n}from\"../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as o,convertToGeometry as u}from\"../featureConversionUtils.js\";import p from\"../data/FeatureStore.js\";import{project as h,checkProjectionSupport as y}from\"../data/projectionSupport.js\";import{QueryEngine as c}from\"../data/QueryEngine.js\";import{validateGeoJSON as l,createOptimizedFeatures as m}from\"./geojson/geojson.js\";import{mixAttributes as g}from\"./support/sourceUtils.js\";import{getFeature as _}from\"../../ogc/wfsUtils.js\";import f from\"../../support/FieldsIndex.js\";class d{constructor(){this._queryEngine=null,this._customParameters=null,this._snapshotFeatures=async e=>{const{objectIdField:t}=this._queryEngine,r=await _(this._getFeatureUrl??\"\",this._featureType.typeName,this._getFeatureOutputFormat,{customParameters:this._customParameters,dateFields:this._queryEngine.fieldsIndex.dateFields.map((e=>e.name)),signal:e});await l(r),s(e);const a=m(r,{geometryType:this._queryEngine.geometryType,hasZ:!1,objectIdField:t});if(!i(this._queryEngine.spatialReference,n))for(const s of a)null!=s.geometry&&(s.geometry=o(h(u(s.geometry,this._queryEngine.geometryType,!1,!1),n,this._queryEngine.spatialReference)));let p=1;for(const s of a){const e={};g(this._fieldsIndex,e,s.attributes,!0),s.attributes=e,null==s.attributes[t]&&(s.objectId=s.attributes[t]=p++)}return a}}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}async load(e,t){const{getFeatureUrl:r,getFeatureOutputFormat:a,spatialReference:i,fields:n,geometryType:o,featureType:u,objectIdField:h,customParameters:y}=e;this._featureType=u,this._customParameters=y,this._getFeatureUrl=r,this._getFeatureOutputFormat=a,this._fieldsIndex=new f(n),await this._checkProjection(i),s(t),this._queryEngine=new c({fields:n,geometryType:o,hasM:!1,hasZ:!1,objectIdField:h,spatialReference:i,timeInfo:null,featureStore:new p({geometryType:o,hasM:!1,hasZ:!1})});const l=await this._snapshotFeatures(t.signal);return this._queryEngine.featureStore.addMany(l),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new t(\"wfs-source:editing-not-supported\",\"applyEdits() is not supported on WFSLayer\")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(s){return this._customParameters=s,this._snapshotTask?.abort(),this._snapshotTask=e(this._snapshotFeatures),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(e=>{this._queryEngine.featureStore.clear(),a(e)||r.getLogger(\"geoscene.layers.WFSLayer\").error(new t(\"wfs-layer:getfeature-error\",\"An error occurred during the GetFeature request\",{error:e}))})),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _checkProjection(e){try{await y(n,e)}catch{throw new t(\"unsupported-projection\",\"Projection not supported\",{spatialReference:e})}}}export{d as default};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport{isValid as e}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{validateFieldValue as t,validationErrorToString as n,isNumericField as i,isStringField as r,sanitizeNullFieldValue as s}from\"../../../support/fieldUtils.js\";class o{constructor(){this.code=null,this.description=null}}class l{constructor(e){this.error=new o,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e}}function u(e){return new l(e)}class a{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}function c(e){return new a(e)}const f=new Set;function d(e,i,r,s=!1,o){f.clear();for(const l in r){const a=e.get(l);if(!a)continue;const c=r[l],d=m(a,c);if(d!==c&&o&&o.push({name:\"invalid-value-type\",message:\"attribute value was converted to match the field type\",details:{field:a,originalValue:c,sanitizedValue:d}}),f.add(a.name),a&&(s||a.editable)){const e=t(a,d);if(e)return u(n(e,a,d));i[a.name]=d}}for(const t of e?.requiredFields??[])if(!f.has(t.name))return u(`missing required field \"${t.name}\"`);return null}function m(e,t){let n=t;return\"string\"==typeof t&&i(e)?n=parseFloat(t):null!=t&&r(e)&&\"string\"!=typeof t&&(n=String(t)),s(n)}let p;function h(t,n){if(!t||!e(n))return t;if(\"rings\"in t||\"paths\"in t){if(null==p)throw new TypeError(\"geometry engine not loaded\");return p.simplify(n,t)}return t}async function g(){return null==p&&(p=await import(\"../../../../geometry/geometryEngineJSON.js\")),p}async function y(t,n){!e(t)||\"esriGeometryPolygon\"!==n&&\"esriGeometryPolyline\"!==n||await g()}export{u as createFeatureEditErrorResult,c as createFeatureEditSuccessResult,y as loadGeometryEngineForSimplify,d as mixAttributes,h as simplify};"],"names":["d","constructor","this","_queryEngine","_customParameters","_snapshotFeatures","async","objectIdField","t","r","_","_getFeatureUrl","_featureType","typeName","_getFeatureOutputFormat","customParameters","dateFields","fieldsIndex","map","e","name","signal","l","s","a","m","geometryType","hasZ","i","spatialReference","n","geometry","o","h","u","p","g","_fieldsIndex","attributes","objectId","destroy","load","getFeatureUrl","getFeatureOutputFormat","fields","featureType","y","f","_checkProjection","c","hasM","timeInfo","featureStore","addMany","extent","fetchRecomputedExtents","fullExtent","applyEdits","queryFeatures","_waitSnapshotComplete","executeQuery","queryFeatureCount","executeQueryForCount","queryObjectIds","executeQueryForIds","queryExtent","executeQueryForExtent","querySnapping","executeQueryForSnapping","refresh","_snapshotTask","abort","promise","then","clear","getLogger","error","finished","code","description","globalId","success","uniqueId","Set","get","push","message","details","field","originalValue","sanitizedValue","add","editable","requiredFields","has","parseFloat","String","TypeError","simplify"],"sourceRoot":""}