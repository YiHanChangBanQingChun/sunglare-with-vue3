"use strict";(self["webpackChunksun_glare_project"]=self["webpackChunksun_glare_project"]||[]).push([[8512],{37510:function(e,t,r){r.d(t,{Q:function(){return a}});var n=r(31763);async function a(e,t){const r=await(0,n.V)(e,t);r.layers=r.layers.filter(o);const a={serviceJSON:r};if((r.currentVersion??0)<10.5)return a;const l=await(0,n.V)(e+"/layers",t);return a.layersJSON={layers:l.layers.filter(o),tables:l.tables},a}function o(e){return!e.type||"Feature Layer"===e.type}},39664:function(e,t,r){r.d(t,{m:function(){return l},v:function(){return o}});var n=r(4244),a=r(67681);function o(e){return{origin:"portal-item",url:(0,n.An)(e.itemUrl),portal:e.portal||a.A.getDefault(),portalItem:e,readResourcePaths:[]}}function l(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?(0,n.An)(e.itemUrl):null,portal:e.portal||a.A.getDefault(),portalItem:e}}},18512:function(e,t,r){r.d(t,{WZ:function(){return S},XH:function(){return A},bO:function(){return L},load:function(){return f},z8:function(){return O}});r(44114),r(14603),r(47566),r(98721);var n=r(47966),a=r(71680),o=r(75122),l=r(37510),i=r(67681),u=r(66476),s=r(39664),c=r(58131),y=r(86103),p=r(31763);async function f(e,t){const r=e.instance.portalItem;if(r&&r.id)return await r.load(t),d(e),m(e,t)}function d(e){const t=e.instance.portalItem;if(!t?.type||!e.supportedTypes.includes(t.type))throw new n.A("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:t?.type,expectedType:e.supportedTypes.join(", ")})}async function m(e,t){const r=e.instance,n=r.portalItem;if(!n)return;const{url:a,title:o}=n,l=(0,s.v)(n);if("group"===r.type)return r.read({title:o},l),b(r,e);a&&r.read({url:a},l);const i=await I(e,t);return i&&r.read(i,l),r.resourceReferences={portalItem:n,paths:l.readResourcePaths??[]},"subtype-group"!==r.type&&r.read({title:o},l),(0,y.L)(r,l)}async function b(e,t){let r;const{portalItem:a}=e;if(!a)return;const o=a.type,l=t.layerModuleTypeMap,i=(0,c.Y)(a,"Oriented Imagery Layer")??!1;switch(o){case"Feature Service":r=i?l.OrientedImageryLayer:l.FeatureLayer;break;case"Stream Service":r=l.StreamLayer;break;case"Scene Service":r=l.SceneLayer;break;case"Feature Collection":r=l.FeatureLayer;break;default:throw new n.A("portal:unsupported-item-type-as-group",`The item type '${o}' is not supported as a 'IGroupLayer'`)}let[u,s]=await Promise.all([r(),I(t)]),y=()=>u;if("Feature Service"===o){if(s=a.url?await L(s,a.url):{},O(s).length){const e=l.SubtypeGroupLayer,t=await e();y=e=>"SubtypeGroupLayer"===e.layerType?t:u}return w(e,y,s,await P(a.url))}return A(s)>0?w(e,y,s):g(e,y)}async function g(e,t){const{portalItem:r}=e;if(!r?.url)return;const n=await(0,p.V)(r.url);n&&w(e,t,{layers:n.layers?.map(h),tables:n.tables?.map(h)})}function h(e){return{id:e.id,name:e.name}}function w(e,t,r,n){let a=r.layers||[];const o=r.tables||[];if("Feature Collection"===e.portalItem?.type&&(a.forEach((e=>{"Table"===e?.layerDefinition?.type&&o.push(e)})),a=a.filter((e=>"Table"!==e?.layerDefinition?.type))),"coverage"in r){const t=F(r);t&&e.add(t)}a.reverse().forEach((a=>{const o=n?.(a);if(o||!n){const n=v(e,t(a),r,a,o);e.add(n)}})),o.reverse().forEach((a=>{const o=n?.(a);if(o||!n){const n=v(e,t(a),r,a,o);e.tables.add(n)}}))}function v(e,t,r,n,a){const o=e.portalItem,l=new t({portalItem:o.clone(),layerId:n.id});if("sourceJSON"in l&&(l.sourceJSON=a),"subtype-group"!==l.type&&(l.sublayerTitleMode="service-name"),"Feature Collection"===o.type){const e={origin:"portal-item",portal:o.portal||i.A.getDefault()};l.read(n,e);const t=r.showLegend;null!=t&&l.read({showLegend:t},e)}return l}async function I(e,t){if(!1===e.supportsData)return;const r=e.instance,n=r.portalItem;if(!n)return;let a=null;try{a=await n.fetchData("json",t)}catch(o){}if(k(r)){let e=null,t=!0;if(a&&A(a)>0){if(null==r.layerId){const e=O(a);r.layerId="subtype-group"===r.type?e?.[0]:S(a)}e=T(a,r),e&&(1===A(a)&&(t=!1),null!=a.showLegend&&(e.showLegend=a.showLegend))}return t&&"sublayerTitleMode"in r&&"service-name"!==r.sublayerTitleMode&&(r.sublayerTitleMode="item-title-and-service-name"),e}return a}async function L(e,t){if(null==e?.layers||null==e?.tables){const r=await(0,p.V)(t);(e=e||{}).layers=e.layers||r?.layers,e.tables=e.tables||r?.tables}return e}function S(e){const t=e.layers;if(t&&t.length)return t[0].id;const r=e.tables;return r&&r.length?r[0].id:null}function T(e,t){const{layerId:r}=t,n=e.layers?.find((e=>e.id===r))||e.tables?.find((e=>e.id===r));return n&&D(n,t)?n:null}function A(e){return(e?.layers?.length??0)+(e?.tables?.length??0)}function k(e){return"stream"!==e.type&&"oriented-imagery"!==e.type&&"layerId"in e}function F(e){const{coverage:t}=e;if(!t)return null;const r=new URL(t);if(t.toLowerCase().includes("item.html")){const e=r.searchParams.get("id"),t=r.origin;return a.A.fromPortalItem({portalItem:new u["default"]({id:e,url:t})})}if((0,o.Fi)(t))return a.A.fromGeoSceneServerUrl({url:t});throw new n.A("portal:oriented-imagery-layer-coverage","the provided coverage url couldn't be loaded as a layer")}function O(e){const t=[];return e?.layers?.forEach((e=>{"SubtypeGroupLayer"===e.layerType&&t.push(e.id)})),t}function D(e,t){return!("feature"===t.type&&"layerType"in e&&"SubtypeGroupLayer"===e.layerType||"subtype-group"===t.type&&!("layerType"in e))}async function P(e){const{layersJSON:t}=await(0,l.Q)(e);if(!t)return null;const r=[...t.layers,...t.tables];return e=>r.find((t=>t.id===e.id))}},31763:function(e,t,r){r.d(t,{V:function(){return a}});var n=r(86039);async function a(e,t){const{data:r}=await(0,n["default"])(e,{responseType:"json",query:{f:"json",...t?.customParameters,token:t?.apiKey}});return r}}}]);
//# sourceMappingURL=8512.4f857192.js.map