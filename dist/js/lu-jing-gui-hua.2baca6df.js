"use strict";(self["webpackChunksun_glare_project"]=self["webpackChunksun_glare_project"]||[]).push([[2854],{25856:function(e,t,a){a.r(t),a.d(t,{default:function(){return U}});var s=a(56768),i=a(45130),n=a(24232),l=a(34739),r=a(1592),o=a(9239),d=a(74963);const c={class:"lu-jing-gui-hua"},u={class:"search-containers"},h={class:"revert-containers"},m={class:"swap-action"},p=["src"],g={class:"search-container start"},w={class:"search-box-img"},y={key:0,class:"search-results",ref:"searchResultsStart"},k=["onClick"],v={class:"search-container end"},b={class:"search-box-img"},L={key:0,class:"search-results",ref:"searchResultsEnd"},f=["onClick"],S=["src"],C={key:0,class:"maploader-overlay"},x={class:"main-container"},E={class:"choose-time"},R={class:"form-group"},D=["min","max"];function B(e,t,B,_,N,I){return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",c,[(0,s.Lk)("div",u,[(0,s.Lk)("div",h,[t[12]||(t[12]=(0,s.Lk)("div",{class:"car"},[(0,s.Lk)("img",{src:l})],-1)),(0,s.Lk)("div",m,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...t)=>e.swap&&e.swap(...t)),title:"切换起终点"},[(0,s.Lk)("img",{src:a(23497),alt:"",class:"revert"},null,8,p)])])]),(0,s.Lk)("div",g,[t[14]||(t[14]=(0,s.Lk)("div",{class:"search-icon-wrapper"},[(0,s.Lk)("img",{src:r,alt:"pink"})],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>N.searchQueryStart=e),onInput:t[2]||(t[2]=e=>I.onSearchInputChange(e,!0)),placeholder:"请输入起点",class:"search-box search-box-start"},null,544),[[i.Jo,N.searchQueryStart]]),(0,s.Lk)("span",w,[(0,s.Lk)("div",{class:"delete",title:"清空",onClick:t[3]||(t[3]=(...e)=>I.clc1&&I.clc1(...e))},t[13]||(t[13]=[(0,s.Lk)("img",{src:o,alt:"delete1"},null,-1)]))]),N.searchResults.length&&N.searchQueryStart?((0,s.uX)(),(0,s.CE)("div",y,[(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(N.searchResults,((e,t)=>((0,s.uX)(),(0,s.CE)("li",{key:t,class:(0,n.C4)({highlighted:t===N.highlightedIndex}),onClick:t=>I.selectResult(e,!0)},(0,n.v_)(e.name),11,k)))),128))])],512)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",v,[t[16]||(t[16]=(0,s.Lk)("div",{class:"search-icon-wrapper"},[(0,s.Lk)("img",{src:d,alt:"green"})],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>N.searchQueryEnd=e),onInput:t[5]||(t[5]=e=>I.onSearchInputChange(e,!1)),placeholder:"请输入终点",class:"search-box search-box-end"},null,544),[[i.Jo,N.searchQueryEnd]]),(0,s.Lk)("span",b,[(0,s.Lk)("div",{class:"delete",title:"清空",onClick:t[6]||(t[6]=(...e)=>I.clc2&&I.clc2(...e))},t[15]||(t[15]=[(0,s.Lk)("img",{src:o,alt:"delete1"},null,-1)]))]),N.searchResultsEnd.length&&N.searchQueryEnd?((0,s.uX)(),(0,s.CE)("div",L,[(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(N.searchResultsEnd,((e,t)=>((0,s.uX)(),(0,s.CE)("li",{key:t,class:(0,n.C4)({highlighted:t===N.highlightedIndex}),onClick:t=>I.selectResult(e,!1)},(0,n.v_)(e.name),11,f)))),128))])],512)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",{class:"search-action",onClick:t[7]||(t[7]=(...e)=>I.onSearch&&I.onSearch(...e)),title:"搜索"},[(0,s.Lk)("img",{src:a(8105),alt:"",class:"search"},null,8,S)])])]),t[20]||(t[20]=(0,s.Lk)("div",{id:"viewDiv"},null,-1)),N.ismaploading?((0,s.uX)(),(0,s.CE)("div",C,t[17]||(t[17]=[(0,s.Lk)("div",{class:"maploader"},null,-1)]))):(0,s.Q3)("",!0),(0,s.Lk)("div",x,[(0,s.Lk)("div",E,[(0,s.Lk)("div",R,[t[18]||(t[18]=(0,s.Lk)("label",{for:"date-input"},"选择日期：",-1)),(0,s.bo)((0,s.Lk)("input",{id:"date-input",type:"date","onUpdate:modelValue":t[8]||(t[8]=e=>N.selectedDate=e),min:I.minDate,max:I.maxDate,class:(0,n.C4)({"invalid-date":I.isDateDisabled(N.selectedDate)}),onChange:t[9]||(t[9]=(...e)=>I.handleDateChange&&I.handleDateChange(...e))},null,42,D),[[i.Jo,N.selectedDate]]),t[19]||(t[19]=(0,s.Lk)("label",{for:"time-input"},"选择时间：",-1)),(0,s.bo)((0,s.Lk)("input",{id:"time-input",type:"time","onUpdate:modelValue":t[10]||(t[10]=e=>I.formattedTime=e),onInput:t[11]||(t[11]=(...e)=>I.onTimeInputChange&&I.onTimeInputChange(...e)),step:"600"},null,544),[[i.Jo,I.formattedTime]])])])])],64)}a(44114),a(14603),a(47566),a(98721);var _=a(7382),N=a(43487),I=a(12790),T=a(3949),V=a(2889),Q=a(57829),A=a(95587),J=a(51197),O=a(87923),X=a(44432),$=a(50346),K={name:"RouteplanningView",data(){return{searchQueryStart:"",ismaploading:!0,searchQueryEnd:"",highlightedIndex:-1,searchResults:[],searchResultsEnd:[],selectedResultStart:null,selectedResultEnd:null,selectedDate:"",selectedTime:""}},mounted(){this.initMap(),this.selectedDate=(new Date).toISOString().substring(0,10),this.selectedTime=(new Date).toISOString().substring(11,16),this.updateTime(),setInterval((()=>{this.updateTime()}),6e4),window.addEventListener("keydown",this.handleKeydown)},beforeUnmount(){window.removeEventListener("keydown",this.handleKeydown)},computed:{minDate(){return"2024-01-01"},maxDate(){return"2024-12-31"},formattedTime(){if(!this.selectedTime)return"";const[e,t]=this.selectedTime.split(":").map(Number),a=10*Math.floor(t/10);return`${String(e).padStart(2,"0")}:${String(a).padStart(2,"0")}`}},methods:{toggleBasemapGallery(){if(this.mapView){this.basemapGalleryVisible=!this.basemapGalleryVisible;const e=this.mapView.ui.find("basemapGallery");e&&(e.container.style.display=this.basemapGalleryVisible?"block":"none")}else console.error("MapView is not initialized.")},onTimeInputChange(e){(0,J.Lk)(this,e)},isDateDisabled(e){return(0,J.zJ)(this,e)},handleDateChange(e){(0,J.d5)(this,e)},handleKeydown(e){(0,J.y9)(this,e)},updateTime(){(0,J.JA)(this)},clc1(){(0,J.YK)(this)},clc2(){(0,J.dn)(this)},initMap(){const e=new _.A({basemap:"tianditu-vector"}),t=new I.A({wkid:4326}),a=V.A.create({spatialReference:t,numLODs:32});this.createMapView(e,a)},onSearchInputChange(e,t){(0,J.eE)(this,e,t)},selectResult(e,t=!0){console.log("用户选择了搜索结果:",e);const a={name:e.name,address:e.address,wgs84_latitude:e.wgs84_latitude,wgs84_longitude:e.wgs84_longitude,location:[e.wgs84_longitude,e.wgs84_latitude],baidu_index:e.baidu_index,baidu_latitude:e.baidu_latitude,baidu_longitude:e.baidu_longitude,id:e.id,label:e.label},s=this.BasemapName;console.log("BasemapName:",s),t?(this.selectedResultStart=a,this.searchQueryStart=a.name,this.searchResults=[],this.$router.push({path:"/lu-jing-gui-hua/intermediate-page",query:{start:JSON.stringify(a),date:this.selectedDate,time:this.selectedTime,BasemapLayer:s}})):(this.selectedResultEnd=a,this.searchQueryEnd=a.name,this.searchResultsEnd=[],this.$router.push({path:"/lu-jing-gui-hua/intermediate-page",query:{end:JSON.stringify(a),date:this.selectedDate,time:this.selectedTime,BasemapLayer:s}}))},onSearch(){if(this.selectedResultStart&&this.selectedResultEnd){const e={...this.selectedResultStart,location:[this.selectedResultStart.wgs84_longitude,this.selectedResultStart.wgs84_latitude]},t={...this.selectedResultEnd,location:[this.selectedResultEnd.wgs84_longitude,this.selectedResultEnd.wgs84_latitude]};this.$router.push({path:"/lu-jing-gui-hua/result",query:{start:JSON.stringify(e),end:JSON.stringify(t),date:this.selectedDate,time:this.selectedTime}})}else alert("请确保起点和终点都已选择。")},createMapView(e,t){const a=new T["default"]({url:"https://www.geosceneonline.cn/server/rest/services/Hosted/wuhan_village/FeatureServer",title:"武汉县区面",renderer:{type:"simple",symbol:{type:"simple-fill",color:[0,0,0,0],outline:{color:[0,0,0,1],width:1}}},popupTemplate:{content:[{type:"fields",fieldInfos:[{fieldName:"县区name",label:"县区名称"}]}]}});e.add(a);const s=new N.A({map:e,center:[114.3,30.7],zoom:4,container:"viewDiv",constraints:{geometry:{type:"extent",xmin:113.6,ymin:29.9,xmax:115,ymax:31.3},minScale:500,maxScale:2e6,rotationEnabled:!1,lods:t.lods,snapToZoom:!1}});s.when((()=>{this.ismaploading=!1}));const i=new Q.A({view:s,source:{query:{title:'"Basemaps for Developers" AND owner:geoscenedev'}}});i.watch("activeBasemap",(e=>{this.handleBasemapChange(e)}));const n=new $.A({view:s}),l=new A.A({view:s}),r=new O.A({view:s,unit:"metric",style:"ruler"}),o=new X.A({view:s,unit:"metric",unitOptions:{metric:["kilometers","meters"],nonMetric:["miles","feet"]},iconClass:"esri-icon-measure-line"});s.ui.add(i,{position:"bottom-right",index:0}),s.ui.add(n,{position:"bottom-right",index:1}),s.ui.add(o,{position:"bottom-leading",index:0}),s.ui.move("zoom",{position:"bottom-left",index:1}),s.ui.add(l,{position:"bottom-left",index:2}),s.ui.add(r,{position:"bottom-left",index:3}),this.mapView=s;const d=this.mapView.map.basemap.title;console.log("BasemapName old:",d);const c={"天地图-矢量（球面墨卡托投影）":"tianditu-vector","天地图-影像（球面墨卡托投影）":"tianditu-image","天地图-地形（球面墨卡托投影）":"tianditu-topography"};return this.BasemapName=c[d]||d,console.log("BasemapName changed in rpv:",this.BasemapName),s},handleBasemapChange(e){const t={"天地图-矢量（球面墨卡托投影）":"tianditu-vector","天地图-影像（球面墨卡托投影）":"tianditu-image","天地图-地形（球面墨卡托投影）":"tianditu-topography"};t[e.title]?this.BasemapName=t[e.title]:this.BasemapName=e.title,console.log("Basemap changed:",this.BasemapName);const a=new URLSearchParams(window.location.search);a.set("BasemapLayer",this.BasemapName),window.history.replaceState({},"",`${window.location.pathname}?${a}`)},created(){const e=this.$route.query.BasemapLayer,t={"天地图-矢量（含注记）（球面墨卡托投影）":"tianditu-vector","天地图-影像（球面墨卡托投影）":"tianditu-image","天地图-地形（球面墨卡托投影）":"tianditu-topography"};e&&(t[e]?this.BasemapName=t[e]:this.BasemapName=e),console.log("BasemapLayer is",this.BasemapName)}}},M=a(71241);const j=(0,M.A)(K,[["render",B]]);var U=j}}]);
//# sourceMappingURL=lu-jing-gui-hua.2baca6df.js.map