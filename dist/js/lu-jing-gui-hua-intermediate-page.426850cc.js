"use strict";(self["webpackChunksun_glare_project"]=self["webpackChunksun_glare_project"]||[]).push([[9144],{99057:function(e,t,s){s.r(t),s.d(t,{default:function(){return Y}});var a=s(56768),i=s(45130),l=s(24232),n=s(34739),r=s(1592),d=s(9239),o=s(74963);const c={class:"lu-jing-gui-hua"},h={class:"search-containers"},u={class:"revert-containers"},m={class:"swap-action"},p=["src"],g={class:"search-container start"},w={class:"search-box-img"},y={key:0,class:"search-results",ref:"searchResultsStart"},v=["onClick"],R={class:"search-container end"},S={class:"search-box-img"},k={key:0,class:"search-results",ref:"searchResultsEnd"},E=["onClick"],L=["src"],f={key:0,class:"loader-overlay"},b={key:0,class:"maploader-overlay"},x={class:"main-container"},C={class:"choose-time"},_={class:"form-group"},T=["min","max"];function N(e,t,N,D,B,I){return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",c,[(0,a.Lk)("div",h,[(0,a.Lk)("div",u,[t[12]||(t[12]=(0,a.Lk)("div",{class:"car"},[(0,a.Lk)("img",{src:n})],-1)),(0,a.Lk)("div",m,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>I.swap&&I.swap(...e)),title:"切换起终点"},[(0,a.Lk)("img",{src:s(23497),alt:"",class:"revert"},null,8,p)])])]),(0,a.Lk)("div",g,[t[14]||(t[14]=(0,a.Lk)("div",{class:"search-icon-wrapper"},[(0,a.Lk)("img",{src:r,alt:"pink"})],-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>D.searchQueryStart=e),onInput:t[2]||(t[2]=e=>I.onSearchInputChange(e,!0)),placeholder:"请输入起点",class:"search-box search-box-start"},null,544),[[i.Jo,D.searchQueryStart]]),(0,a.Lk)("span",w,[(0,a.Lk)("div",{class:"delete",title:"清空",onClick:t[3]||(t[3]=(...e)=>I.clc1&&I.clc1(...e))},t[13]||(t[13]=[(0,a.Lk)("img",{src:d,alt:"delete1"},null,-1)]))]),B.searchResults.length&&D.searchQueryStart?((0,a.uX)(),(0,a.CE)("div",y,[(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(B.searchResults,((e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t,class:(0,l.C4)({highlighted:t===B.highlightedIndex}),onClick:t=>I.selectResult(e,!0)},(0,l.v_)(e.name),11,v)))),128))])],512)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",R,[t[16]||(t[16]=(0,a.Lk)("div",{class:"search-icon-wrapper"},[(0,a.Lk)("img",{src:o,alt:"green"})],-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>D.searchQueryEnd=e),onInput:t[5]||(t[5]=e=>I.onSearchInputChange(e,!1)),placeholder:"请输入终点",class:"search-box search-box-end"},null,544),[[i.Jo,D.searchQueryEnd]]),(0,a.Lk)("span",S,[(0,a.Lk)("div",{class:"delete",title:"清空",onClick:t[6]||(t[6]=(...e)=>I.clc2&&I.clc2(...e))},t[15]||(t[15]=[(0,a.Lk)("img",{src:d,alt:"delete1"},null,-1)]))]),B.searchResultsEnd.length&&D.searchQueryEnd?((0,a.uX)(),(0,a.CE)("div",k,[(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(B.searchResultsEnd,((e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t,class:(0,l.C4)({highlighted:t===B.highlightedIndex}),onClick:t=>I.selectResult(e,!1)},(0,l.v_)(e.name),11,E)))),128))])],512)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",{class:"search-action",onClick:t[7]||(t[7]=(...e)=>I.onSearch&&I.onSearch(...e)),title:"搜索"},[(0,a.Lk)("img",{src:s(8105),alt:"",class:"search"},null,8,L)]),B.isLoading?((0,a.uX)(),(0,a.CE)("div",f,t[17]||(t[17]=[(0,a.Lk)("div",{class:"loader"},null,-1)]))):(0,a.Q3)("",!0)])]),t[21]||(t[21]=(0,a.Lk)("div",{id:"viewDiv"},null,-1)),B.ismaploading?((0,a.uX)(),(0,a.CE)("div",b,t[18]||(t[18]=[(0,a.Lk)("div",{class:"maploader"},null,-1)]))):(0,a.Q3)("",!0),(0,a.Lk)("div",x,[(0,a.Lk)("div",C,[(0,a.Lk)("div",_,[t[19]||(t[19]=(0,a.Lk)("label",{for:"date-input"},"选择日期：",-1)),(0,a.bo)((0,a.Lk)("input",{id:"date-input",type:"date","onUpdate:modelValue":t[8]||(t[8]=e=>B.selectedDate=e),min:I.minDate,max:I.maxDate,class:(0,l.C4)({"invalid-date":I.isDateDisabled(B.selectedDate)}),onChange:t[9]||(t[9]=(...e)=>I.handleDateChange&&I.handleDateChange(...e))},null,42,T),[[i.Jo,B.selectedDate]]),t[20]||(t[20]=(0,a.Lk)("label",{for:"time-input"},"选择时间：",-1)),(0,a.bo)((0,a.Lk)("input",{id:"time-input",type:"time","onUpdate:modelValue":t[10]||(t[10]=e=>I.formattedTime=e),onInput:t[11]||(t[11]=(...e)=>I.onTimeInputChange&&I.onTimeInputChange(...e)),step:"600"},null,544),[[i.Jo,I.formattedTime]])])])])],64)}s(44114),s(14603),s(47566),s(98721);var D=s(7382),B=s(43487),I=s(11134),Q=s(74036),A=s(58423),J=s(94373),$=s(41759),j=s(90144),O=s(81387),U=s(57829),q=s(3949),K=s(95587),P=s(87923),M=s(44432),X=s(50346),z=s(51197),V={name:"IntermediatePageView",setup(){const e=(0,j.KR)(""),t=(0,j.KR)(""),s=(0,j.KR)(null),a=(0,j.KR)(null),i=(0,O.rd)();return{searchQueryStart:e,searchQueryEnd:t,selectedResultStart:s,selectedResultEnd:a,router:i}},data(){return{searchResults:[],searchResultsEnd:[],isLoading:!1,ismaploading:!0,selectedDate:"",selectedTime:"",BasemapLayer:null,highlightedIndex:-1}},mounted(){this.$route.query.start&&(this.selectedResultStart=JSON.parse(this.$route.query.start)),this.$route.query.end&&(this.selectedResultEnd=JSON.parse(this.$route.query.end)),this.parseUrlParams(),this.initMap(),setInterval((()=>{this.updateTime()}),6e4),window.addEventListener("keydown",this.handleKeydown)},beforeUnmount(){window.removeEventListener("keydown",this.handleKeydown)},computed:{minDate(){return"2024-01-01"},maxDate(){return"2024-12-31"},formattedTime(){if(!this.selectedTime)return"";const[e,t]=this.selectedTime.split(":").map(Number),s=10*Math.floor(t/10);return`${String(e).padStart(2,"0")}:${String(s).padStart(2,"0")}`}},methods:{onTimeInputChange(e){(0,z.Lk)(this,e)},isDateDisabled(e){return(0,z.zJ)(this,e)},handleDateChange(e){(0,z.d5)(this,e)},handleKeydown(e){(0,z.y9)(this,e)},updateTime(){(0,z.JA)(this)},clc1(){(0,z.YK)(this)},clc2(){(0,z.dn)(this)},parseUrlParams(){const e=new URLSearchParams(window.location.search),t=e.get("start"),s=e.get("end"),a=e.get("date"),i=e.get("time");if(t)try{const e=JSON.parse(decodeURIComponent(t));e&&e.address&&(this.searchQueryStart=e.name)}catch(l){console.error("Error parsing start parameter:",l)}if(s)try{const e=JSON.parse(decodeURIComponent(s));e&&e.address&&(this.searchQueryEnd=e.name)}catch(l){console.error("Error parsing end parameter:",l)}a&&(this.selectedDate=a),i&&(this.selectedTime=i,this.isTimeFromUrl=!0),this.created()},swap(){const e=this.searchQueryStart;this.searchQueryStart=this.searchQueryEnd,this.searchQueryEnd=e;const t=this.selectedResultStart;this.selectedResultStart=this.selectedResultEnd,this.selectedResultEnd=t,this.router.push({path:"/lu-jing-gui-hua/result",query:{start:JSON.stringify(this.selectedResultStart),end:JSON.stringify(this.selectedResultEnd),date:this.selectedDate,time:this.selectedTime,BasemapLayer:this.BasemapName}})},onSearchInputChange(e,t){(0,z.eE)(this,e,t)},selectResult(e,t=!0){const s={name:e.name,address:e.address,wgs84_latitude:e.wgs84_latitude,wgs84_longitude:e.wgs84_longitude,location:[e.wgs84_longitude,e.wgs84_latitude],baidu_index:e.baidu_index,baidu_latitude:e.baidu_latitude,baidu_longitude:e.baidu_longitude,id:e.id,label:e.label};let a=!1;const i=this.BasemapLayer;console.log("BasemapName:",i),t&&this.selectedResultStart?(a=!0,this.selectedResultStart=s,this.searchQueryStart=s.name,this.searchResults=[]):!t&&this.selectedResultEnd?(a=!0,this.selectedResultEnd=s,this.searchQueryEnd=s.name,this.searchResultsEnd=[]):t?(this.selectedResultStart=s,this.searchQueryStart=s.name,this.searchResults=[]):(this.selectedResultEnd=s,this.searchQueryEnd=s.name,this.searchResultsEnd=[]);const l=this.selectedResultStart||this.selectedResultEnd;this.selectedResultStart&&this.selectedResultEnd?this.navigateToResultPage():l&&this.navigateToIntermediatePage(t?"start":"end",s,a)},navigateToResultPage(){this.$router.push({path:"/lu-jing-gui-hua/result",query:{start:JSON.stringify({...this.selectedResultStart,location:[this.selectedResultStart.wgs84_longitude,this.selectedResultStart.wgs84_latitude]}),end:JSON.stringify({...this.selectedResultEnd,location:[this.selectedResultEnd.wgs84_longitude,this.selectedResultEnd.wgs84_latitude]}),date:this.selectedDate,time:this.selectedTime,BasemapLayer:this.BasemapName}})},navigateToIntermediatePage(e,t,s=!1){const a="/lu-jing-gui-hua/intermediate-page",i={[e]:JSON.stringify(t),date:this.selectedDate,time:this.selectedTime,BasemapLayer:this.BasemapName};s?this.$router.replace({path:a,query:i}).then((()=>{window.location.reload()})):this.$router.push({path:a,query:i})},onSearch(){if(this.selectedResultStart&&this.selectedResultEnd){this.isLoading=!0;const e={...this.selectedResultStart,location:[this.selectedResultStart.wgs84_longitude,this.selectedResultStart.wgs84_latitude]},t={...this.selectedResultEnd,location:[this.selectedResultEnd.wgs84_longitude,this.selectedResultEnd.wgs84_latitude]},s=5===this.selectedTime.length?`${this.selectedTime}:00`:this.selectedTime;console.log("Formatted Time:",s),J.A.post("http://172.30.114.151/sun-glare-project/api/route/plan",{start:e,end:t,date:this.selectedDate,time:s}).then((a=>{const i=a.data.default_id,l=a.data.time_based_id;console.log("默认路径规划结果ID:",i),console.log("基于时间的路径规划结果ID:",l),console.log("路径规划成功，时间日期是:",this.selectedDate,this.selectedTime),this.isLoading=!1,this.$router.push({path:"/lu-jing-gui-hua/route",query:{start:JSON.stringify(e),end:JSON.stringify(t),default_id:i,time_based_id:l,date:this.selectedDate,time:s,BasemapLayer:this.BasemapName}})})).catch((e=>{console.error(e),this.isLoading=!1,alert("路径规划失败，请稍后再试。")}))}else alert("请确保起点和终点都已选择。")},initMap(){const e=new D.A({basemap:this.BasemapName||"tianditu-vector"});this.map=e,this.view=new B.A({container:"viewDiv",map:e,center:[114.3,30.7],zoom:4,constraints:{geometry:{type:"extent",xmin:113.6,ymin:29.9,xmax:115,ymax:31.3},minScale:500,maxScale:2e6,rotationEnabled:!1,snapToZoom:!1}});const t=new U.A({view:this.view,source:{query:{title:'"Basemaps for Developers" AND owner:geoscenedev'}}});t.watch("activeBasemap",(e=>{this.handleBasemapChange(e)}));const s=new X.A({view:this.view}),a=new K.A({view:this.view}),i=new P.A({view:this.view,unit:"metric",style:"ruler"}),l=new M.A({view:this.view,unit:"metric",unitOptions:{metric:["kilometers","meters"],nonMetric:["miles","feet"]},iconClass:"esri-icon-measure-line"});this.view.ui.add(l,{position:"bottom-leading",index:0}),this.view.ui.add(t,{position:"bottom-right",index:0}),this.view.ui.add(s,{position:"bottom-right",index:1}),this.view.ui.move("zoom",{position:"bottom-left",index:1}),this.view.ui.add(a,{position:"bottom-left",index:2}),this.view.ui.add(i,{position:"bottom-left",index:3});const n=new A.A({title:"起点和终点"});e.add(n);const r=new q["default"]({url:"https://www.geosceneonline.cn/server/rest/services/Hosted/wuhan_village/FeatureServer",title:"武汉县区面",renderer:{type:"simple",symbol:{type:"simple-fill",color:[0,0,0,0],outline:{color:[0,0,0,1],width:1}}},popupTemplate:{content:[{type:"fields",fieldInfos:[{fieldName:"县区name",label:"县区名称"}]}]}});e.add(r),this.view.when((()=>{this.drawPoints(n),this.adjustView(),this.ismaploading=!1})).catch((e=>{console.error("MapView initialization error:",e)}))},adjustView(){if(this.selectedResultStart&&this.selectedResultEnd){const e=.01,t=new $.A({xmin:Math.min(this.selectedResultStart.location[0],this.selectedResultEnd.location[0])-10*e,ymin:Math.min(this.selectedResultStart.location[1],this.selectedResultEnd.location[1])-10*e,xmax:Math.max(this.selectedResultStart.location[0],this.selectedResultEnd.location[0])+10*e,ymax:Math.max(this.selectedResultStart.location[1],this.selectedResultEnd.location[1])+10*e});this.view.goTo(t).catch((e=>{console.error("Error adjusting view:",e)}))}else this.selectedResultStart?this.view.goTo({center:[this.selectedResultStart.location[0],this.selectedResultStart.location[1]],zoom:10}).catch((e=>{console.error("Error adjusting view:",e)})):this.selectedResultEnd&&this.view.goTo({center:[this.selectedResultEnd.location[0],this.selectedResultEnd.location[1]],zoom:10}).catch((e=>{console.error("Error adjusting view:",e)}))},drawPoints(e){if(this.selectedResultStart){const t=this.selectedResultStart,s=new Q.A({longitude:t.location[0],latitude:t.location[1]}),a=new I.A({geometry:s,symbol:{type:"simple-marker",color:"red",size:"20px"},popupTemplate:{title:"起点信息",content:[{type:"fields",fieldInfos:[{fieldName:"address",label:"地址"},{fieldName:"name",label:"名称"}]}]},attributes:t});e.add(a)}if(this.selectedResultEnd){const t=this.selectedResultEnd,s=new Q.A({longitude:t.location[0],latitude:t.location[1]}),a=new I.A({geometry:s,symbol:{type:"simple-marker",color:"green",size:"20px"},popupTemplate:{title:"终点信息",content:[{type:"fields",fieldInfos:[{fieldName:"address",label:"地址"},{fieldName:"name",label:"名称"}]}]},attributes:t});e.add(a)}},handleBasemapChange(e){const t={"天地图-矢量（球面墨卡托投影）":"tianditu-vector","天地图-影像（球面墨卡托投影）":"tianditu-image","天地图-地形（球面墨卡托投影）":"tianditu-topography"};t[e.title]?this.BasemapName=t[e.title]:this.BasemapName=e.title,console.log("Basemap changed:",this.BasemapName);const s=new URLSearchParams(window.location.search);s.set("BasemapLayer",this.BasemapName),window.history.replaceState({},"",`${window.location.pathname}?${s}`)},created(){const e=this.$route.query.BasemapLayer,t={"天地图-矢量（球面墨卡托投影）":"tianditu-vector","天地图-影像（球面墨卡托投影）":"tianditu-image","天地图-地形（球面墨卡托投影）":"tianditu-topography","天地图-矢量（含注记）（球面墨卡托投影）":"tianditu-vector"};e&&(t[e]?this.BasemapName=t[e]:this.BasemapName=e),console.log("BasemapLayer is update",this.BasemapName)}}},F=s(71241);const H=(0,F.A)(V,[["render",N]]);var Y=H}}]);
//# sourceMappingURL=lu-jing-gui-hua-intermediate-page.426850cc.js.map