{"version":3,"file":"js/5131.190230ba.js","mappings":"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","sources":["webpack://sun-glare-project/./node_modules/@geoscene/core/core/accessorSupport/originUtils.js","webpack://sun-glare-project/./node_modules/@geoscene/core/core/multiOriginJSONSupportUtils.js","webpack://sun-glare-project/./node_modules/@geoscene/core/layers/save/featureLayerUtils.js","webpack://sun-glare-project/./node_modules/@geoscene/core/layers/support/fetchService.js","webpack://sun-glare-project/./node_modules/@geoscene/core/portal/support/jsonContext.js","webpack://sun-glare-project/./node_modules/@geoscene/core/support/requestPresets.js"],"sourcesContent":["/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport{isMultiOriginJSONMixin as r}from\"../multiOriginJSONSupportUtils.js\";function i(i){i&&i.writtenProperties&&i.writtenProperties.forEach((({target:i,propName:t,newOrigin:e})=>{r(i)&&e&&i.originOf(t)!==e&&i.updateOrigin(t,e)}))}export{i as updateOrigins};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nfunction i(i){return i&&\"getAtOrigin\"in i&&\"originOf\"in i}export{i as isMultiOriginJSONMixin};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport{difference as e}from\"../../core/arrayUtils.js\";import t from\"../../core/Error.js\";import r from\"../../core/Logger.js\";import{debounce as a,eachAlways as o}from\"../../core/promiseUtils.js\";import{updateOrigins as l}from\"../../core/accessorSupport/originUtils.js\";import s from\"../FeatureLayer.js\";import{parse as n}from\"../support/arcgisLayerUrl.js\";import{fetchFeatureService as i}from\"../support/fetchService.js\";import{isFeatureCollectionLayer as u,isFeatureServiceLayer as p}from\"../support/layerUtils.js\";import c from\"../../portal/Portal.js\";import d from\"../../portal/PortalItem.js\";import{createForItemWrite as y}from\"../../portal/support/jsonContext.js\";import{addTypeKeyword as m,TypeKeyword as f,getWGS84ExtentForItem as w,removeTypeKeyword as h}from\"../../portal/support/portalItemUtils.js\";const v=r.getLogger(\"geoscene.layers.FeatureLayer\"),b=\"Feature Service\";function I(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function S(e,r){if(r.type!==b)throw new t(\"feature-layer:portal-item-wrong-type\",I(e,`should have portal item of type \"${b}\"`))}async function g(e){if(await e.load(),u(e))throw new t(\"feature-layer:save\",I(e,\"using an in-memory source cannot be saved to a portal item\"))}function j(e,r){let a=(e.messages??[]).filter((({type:e})=>\"error\"===e)).map((({name:e,message:r,details:a})=>new t(e,r,a)));if(r?.ignoreUnsupported&&(a=a.filter((({name:e})=>\"layer:unsupported\"!==e&&\"symbol:unsupported\"!==e&&\"symbol-layer:unsupported\"!==e&&\"property:unsupported\"!==e&&\"url:unsupported\"!==e))),a.length>0)throw new t(\"feature-layer:save\",\"Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information\",{errors:a})}async function L(e,t,r){\"beforeSave\"in e&&\"function\"==typeof e.beforeSave&&await e.beforeSave();const a=e.write({},t);return j(t,r),a}function P(e){const{layer:t,layerJSON:r}=e;return t.isTable?{layers:[],tables:[r]}:{layers:[r],tables:[]}}function J(e){m(e,f.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}function N(e){const r=e.portalItem;if(!r)throw v.error(\"save: requires the portalItem property to be set\"),new t(\"feature-layer:portal-item-not-set\",I(e,\"requires the portalItem property to be set\"));if(!r.loaded)throw new t(\"feature-layer:portal-item-not-loaded\",I(e,\"cannot be saved to a portal item that does not exist or is inaccessible\"));S(e,r)}async function O(e,t){return/\\/\\d+\\/?$/.test(e.url??\"\")?P(t[0]):E(e,t)}async function E(e,t){const{layer:{url:r,customParameters:a,apiKey:o}}=t[0];let l=await e.fetchData(\"json\");l&&null!=l.layers&&null!=l.tables||(l=await T(l,{url:r??\"\",customParameters:a,apiKey:o},t.map((e=>e.layer.layerId))));for(const s of t)A(s.layer,s.layerJSON,l);return l}async function T(e,t,r){e||={},e.layers||=[],e.tables||=[];const{url:a,customParameters:o,apiKey:l}=t,{serviceJSON:s,layersJSON:n}=await i(a,{customParameters:o,apiKey:l}),u=$(e.layers,s.layers,r),p=$(e.tables,s.tables,r);e.layers=u.itemResources,e.tables=p.itemResources;const c=[...u.added,...p.added],d=n?[...n.layers,...n.tables]:[];return await x(e,c,a,d),e}function $(t,r,a){const o=e(t,r,((e,t)=>e.id===t.id));t=t.filter((e=>!o.removed.some((t=>t.id===e.id))));const l=o.added.map((({id:e})=>({id:e})));return l.forEach((({id:e})=>{t.push({id:e})})),{itemResources:t,added:l.filter((({id:e})=>!a.includes(e)))}}async function x(e,t,r,a){const l=t.map((({id:e})=>new s({url:r,layerId:e,sourceJSON:a.find((({id:t})=>t===e))})));await o(l.map((e=>e.load()))),l.forEach((t=>{const{layerId:r,loaded:a,defaultPopupTemplate:o}=t;if(!a||null==o)return;A(t,{id:r,popupInfo:o.toJSON()},e)}))}function A(e,t,r){e.isTable?U(r.tables,t):U(r.layers,t)}function U(e,t){if(!e)return;const r=e.findIndex((({id:e})=>e===t.id));-1===r?e.push(t):e[r]=t}function K(e){const{portalItem:t}=e;return p(e)&&!e.dynamicDataSource&&!!t?.loaded&&t.type===b}async function F(e){if(!e?.length)throw new t(\"feature-layer-utils-saveall:missing-parameters\",\"'layers' array should contain at least one feature layer\");await Promise.all(e.map((e=>e.load())));for(const o of e)if(!K(o))throw new t(\"feature-layer-utils-saveall:invalid-parameters\",`'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ${I(o,\"does not conform\")}`,{layer:o});const r=e.map((e=>e.portalItem.id));if(new Set(r).size>1)throw new t(\"feature-layer-utils-saveall:invalid-parameters\",\"All layers in the 'layers' array should be loaded from the same portal item\");const a=e.map((e=>e.layerId));if(new Set(a).size!==a.length)throw new t(\"feature-layer-utils-saveall:invalid-parameters\",\"'layers' array should contain only one instance each of layer or table in a feature service\")}function R(e,t){let r=d.from(t);return r.id&&(r=r.clone(),r.id=null),r.type??=b,r.portal??=c.getDefault(),S(e,r),r}async function D(e,t){const{url:r,layerId:a,title:o,fullExtent:l,isTable:s}=e,i=n(r),u=null!=i&&\"FeatureServer\"===i.serverType;t.url=u?r:`${r}/${a}`,t.title||=o,t.extent=null,s||null==l||(t.extent=await w(l)),h(t,f.METADATA),h(t,f.MULTI_LAYER),m(t,f.SINGLE_LAYER),s&&m(t,f.TABLE),J(t)}async function q(e,t,r){const a=e.portal;await(a?.signIn()),await(a?.user?.addItem({item:e,data:t,folder:r?.folder}))}const z=a(C);async function C(e,t){await g(e),N(e);const r=e.portalItem,a=y(r),o=await L(e,a,t),s=await O(r,[{layer:e,layerJSON:o}]);return J(r),await r.update({data:s}),l(a),r}const M=a((async(e,t)=>{await F(e);const r=e[0].portalItem,a=y(r),o=await Promise.all(e.map((e=>L(e,a,t)))),s=await O(r,e.map(((e,t)=>({layer:e,layerJSON:o[t]}))));return J(r),await r.update({data:s}),await Promise.all(e.slice(1).map((e=>e.portalItem.reload()))),l(a),r.clone()})),Y=a(_);async function _(e,t,r){await g(e);const a=R(e,t),o=y(a),s=P({layer:e,layerJSON:await L(e,o,r)});return await D(e,a),await q(a,s,r),e.portalItem=a,l(o),a}export{z as save,M as saveAll,Y as saveAs};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport{fetchArcGISServiceJSON as e}from\"../../support/requestPresets.js\";async function r(r,s){const a=await e(r,s);a.layers=a.layers.filter(t);const n={serviceJSON:a};if((a.currentVersion??0)<10.5)return n;const i=await e(r+\"/layers\",s);return n.layersJSON={layers:i.layers.filter(t),tables:i.tables},n}function t(e){return!e.type||\"Feature Layer\"===e.type}export{r as fetchFeatureService};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport{urlToObject as r}from\"../../core/urlUtils.js\";import t from\"../Portal.js\";function e(e){return{origin:\"portal-item\",url:r(e.itemUrl),portal:e.portal||t.getDefault(),portalItem:e,readResourcePaths:[]}}function o(e){return{origin:\"portal-item\",messages:[],writtenProperties:[],url:e.itemUrl?r(e.itemUrl):null,portal:e.portal||t.getDefault(),portalItem:e}}export{e as createForItemRead,o as createForItemWrite};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport e from\"../request.js\";async function t(t,o){const{data:r}=await e(t,{responseType:\"json\",query:{f:\"json\",...o?.customParameters,token:o?.apiKey}});return r}export{t as fetchArcGISServiceJSON};"],"names":["i","writtenProperties","forEach","target","propName","t","newOrigin","e","r","originOf","updateOrigin","v","getLogger","b","I","title","id","declaredClass","S","type","async","g","load","u","j","a","messages","filter","map","name","message","details","ignoreUnsupported","length","errors","L","beforeSave","write","P","layer","layerJSON","isTable","layers","tables","J","m","f","JSAPI","typeKeywords","indexOf","N","portalItem","error","loaded","O","test","url","E","customParameters","apiKey","o","l","fetchData","T","layerId","s","A","serviceJSON","layersJSON","n","$","p","itemResources","c","added","d","x","removed","some","push","includes","sourceJSON","find","defaultPopupTemplate","popupInfo","toJSON","U","findIndex","K","dynamicDataSource","F","Promise","all","Set","size","R","from","clone","portal","getDefault","D","fullExtent","serverType","extent","w","h","METADATA","MULTI_LAYER","SINGLE_LAYER","TABLE","q","signIn","user","addItem","item","data","folder","z","C","y","update","slice","reload","Y","_","currentVersion","origin","itemUrl","readResourcePaths","responseType","query","token"],"sourceRoot":""}