"use strict";(self["webpackChunksun_glare_project"]=self["webpackChunksun_glare_project"]||[]).push([[9144],{76545:function(e,t,s){s.r(t),s.d(t,{default:function(){return te}});var i=s(56768),a=s(45130),l=s(24232);const r={class:"lu-jing-gui-hua"},n={class:"search-containers"},h={class:"revert-containers"},d=(0,i.Lk)("div",{class:"car"},[(0,i.Lk)("img",{src:"https://wx3.sinaimg.cn/orj360/008tIcISgy1hsgyr8gzsjj300o00odfl.jpg"})],-1),c={class:"swap-action"},o=(0,i.Lk)("img",{src:"https://wx1.sinaimg.cn/orj360/008tIcISgy1hsiz7qtw48j301s01sq2p.jpg",alt:"revert",style:{width:"22px",height:"25px"}},null,-1),u=[o],g={class:"search-container start"},p=(0,i.Lk)("div",{class:"search-icon-wrapper"},[(0,i.Lk)("img",{src:"https://wx1.sinaimg.cn/orj360/008tIcISgy1hsgyr8gv8dj300f00f0oh.jpg",alt:"pink"})],-1),m={class:"search-box-img"},y=(0,i.Lk)("img",{src:"https://wx2.sinaimg.cn/orj360/008tIcISgy1hsnss2ckv4j300k00k0m1.jpg",alt:"delete1"},null,-1),w=[y],R={key:0,class:"search-results",ref:"searchResultsStart"},v=["onClick"],S={class:"search-container end"},k=(0,i.Lk)("div",{class:"search-icon-wrapper"},[(0,i.Lk)("img",{src:"https://wx4.sinaimg.cn/orj360/008tIcISgy1hsgyr8got8j300f00f0o9.jpg",alt:"green"})],-1),E={class:"search-box-img"},f=(0,i.Lk)("img",{src:"https://wx2.sinaimg.cn/orj360/008tIcISgy1hsnss2ckv4j300k00k0m1.jpg",alt:"delete1"},null,-1),b=[f],I={key:0,class:"search-results",ref:"searchResultsEnd"},x=["onClick"],L=(0,i.Lk)("img",{src:"https://wx4.sinaimg.cn/mw2000/008tIcISgy1hsq1fw9ob9j300w00w3ya.jpg",alt:"search"},null,-1),T=[L],_={key:0,class:"loader-overlay"},j=(0,i.Lk)("div",{class:"loader"},null,-1),C=[j],D=(0,i.Lk)("div",{id:"viewDiv"},null,-1),Q={class:"main-container"},M={class:"choose-time"},N={class:"form-group"},A=(0,i.Lk)("label",{for:"date-input"},"选择日期：",-1),$=["min","max"],J=(0,i.Lk)("label",{for:"time-input"},"选择时间：",-1);function q(e,t,s,o,y,f){return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.Lk)("div",r,[(0,i.Lk)("div",n,[(0,i.Lk)("div",h,[d,(0,i.Lk)("div",c,[(0,i.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>f.swap&&f.swap(...e)),title:"切换起终点"},u)])]),(0,i.Lk)("div",g,[p,(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>o.searchQueryStart=e),onInput:t[2]||(t[2]=e=>f.onSearchInputChange(e,!0)),placeholder:"请输入起点",class:"search-box search-box-start"},null,544),[[a.Jo,o.searchQueryStart]]),(0,i.Lk)("span",m,[(0,i.Lk)("div",{class:"delete",title:"清空",onClick:t[3]||(t[3]=(...e)=>f.clc1&&f.clc1(...e))},w)]),y.searchResults.length&&o.searchQueryStart?((0,i.uX)(),(0,i.CE)("div",R,[(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(y.searchResults,((e,t)=>((0,i.uX)(),(0,i.CE)("li",{key:t,class:(0,l.C4)({highlighted:t===y.highlightedIndex}),onClick:t=>f.selectResult(e,!0)},(0,l.v_)(e.name),11,v)))),128))])],512)):(0,i.Q3)("",!0)]),(0,i.Lk)("div",S,[k,(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>o.searchQueryEnd=e),onInput:t[5]||(t[5]=e=>f.onSearchInputChange(e,!1)),placeholder:"请输入终点",class:"search-box search-box-end"},null,544),[[a.Jo,o.searchQueryEnd]]),(0,i.Lk)("span",E,[(0,i.Lk)("div",{class:"delete",title:"清空",onClick:t[6]||(t[6]=(...e)=>f.clc2&&f.clc2(...e))},b)]),y.searchResultsEnd.length&&o.searchQueryEnd?((0,i.uX)(),(0,i.CE)("div",I,[(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(y.searchResultsEnd,((e,t)=>((0,i.uX)(),(0,i.CE)("li",{key:t,class:(0,l.C4)({highlighted:t===y.highlightedIndex}),onClick:t=>f.selectResult(e,!1)},(0,l.v_)(e.name),11,x)))),128))])],512)):(0,i.Q3)("",!0)]),(0,i.Lk)("div",{class:"search-action",onClick:t[7]||(t[7]=(...e)=>f.onSearch&&f.onSearch(...e)),title:"搜索"},T),y.isLoading?((0,i.uX)(),(0,i.CE)("div",_,C)):(0,i.Q3)("",!0)])]),D,(0,i.Lk)("div",Q,[(0,i.Lk)("div",M,[(0,i.Lk)("div",N,[A,(0,i.bo)((0,i.Lk)("input",{id:"date-input",type:"date","onUpdate:modelValue":t[8]||(t[8]=e=>y.selectedDate=e),min:f.minDate,max:f.maxDate,class:(0,l.C4)({"invalid-date":f.isDateDisabled(y.selectedDate)}),onChange:t[9]||(t[9]=(...e)=>f.handleDateChange&&f.handleDateChange(...e))},null,42,$),[[a.Jo,y.selectedDate]]),J,(0,i.bo)((0,i.Lk)("input",{id:"time-input",type:"time","onUpdate:modelValue":t[10]||(t[10]=e=>f.formattedTime=e),onInput:t[11]||(t[11]=(...e)=>f.onTimeInputChange&&f.onTimeInputChange(...e)),step:"600"},null,544),[[a.Jo,f.formattedTime]])])])])],64)}s(44114),s(14603),s(47566),s(98721);var O=s(7382),P=s(27583),U=s(11134),z=s(74036),K=s(58423),V=s(94373),F=s(41759),X=s(90144),Z=s(81387),Y=s(57829),H=s(3949),B=s(95587),G={name:"IntermediatePageView",setup(){const e=(0,X.KR)(""),t=(0,X.KR)(""),s=(0,X.KR)(null),i=(0,X.KR)(null),a=(0,Z.rd)();return{searchQueryStart:e,searchQueryEnd:t,selectedResultStart:s,selectedResultEnd:i,router:a}},data(){return{searchResults:[],searchResultsEnd:[],isLoading:!1,selectedDate:"",selectedTime:"",highlightedIndex:-1}},mounted(){this.initMap(),this.$route.query.start&&(this.selectedResultStart=JSON.parse(this.$route.query.start)),this.$route.query.end&&(this.selectedResultEnd=JSON.parse(this.$route.query.end)),this.parseUrlParams(),setInterval((()=>{this.updateTime()}),6e4),window.addEventListener("keydown",this.handleKeydown)},beforeUnmount(){window.removeEventListener("keydown",this.handleKeydown)},computed:{minDate(){return"2024-01-01"},maxDate(){return"2024-12-31"},formattedTime(){if(!this.selectedTime)return"";const[e,t]=this.selectedTime.split(":").map(Number),s=10*Math.floor(t/10);return`${String(e).padStart(2,"0")}:${String(s).padStart(2,"0")}`}},methods:{onTimeInputChange(e){const t=e.target.value,[s,i]=t.split(":").map(Number),a=10*Math.floor(i/10);this.selectedTime=`${String(s).padStart(2,"0")}:${String(a).padStart(2,"0")}`},isDateDisabled(e){if(!e)return!1;const t=new Date(e),s=t.getMonth()+1,i=t.getDate();return s>=1&&s<=7&&15!==i||(8===s&&i<=20||s>=10&&s<=12&&15!==i)},handleDateChange(e){const t=e.target.value;this.isDateDisabled(t)&&(alert("选择的日期未进行模拟，请选择其他日期。可选日期为，1-7月的15日，8月20日-9月30日，10-12月的15日。"),this.selectedDate="")},handleKeydown(e){if(this.searchResults.length&&this.searchQueryStart)switch(e.key){case"Escape":this.searchResults=[];break;case"Tab":e.preventDefault(),this.highlightedIndex=(this.highlightedIndex+1)%this.searchResults.length,(0,i.dY)((()=>{const e=this.$refs.searchResultsStart.querySelector("li.highlighted");e&&e.scrollIntoView({block:"nearest",behavior:"smooth"})}));break;case"Enter":this.highlightedIndex>=0&&this.highlightedIndex<this.searchResults.length&&this.selectResult(this.searchResults[this.highlightedIndex],!0);break}else if(this.searchResultsEnd.length&&this.searchQueryEnd)switch(e.key){case"Escape":this.searchResultsEnd=[];break;case"Tab":e.preventDefault(),this.highlightedIndex=(this.highlightedIndex+1)%this.searchResultsEnd.length,(0,i.dY)((()=>{const e=this.$refs.searchResultsEnd.querySelector("li.highlighted");e&&e.scrollIntoView({block:"nearest",behavior:"smooth"})}));break;case"Enter":this.highlightedIndex>=0&&this.highlightedIndex<this.searchResultsEnd.length&&this.selectResult(this.searchResultsEnd[this.highlightedIndex],!1);break}},updateTime(){const e=new Date,t=`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;this.isTimeFromUrl&&this.selectedTime!==t||(this.selectedTime=t,this.isTimeFromUrl=!1)},clc1(){this.searchQueryStart=""},clc2(){this.searchQueryEnd=""},parseUrlParams(){const e=new URLSearchParams(window.location.search),t=e.get("start"),s=e.get("end"),i=e.get("date"),a=e.get("time");if(t)try{const e=JSON.parse(decodeURIComponent(t));e&&e.address&&(this.searchQueryStart=e.name)}catch(l){console.error("Error parsing start parameter:",l)}if(s)try{const e=JSON.parse(decodeURIComponent(s));e&&e.address&&(this.searchQueryEnd=e.name)}catch(l){console.error("Error parsing end parameter:",l)}i&&(this.selectedDate=i),a&&(this.selectedTime=a,this.isTimeFromUrl=!0)},swap(){const e=this.searchQueryStart;this.searchQueryStart=this.searchQueryEnd,this.searchQueryEnd=e;const t=this.selectedResultStart;this.selectedResultStart=this.selectedResultEnd,this.selectedResultEnd=t,this.router.push({path:"/lu-jing-gui-hua/result",query:{start:JSON.stringify(this.selectedResultStart),end:JSON.stringify(this.selectedResultEnd),date:this.selectedDate,time:this.selectedTime}})},onSearchInputChange(e,t){const s=e.target.value,i=t?"searchResults":"searchResultsEnd";s.includes("'")?console.log("输入法临时输入，不发送请求"):s.length>=2?fetch("http://112.125.122.56/sun-glare-project/api/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({searchQueryStart:s})}).then((e=>e.json())).then((e=>{this[i]=e})).catch((e=>{console.error("错误:",e)})):this[i]=[]},selectResult(e,t=!0){const s={name:e.name,address:e.address,wgs84_latitude:e.wgs84_latitude,wgs84_longitude:e.wgs84_longitude,location:[e.wgs84_longitude,e.wgs84_latitude],baidu_index:e.baidu_index,baidu_latitude:e.baidu_latitude,baidu_longitude:e.baidu_longitude,id:e.id,label:e.label};let i=!1;t&&this.selectedResultStart?(i=!0,this.selectedResultStart=s,this.searchQueryStart=s.name,this.searchResults=[]):!t&&this.selectedResultEnd?(i=!0,this.selectedResultEnd=s,this.searchQueryEnd=s.name,this.searchResultsEnd=[]):t?(this.selectedResultStart=s,this.searchQueryStart=s.name,this.searchResults=[]):(this.selectedResultEnd=s,this.searchQueryEnd=s.name,this.searchResultsEnd=[]);const a=this.selectedResultStart||this.selectedResultEnd;this.selectedResultStart&&this.selectedResultEnd?this.navigateToResultPage():a&&this.navigateToIntermediatePage(t?"start":"end",s,i)},navigateToResultPage(){this.$router.push({path:"/lu-jing-gui-hua/result",query:{start:JSON.stringify({...this.selectedResultStart,location:[this.selectedResultStart.wgs84_longitude,this.selectedResultStart.wgs84_latitude]}),end:JSON.stringify({...this.selectedResultEnd,location:[this.selectedResultEnd.wgs84_longitude,this.selectedResultEnd.wgs84_latitude]}),date:this.selectedDate,time:this.selectedTime}})},navigateToIntermediatePage(e,t,s=!1){const i="/lu-jing-gui-hua/intermediate-page",a={[e]:JSON.stringify(t),date:this.selectedDate,time:this.selectedTime};s?this.$router.replace({path:i,query:a}).then((()=>{window.location.reload()})):this.$router.push({path:i,query:a})},onSearch(){if(this.selectedResultStart&&this.selectedResultEnd){this.isLoading=!0;const e={...this.selectedResultStart,location:[this.selectedResultStart.wgs84_longitude,this.selectedResultStart.wgs84_latitude]},t={...this.selectedResultEnd,location:[this.selectedResultEnd.wgs84_longitude,this.selectedResultEnd.wgs84_latitude]},s=5===this.selectedTime.length?`${this.selectedTime}:00`:this.selectedTime;console.log("Formatted Time:",s),V.A.post("http://112.125.122.56/sun-glare-project/api/route/plan",{start:e,end:t,date:this.selectedDate,time:s}).then((i=>{const a=i.data.default_id,l=i.data.time_based_id;console.log("默认路径规划结果ID:",a),console.log("基于时间的路径规划结果ID:",l),console.log("路径规划成功，时间日期是:",this.selectedDate,this.selectedTime),this.isLoading=!1,this.$router.push({path:"/lu-jing-gui-hua/route",query:{start:JSON.stringify(e),end:JSON.stringify(t),default_id:a,time_based_id:l,date:this.selectedDate,time:s}})})).catch((e=>{console.error(e),this.isLoading=!1,alert("路径规划失败，请稍后再试。")}))}else alert("请确保起点和终点都已选择。")},initMap(){const e=new O.A({basemap:"tianditu-vector"});this.map=e,this.view=new P.A({container:"viewDiv",map:e,center:[114.3,30.7],zoom:4,constraints:{geometry:{type:"extent",xmin:113.6,ymin:29.9,xmax:115,ymax:31.3},minScale:500,maxScale:2e6,rotationEnabled:!1,snapToZoom:!1}});const t=new Y.A({view:this.view,source:{query:{title:'"Basemaps for Developers" AND owner:geoscenedev'}}}),s=new B.A({view:this.view});this.view.ui.add(t,"bottom-right"),this.view.ui.move("zoom","bottom-left"),this.view.ui.add(s,"bottom-left");const i=new K.A;e.add(i);const a=new H["default"]({url:"https://www.geosceneonline.cn/server/rest/services/Hosted/wuhan_village/FeatureServer",renderer:{type:"simple",symbol:{type:"simple-fill",color:[0,0,0,0],outline:{color:[0,0,0,1],width:1}}},popupTemplate:{content:[{type:"fields",fieldInfos:[{fieldName:"县区name",label:"县区名称"}]}]}});e.add(a),this.view.when((()=>{this.drawPoints(i),this.adjustView()})).catch((e=>{console.error("MapView initialization error:",e)}))},adjustView(){if(this.selectedResultStart&&this.selectedResultEnd){const e=.01,t=new F.A({xmin:Math.min(this.selectedResultStart.location[0],this.selectedResultEnd.location[0])-10*e,ymin:Math.min(this.selectedResultStart.location[1],this.selectedResultEnd.location[1])-10*e,xmax:Math.max(this.selectedResultStart.location[0],this.selectedResultEnd.location[0])+10*e,ymax:Math.max(this.selectedResultStart.location[1],this.selectedResultEnd.location[1])+10*e});this.view.goTo(t).catch((e=>{console.error("Error adjusting view:",e)}))}else this.selectedResultStart?this.view.goTo({center:[this.selectedResultStart.location[0],this.selectedResultStart.location[1]],zoom:10}).catch((e=>{console.error("Error adjusting view:",e)})):this.selectedResultEnd&&this.view.goTo({center:[this.selectedResultEnd.location[0],this.selectedResultEnd.location[1]],zoom:10}).catch((e=>{console.error("Error adjusting view:",e)}))},drawPoints(e){if(this.selectedResultStart){const t=this.selectedResultStart,s=new z.A({longitude:t.location[0],latitude:t.location[1]}),i=new U.A({geometry:s,symbol:{type:"simple-marker",color:"red",size:"20px"},popupTemplate:{title:"起点信息",content:[{type:"fields",fieldInfos:[{fieldName:"address",label:"地址"},{fieldName:"name",label:"名称"}]}]},attributes:t});e.add(i)}if(this.selectedResultEnd){const t=this.selectedResultEnd,s=new z.A({longitude:t.location[0],latitude:t.location[1]}),i=new U.A({geometry:s,symbol:{type:"simple-marker",color:"green",size:"20px"},popupTemplate:{title:"终点信息",content:[{type:"fields",fieldInfos:[{fieldName:"address",label:"地址"},{fieldName:"name",label:"名称"}]}]},attributes:t});e.add(i)}}}},W=s(71241);const ee=(0,W.A)(G,[["render",q]]);var te=ee},58423:function(e,t,s){s.d(t,{A:function(){return g}});var i=s(71457),a=s(76543),l=(s(37679),s(69292),s(51020),s(29916)),r=s(46626),n=s(71680),h=s(79366),d=s(99024),c=s(41341),o=s(9693);let u=class extends((0,h.d)((0,d.j)(n.A))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new c.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,i._)([(0,a.MZ)({type:o.A})],u.prototype,"elevationInfo",void 0),(0,i._)([(0,a.MZ)((0,r.C)(c.Y,"graphics"))],u.prototype,"graphics",void 0),(0,i._)([(0,a.MZ)({type:["show","hide"]})],u.prototype,"listMode",void 0),(0,i._)([(0,a.MZ)()],u.prototype,"screenSizePerspectiveEnabled",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],u.prototype,"type",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],u.prototype,"internal",void 0),u=(0,i._)([(0,l.$)("geoscene.layers.GraphicsLayer")],u);const g=u}}]);
//# sourceMappingURL=lu-jing-gui-hua-intermediate-page.cf01f305.js.map