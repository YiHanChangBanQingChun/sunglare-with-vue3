"use strict";(self["webpackChunksun_glare_project"]=self["webpackChunksun_glare_project"]||[]).push([[5131],{71726:function(e,t,a){a.d(t,{v:function(){return n}});var r=a(3133);function n(e){e&&e.writtenProperties&&e.writtenProperties.forEach((({target:e,propName:t,newOrigin:a})=>{(0,r.H)(e)&&a&&e.originOf(t)!==a&&e.updateOrigin(t,a)}))}},3133:function(e,t,a){function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}a.d(t,{H:function(){return r}})},85131:function(e,t,a){a.d(t,{save:function(){return _},saveAs:function(){return k}});a(44114),a(17642),a(58004),a(33853),a(45876),a(32475),a(15024),a(31698);var r=a(69292),n=a(47966),o=a(15114),i=a(71120),l=a(71726),s=a(3949),u=a(75122),c=a(37510),f=a(46759),d=a(67681),y=a(66476),p=a(39664),m=a(58131);const w=o.A.getLogger("geoscene.layers.FeatureLayer"),v="Feature Service";function h(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function g(e,t){if(t.type!==v)throw new n.A("feature-layer:portal-item-wrong-type",h(e,`should have portal item of type "${v}"`))}async function b(e){if(await e.load(),(0,f.Ov)(e))throw new n.A("feature-layer:save",h(e,"using an in-memory source cannot be saved to a portal item"))}function A(e,t){let a=(e.messages??[]).filter((({type:e})=>"error"===e)).map((({name:e,message:t,details:a})=>new n.A(e,t,a)));if(t?.ignoreUnsupported&&(a=a.filter((({name:e})=>"layer:unsupported"!==e&&"symbol:unsupported"!==e&&"symbol-layer:unsupported"!==e&&"property:unsupported"!==e&&"url:unsupported"!==e))),a.length>0)throw new n.A("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a})}async function I(e,t,a){"beforeSave"in e&&"function"==typeof e.beforeSave&&await e.beforeSave();const r=e.write({},t);return A(t,a),r}function S(e){const{layer:t,layerJSON:a}=e;return t.isTable?{layers:[],tables:[a]}:{layers:[a],tables:[]}}function O(e){(0,m.LG)(e,m.Ce.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,a)=>a.indexOf(e)===t)))}function P(e){const t=e.portalItem;if(!t)throw w.error("save: requires the portalItem property to be set"),new n.A("feature-layer:portal-item-not-set",h(e,"requires the portalItem property to be set"));if(!t.loaded)throw new n.A("feature-layer:portal-item-not-loaded",h(e,"cannot be saved to a portal item that does not exist or is inaccessible"));g(e,t)}async function L(e,t){return/\/\d+\/?$/.test(e.url??"")?S(t[0]):N(e,t)}async function N(e,t){const{layer:{url:a,customParameters:r,apiKey:n}}=t[0];let o=await e.fetchData("json");o&&null!=o.layers&&null!=o.tables||(o=await J(o,{url:a??"",customParameters:r,apiKey:n},t.map((e=>e.layer.layerId))));for(const i of t)$(i.layer,i.layerJSON,o);return o}async function J(e,t,a){e||={},e.layers||=[],e.tables||=[];const{url:r,customParameters:n,apiKey:o}=t,{serviceJSON:i,layersJSON:l}=await(0,c.Q)(r,{customParameters:n,apiKey:o}),s=T(e.layers,i.layers,a),u=T(e.tables,i.tables,a);e.layers=s.itemResources,e.tables=u.itemResources;const f=[...s.added,...u.added],d=l?[...l.layers,...l.tables]:[];return await E(e,f,r,d),e}function T(e,t,a){const n=(0,r.iv)(e,t,((e,t)=>e.id===t.id));e=e.filter((e=>!n.removed.some((t=>t.id===e.id))));const o=n.added.map((({id:e})=>({id:e})));return o.forEach((({id:t})=>{e.push({id:t})})),{itemResources:e,added:o.filter((({id:e})=>!a.includes(e)))}}async function E(e,t,a,r){const n=t.map((({id:e})=>new s["default"]({url:a,layerId:e,sourceJSON:r.find((({id:t})=>t===e))})));await(0,i.Lx)(n.map((e=>e.load()))),n.forEach((t=>{const{layerId:a,loaded:r,defaultPopupTemplate:n}=t;r&&null!=n&&$(t,{id:a,popupInfo:n.toJSON()},e)}))}function $(e,t,a){e.isTable?C(a.tables,t):C(a.layers,t)}function C(e,t){if(!e)return;const a=e.findIndex((({id:e})=>e===t.id));-1===a?e.push(t):e[a]=t}function K(e){const{portalItem:t}=e;return(0,f.fH)(e)&&!e.dynamicDataSource&&!!t?.loaded&&t.type===v}async function x(e){if(!e?.length)throw new n.A("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");await Promise.all(e.map((e=>e.load())));for(const r of e)if(!K(r))throw new n.A("feature-layer-utils-saveall:invalid-parameters",`'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ${h(r,"does not conform")}`,{layer:r});const t=e.map((e=>e.portalItem.id));if(new Set(t).size>1)throw new n.A("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");const a=e.map((e=>e.layerId));if(new Set(a).size!==a.length)throw new n.A("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service")}function D(e,t){let a=y["default"].from(t);return a.id&&(a=a.clone(),a.id=null),a.type??=v,a.portal??=d.A.getDefault(),g(e,a),a}async function F(e,t){const{url:a,layerId:r,title:n,fullExtent:o,isTable:i}=e,l=(0,u.qg)(a),s=null!=l&&"FeatureServer"===l.serverType;t.url=s?a:`${a}/${r}`,t.title||=n,t.extent=null,i||null==o||(t.extent=await(0,m.sQ)(o)),(0,m.OM)(t,m.Ce.METADATA),(0,m.OM)(t,m.Ce.MULTI_LAYER),(0,m.LG)(t,m.Ce.SINGLE_LAYER),i&&(0,m.LG)(t,m.Ce.TABLE),O(t)}async function R(e,t,a){const r=e.portal;await(r?.signIn()),await(r?.user?.addItem({item:e,data:t,folder:a?.folder}))}const _=(0,i.sg)(j);async function j(e,t){await b(e),P(e);const a=e.portalItem,r=(0,p.m)(a),n=await I(e,r,t),o=await L(a,[{layer:e,layerJSON:n}]);return O(a),await a.update({data:o}),(0,l.v)(r),a}(0,i.sg)((async(e,t)=>{await x(e);const a=e[0].portalItem,r=(0,p.m)(a),n=await Promise.all(e.map((e=>I(e,r,t)))),o=await L(a,e.map(((e,t)=>({layer:e,layerJSON:n[t]}))));return O(a),await a.update({data:o}),await Promise.all(e.slice(1).map((e=>e.portalItem.reload()))),(0,l.v)(r),a.clone()}));const k=(0,i.sg)(U);async function U(e,t,a){await b(e);const r=D(e,t),n=(0,p.m)(r),o=S({layer:e,layerJSON:await I(e,n,a)});return await F(e,r),await R(r,o,a),e.portalItem=r,(0,l.v)(n),r}},37510:function(e,t,a){a.d(t,{Q:function(){return n}});var r=a(31763);async function n(e,t){const a=await(0,r.V)(e,t);a.layers=a.layers.filter(o);const n={serviceJSON:a};if((a.currentVersion??0)<10.5)return n;const i=await(0,r.V)(e+"/layers",t);return n.layersJSON={layers:i.layers.filter(o),tables:i.tables},n}function o(e){return!e.type||"Feature Layer"===e.type}},39664:function(e,t,a){a.d(t,{m:function(){return i},v:function(){return o}});var r=a(4244),n=a(67681);function o(e){return{origin:"portal-item",url:(0,r.An)(e.itemUrl),portal:e.portal||n.A.getDefault(),portalItem:e,readResourcePaths:[]}}function i(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?(0,r.An)(e.itemUrl):null,portal:e.portal||n.A.getDefault(),portalItem:e}}},31763:function(e,t,a){a.d(t,{V:function(){return n}});var r=a(86039);async function n(e,t){const{data:a}=await(0,r["default"])(e,{responseType:"json",query:{f:"json",...t?.customParameters,token:t?.apiKey}});return a}}}]);
//# sourceMappingURL=5131.89e9b082.js.map