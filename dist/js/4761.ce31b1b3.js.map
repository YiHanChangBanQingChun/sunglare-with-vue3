{"version":3,"file":"js/4761.ce31b1b3.js","mappings":"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","sources":["webpack://sun-glare-project/./node_modules/@geoscene/core/views/layers/StreamLayerView.js","webpack://sun-glare-project/./node_modules/@geoscene/core/views/2d/layers/StreamLayerView2D.js"],"sourcesContent":["/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport{_ as s}from\"../../chunks/tslib.es6.js\";import{property as e}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import{subclass as r}from\"../../core/accessorSupport/decorators/subclass.js\";import t from\"../../layers/support/FeatureFilter.js\";const o=o=>{let i=class extends o{resume(){this._isUserPaused=!1,this.suspended||this._doResume()}pause(){this._isUserPaused=!0,this.suspended||this._doPause()}constructor(...s){super(...s),this._isUserPaused=!1,this.filter=null}get connectionStatus(){return this._isUserPaused?\"paused\":this._streamConnectionStatus}_onSuspendedChange(s){s?this._doPause():this._isUserPaused||this._doResume()}};return s([e()],i.prototype,\"_isUserPaused\",void 0),s([e({readOnly:!0})],i.prototype,\"connectionStatus\",null),s([e({type:t})],i.prototype,\"filter\",void 0),i=s([r(\"geoscene.layers.mixins.StreamLayerView\")],i),i};export{o as default};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Error.js\";import{handlesGroup as r}from\"../../../core/handleUtils.js\";import{watch as s}from\"../../../core/reactiveUtils.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import{subclass as o}from\"../../../core/accessorSupport/decorators/subclass.js\";import n from\"../../../rest/support/FeatureSet.js\";import a from\"./FeatureLayerView2D.js\";import{toJSONGeometryType as l}from\"./support/util.js\";import p from\"../../layers/StreamLayerView.js\";function c(e,t){if(null==e&&null==t)return null;const r={};return null!=t&&(r.geometry=t.toJSON()),null!=e&&(r.where=e),r}let u=class extends(p(a)){constructor(){super(...arguments),this.pipelineConnectionStatus=\"disconnected\",this.pipelineErrorString=null,this._enabledEventTypes=new Set}initialize(){this.addHandles([s((()=>this.layer.customParameters),(e=>this._proxy.updateCustomParameters(e))),this.layer.on(\"send-message-to-socket\",(e=>this._proxy.sendMessageToSocket(e))),this.layer.on(\"send-message-to-client\",(e=>this._proxy.sendMessageToClient(e))),s((()=>this.layer.purgeOptions),(()=>this._update())),s((()=>this.suspended),this._onSuspendedChange.bind(this))],\"constructor\")}get connectionError(){return this.pipelineErrorString?new t(\"stream-controller\",this.pipelineErrorString):null}on(e,t){if(Array.isArray(e))return r(e.map((e=>this.on(e,t))));const s=[\"data-received\",\"message-received\"].includes(e);s&&(this._enabledEventTypes.add(e),this._proxy.enableEvent(e,!0));const i=super.on(e,t),o=this;return{remove(){i.remove(),s&&(o._proxy.closed||o.hasEventListener(e)||o._proxy.enableEvent(e,!1))}}}queryLatestObservations(e,r){if(!(this.layer.timeInfo?.endField||this.layer.timeInfo?.startField||this.layer.timeInfo?.trackIdField))throw new t(\"streamlayer-no-timeField\",\"queryLatestObservation can only be used with services that define a TrackIdField\");return this._proxy.queryLatestObservations(this._cleanUpQuery(e),r).then((e=>{const t=n.fromJSON(e);return t.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),t}))}detach(){super.detach(),this.pipelineConnectionStatus=\"disconnected\"}get _streamConnectionStatus(){return this.pipelineConnectionStatus}_doPause(){this._proxy?.pauseStream()}_doResume(){this._proxy?.resumeStream()}_createClientOptions(){return{...super._createClientOptions(),setProperty:e=>{this.set(e.propertyName,e.value)}}}_createTileRendererHash(e){const t=`${JSON.stringify(this.layer.purgeOptions)}.${JSON.stringify(c(this.layer.definitionExpression,this.layer.geometryDefinition))})`;return super._createTileRendererHash(e)+t}async _createServiceOptions(){const e=this.layer,{objectIdField:t}=e,r=e.fields.map((e=>e.toJSON())),s=l(e.geometryType),i=e.timeInfo&&e.timeInfo.toJSON()||null,o=e.spatialReference?e.spatialReference.toJSON():null;return{type:\"stream\",isPaused:this._isUserPaused,fields:r,geometryType:s,objectIdField:t,timeInfo:i,source:this.layer.parsedUrl,serviceFilter:c(this.layer.definitionExpression,this.layer.geometryDefinition),purgeOptions:this.layer.purgeOptions.toJSON(),enabledEventTypes:Array.from(this._enabledEventTypes.values()),spatialReference:o,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,updateInterval:this.layer.updateInterval,customParameters:e.customParameters}}};e([i()],u.prototype,\"pipelineConnectionStatus\",void 0),e([i()],u.prototype,\"pipelineErrorString\",void 0),e([i({readOnly:!0})],u.prototype,\"connectionError\",null),e([i({readOnly:!0})],u.prototype,\"_streamConnectionStatus\",null),u=e([o(\"geoscene.views.2d.layers.StreamLayerView2D\")],u);const y=u;export{y as default};"],"names":["o","i","resume","this","_isUserPaused","suspended","_doResume","pause","_doPause","constructor","s","super","filter","connectionStatus","_streamConnectionStatus","_onSuspendedChange","e","prototype","readOnly","type","t","r","c","geometry","toJSON","where","u","p","a","arguments","pipelineConnectionStatus","pipelineErrorString","_enabledEventTypes","Set","initialize","addHandles","layer","customParameters","_proxy","updateCustomParameters","on","sendMessageToSocket","sendMessageToClient","purgeOptions","_update","bind","connectionError","Array","isArray","map","includes","add","enableEvent","remove","closed","hasEventListener","queryLatestObservations","timeInfo","endField","startField","trackIdField","_cleanUpQuery","then","n","fromJSON","features","forEach","sourceLayer","detach","pauseStream","resumeStream","_createClientOptions","setProperty","set","propertyName","value","_createTileRendererHash","JSON","stringify","definitionExpression","geometryDefinition","_createServiceOptions","objectIdField","fields","l","geometryType","spatialReference","isPaused","source","parsedUrl","serviceFilter","enabledEventTypes","from","values","maxReconnectionAttempts","maxReconnectionInterval","updateInterval","y"],"sourceRoot":""}