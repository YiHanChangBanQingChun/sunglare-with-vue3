"use strict";(self["webpackChunksun_glare_project"]=self["webpackChunksun_glare_project"]||[]).push([[7922],{67492:function(e,t,s){s.r(t),s.d(t,{default:function(){return ee}});var a=s(56768),i=s(45130),l=s(24232);const n={class:"lu-jing-gui-hua"},r={class:"search-containers"},o={class:"revert-containers"},d=(0,a.Lk)("div",{class:"car"},[(0,a.Lk)("img",{src:"https://wx3.sinaimg.cn/orj360/008tIcISgy1hsgyr8gzsjj300o00odfl.jpg"})],-1),c={class:"swap-action"},u=(0,a.Lk)("img",{src:"https://wx1.sinaimg.cn/orj360/008tIcISgy1hsiz7qtw48j301s01sq2p.jpg",alt:"revert",style:{width:"22px",height:"25px"}},null,-1),h=[u],p={class:"search-container start"},g=(0,a.Lk)("div",{class:"search-icon-wrapper"},[(0,a.Lk)("img",{src:"https://wx1.sinaimg.cn/orj360/008tIcISgy1hsgyr8gv8dj300f00f0oh.jpg",alt:"pink"})],-1),m={class:"search-box-img"},y=(0,a.Lk)("img",{src:"https://wx2.sinaimg.cn/orj360/008tIcISgy1hsnss2ckv4j300k00k0m1.jpg",alt:"delete1"},null,-1),k=[y],b={key:0,class:"search-results"},v=["onClick"],S={class:"search-container end"},f=(0,a.Lk)("div",{class:"search-icon-wrapper"},[(0,a.Lk)("img",{src:"https://wx4.sinaimg.cn/orj360/008tIcISgy1hsgyr8got8j300f00f0o9.jpg",alt:"green"})],-1),w={class:"search-box-img"},L=(0,a.Lk)("img",{src:"https://wx2.sinaimg.cn/orj360/008tIcISgy1hsnss2ckv4j300k00k0m1.jpg",alt:"delete1"},null,-1),_=[L],R={key:0,class:"search-results"},E=["onClick"],j=(0,a.Lk)("img",{src:"https://wx4.sinaimg.cn/mw2000/008tIcISgy1hsq1fw9ob9j300w00w3ya.jpg",alt:"search"},null,-1),I=[j],x=(0,a.Lk)("div",{id:"viewDiv"},null,-1),N={class:"main-container"},C={class:"choose-time"},M={class:"form-group"},Q=(0,a.Lk)("label",{for:"date-input"},"选择日期：",-1),O=(0,a.Lk)("label",{for:"time-input"},"选择时间：",-1),D={class:"routelist"},J={class:"cardlist"},$=(0,a.Lk)("div",{class:"route","data-index":"0"},[(0,a.Lk)("div",{class:"introduction"},"无眩光路径"),(0,a.Lk)("p",{class:"intro"},[(0,a.Lk)("span",null,"总时长："),(0,a.Lk)("span",null,"时间1"),(0,a.Lk)("span",null,"总距离："),(0,a.Lk)("span",null,"公里数1")])],-1),q={class:"route","data-index":"1"},A=(0,a.Lk)("div",{class:"introduction"},"耗时少路径",-1),T={class:"intro"},U=(0,a.Lk)("span",null,"总时长：",-1),z=(0,a.Lk)("span",null,"总距离：",-1);function P(e,t,s,u,y,L){return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",n,[(0,a.Lk)("div",r,[(0,a.Lk)("div",o,[d,(0,a.Lk)("div",c,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>L.swap&&L.swap(...e)),title:"切换起终点"},h)])]),(0,a.Lk)("div",p,[g,(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>y.searchQueryStart=e),onInput:t[2]||(t[2]=e=>L.onSearchInputChange(e,!0)),placeholder:"请输入起点",class:"search-box search-box-start"},null,544),[[i.Jo,y.searchQueryStart]]),(0,a.Lk)("span",m,[(0,a.Lk)("div",{class:"delete",title:"清空",onClick:t[3]||(t[3]=(...e)=>L.clc1&&L.clc1(...e))},k)]),y.searchResults.length&&y.searchQueryStart?((0,a.uX)(),(0,a.CE)("div",b,[(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(y.searchResults,((e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t,onClick:t=>L.selectResult(e,!0)},(0,l.v_)(e.name),9,v)))),128))])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",S,[f,(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>y.searchQueryEnd=e),onInput:t[5]||(t[5]=e=>L.onSearchInputChange(e,!1)),placeholder:"请输入终点",class:"search-box search-box-end"},null,544),[[i.Jo,y.searchQueryEnd]]),(0,a.Lk)("span",w,[(0,a.Lk)("div",{class:"delete",title:"清空",onClick:t[6]||(t[6]=(...e)=>L.clc2&&L.clc2(...e))},_)]),y.searchResultsEnd.length&&y.searchQueryEnd?((0,a.uX)(),(0,a.CE)("div",R,[(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(y.searchResultsEnd,((e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t,onClick:t=>L.selectResult(e,!1)},(0,l.v_)(e.name),9,E)))),128))])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",{class:"search-action",onClick:t[7]||(t[7]=(...e)=>L.onSearch&&L.onSearch(...e)),title:"搜索"},I)]),x]),(0,a.Lk)("div",N,[(0,a.Lk)("div",C,[(0,a.Lk)("div",M,[Q,(0,a.bo)((0,a.Lk)("input",{id:"date-input",type:"date","onUpdate:modelValue":t[8]||(t[8]=e=>y.selectedDate=e)},null,512),[[i.Jo,y.selectedDate]]),O,(0,a.bo)((0,a.Lk)("input",{id:"time-input",type:"time","onUpdate:modelValue":t[9]||(t[9]=e=>y.selectedTime=e)},null,512),[[i.Jo,y.selectedTime]])])]),(0,a.Lk)("div",D,[(0,a.Lk)("ul",J,[$,(0,a.Lk)("div",q,[A,(0,a.Lk)("p",T,[U,(0,a.Lk)("span",null,(0,l.v_)(y.totalHours)+"小时"+(0,l.v_)(y.totalMinutes)+"分钟",1),z,(0,a.Lk)("span",null,(0,l.v_)(y.totalDistance),1)])])])])])],64)}s(44114),s(14603),s(47566),s(98721);var X=s(7382),Z=s(56906),F=s(11134),G=s(74036),V=s(58423),H=s(3949),W=s(94373),K={name:"RouteView",data(){return{searchQueryStart:"",searchQueryEnd:"",selectedResultStart:null,selectedResultEnd:null,searchResults:[],searchResultsEnd:[],isLoading:!1,totalHours:0,totalMinutes:0,totalDistance:"0千米",selectedDate:"",selectedTime:""}},mounted(){this.initMap(),this.$route.query.start&&this.$route.query.end&&(this.selectedResultStart=JSON.parse(this.$route.query.start),this.selectedResultEnd=JSON.parse(this.$route.query.end)),this.parseUrlParams(),this.selectedDate=(new Date).toISOString().substring(0,10),this.selectedTime=(new Date).toISOString().substring(11,16),this.updateTime(),setInterval((()=>{this.updateTime()}),6e4)},methods:{updateTime(){const e=new Date;this.selectedTime=`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},clc1(){this.searchQueryStart=""},clc2(){this.searchQueryEnd=""},swap(){const e=this.searchQueryStart;this.searchQueryStart=this.searchQueryEnd,this.searchQueryEnd=e;const t=this.selectedResultStart;this.selectedResultStart=this.selectedResultEnd,this.selectedResultEnd=t,this.onSearch()},parseUrlParams(){const e=new URLSearchParams(window.location.search),t=e.get("start"),s=e.get("end");if(t)try{const e=JSON.parse(decodeURIComponent(t));e&&e.address&&(this.searchQueryStart=e.name)}catch(a){console.error("Error parsing start parameter:",a)}if(s)try{const e=JSON.parse(decodeURIComponent(s));e&&e.address&&(this.searchQueryEnd=e.name)}catch(a){console.error("Error parsing end parameter:",a)}},onSearchInputChange(e,t){const s=e.target.value,a=t?"searchResults":"searchResultsEnd";s.includes("'")?console.log("输入法临时输入，不发送请求"):s.length>=2?fetch("http://112.125.122.56/sun-glare-project/api/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({searchQueryStart:s})}).then((e=>e.json())).then((e=>{this[a]=e})).catch((e=>{console.error("错误:",e)})):this[a]=[]},selectResult(e,t=!0){console.log("用户选择了搜索结果:",e);const s={name:e.name,address:e.address,wgs84_latitude:e.wgs84_latitude,wgs84_longitude:e.wgs84_longitude,location:[e.wgs84_longitude,e.wgs84_latitude],baidu_index:e.baidu_index,baidu_latitude:e.baidu_latitude,baidu_longitude:e.baidu_longitude,id:e.id,label:e.label};let a=this.selectedResultStart?JSON.stringify(this.selectedResultStart):null,i=this.selectedResultEnd?JSON.stringify(this.selectedResultEnd):null;t?(this.selectedResultStart=s,this.searchQueryStart=s.name,this.searchResults=[],a=JSON.stringify(s)):(this.selectedResultEnd=s,this.searchQueryEnd=s.name,this.searchResultsEnd=[],i=JSON.stringify(s)),this.$router.push({path:"/lu-jing-gui-hua/Intermediate-page",query:{start:a,end:i,t:Date.now()}})},onSearch(){if(this.selectedResultStart&&this.selectedResultEnd){this.isLoading=!0;const e={...this.selectedResultStart,location:[this.selectedResultStart.wgs84_longitude,this.selectedResultStart.wgs84_latitude]},t={...this.selectedResultEnd,location:[this.selectedResultEnd.wgs84_longitude,this.selectedResultEnd.wgs84_latitude]};W.A.post("http://112.125.122.56/sun-glare-project/api/route/plan",{start:e,end:t}).then((s=>{const a=s.data.id;console.log("路径规划结果ID:",a),this.isLoading=!1,this.$router.push({path:"/lu-jing-gui-hua/route",query:{start:JSON.stringify(e),end:JSON.stringify(t),id:a}}),this.drawRoute(e,t),this.initMap()})).catch((e=>{console.error(e),this.isLoading=!1,alert("路径规划失败，请稍后再试。")}))}else alert("请确保起点和终点都已选择。")},initMap(){const e=new X.A({basemap:"tianditu-vector"});this.view=new Z.A({container:"viewDiv",map:e,center:[114.3,30.7],zoom:4,constraints:{geometry:{type:"extent",xmin:113.6,ymin:29.9,xmax:115,ymax:31.3},minScale:500,maxScale:2e6,rotationEnabled:!1,snapToZoom:!1}}),this.view.ui.move("zoom","bottom-left");const t=new V.A;e.add(t),this.drawPoints(t),this.drawRoute(e)},drawPoints(e){if(!this.$route.query.start||!this.$route.query.end)return void console.error("Start or end point is undefined.");const t=JSON.parse(this.$route.query.start),s=JSON.parse(this.$route.query.end);if(!t.location||!s.location)return void console.error("Start or end point does not have a location.");const a=new G.A({longitude:t.location[0],latitude:t.location[1]}),i=new G.A({longitude:s.location[0],latitude:s.location[1]}),l=new F.A({geometry:a,symbol:{type:"simple-marker",color:"red",size:"20px"},popupTemplate:{title:"起点信息",content:[{type:"fields",fieldInfos:[{fieldName:"address",label:"地址"},{fieldName:"name",label:"名称"},{fieldName:"wgs84_latitude",label:"WGS84纬度"},{fieldName:"wgs84_longitude",label:"WGS84经度"},{fieldName:"baidu_index",label:"百度索引"},{fieldName:"baidu_latitude",label:"百度纬度"},{fieldName:"baidu_longitude",label:"百度经度"},{fieldName:"id",label:"ID"},{fieldName:"label",label:"标签"}]}]},attributes:t}),n=new F.A({geometry:i,symbol:{type:"simple-marker",color:"green",size:"20px"},popupTemplate:{title:"终点信息",content:[{type:"fields",fieldInfos:[{fieldName:"address",label:"地址"},{fieldName:"name",label:"名称"},{fieldName:"wgs84_latitude",label:"WGS84纬度"},{fieldName:"wgs84_longitude",label:"WGS84经度"},{fieldName:"baidu_index",label:"百度索引"},{fieldName:"baidu_latitude",label:"百度纬度"},{fieldName:"baidu_longitude",label:"百度经度"},{fieldName:"id",label:"ID"},{fieldName:"label",label:"标签"}]}]},attributes:s});e.addMany([l,n])},drawRoute(e){const t=this.$route.query.id;if(!t)return void console.error("Route ID is undefined.");const s=`http://112.125.122.56/sun-glare-project/api/get_geojson/${t}`;fetch(s).then((e=>e.json())).then((t=>{let s=0,a=0;const i=new H["default"]({source:t.features.map(((e,t)=>(s+=e.properties.length,a+=e.properties.cost,{geometry:{type:"polyline",paths:e.geometry.coordinates},attributes:{...e.properties,id:t}}))),renderer:{type:"simple",symbol:{type:"simple-line",color:[0,0,255],width:3}},objectIdField:"id",fields:[{name:"id",type:"oid"},{name:"seq",type:"integer"},{name:"path_seq",type:"integer"},{name:"node",type:"integer"},{name:"edge",type:"integer"},{name:"cost",type:"double"},{name:"agg_cost",type:"double"},{name:"length",type:"double"}]});e.layers.add(i),this.totalHours=Math.floor(a/3600),this.totalMinutes=Math.floor(a%3600/60),this.totalDistance=s<1e3?`${s.toFixed(2)}米`:`${(s/1e3).toFixed(2)}千米`})).catch((e=>console.error("Error loading the geojson file:",e)))}}},Y=s(71241);const B=(0,Y.A)(K,[["render",P]]);var ee=B},58423:function(e,t,s){s.d(t,{A:function(){return p}});var a=s(71457),i=s(76543),l=(s(37679),s(69292),s(51020),s(29916)),n=s(46626),r=s(71680),o=s(79366),d=s(99024),c=s(41341),u=s(9693);let h=class extends((0,o.d)((0,d.j)(r.A))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new c.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,a._)([(0,i.MZ)({type:u.A})],h.prototype,"elevationInfo",void 0),(0,a._)([(0,i.MZ)((0,n.C)(c.Y,"graphics"))],h.prototype,"graphics",void 0),(0,a._)([(0,i.MZ)({type:["show","hide"]})],h.prototype,"listMode",void 0),(0,a._)([(0,i.MZ)()],h.prototype,"screenSizePerspectiveEnabled",void 0),(0,a._)([(0,i.MZ)({readOnly:!0})],h.prototype,"type",void 0),(0,a._)([(0,i.MZ)({constructOnly:!0})],h.prototype,"internal",void 0),h=(0,a._)([(0,l.$)("geoscene.layers.GraphicsLayer")],h);const p=h}}]);
//# sourceMappingURL=lu-jing-gui-hua-route.3e4b28d9.js.map