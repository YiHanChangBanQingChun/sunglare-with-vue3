{"version":3,"file":"js/3617.cdead1d3.js","mappings":"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","sources":["webpack://sun-glare-project/./node_modules/@geoscene/core/layers/support/StreamConnection.js","webpack://sun-glare-project/./node_modules/@geoscene/core/layers/graphics/sources/connections/WebSocketConnection.js","webpack://sun-glare-project/./node_modules/@geoscene/core/layers/graphics/sources/connections/GeoEventConnection.js","webpack://sun-glare-project/./node_modules/@geoscene/core/layers/support/ClientSideConnection.js","webpack://sun-glare-project/./node_modules/@geoscene/core/layers/graphics/sources/connections/createConnection.js","webpack://sun-glare-project/./node_modules/@geoscene/core/rest/operations/urlUtils.js","webpack://sun-glare-project/./node_modules/@geoscene/core/rest/query/operations/query.js"],"sourcesContent":["/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Error.js\";import o from\"../../core/Evented.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";let c=class extends o.EventedAccessor{destroy(){this.emit(\"destroy\")}get connectionError(){return this.errorString?new e(\"stream-connection\",this.errorString):null}onFeature(r){this.emit(\"data-received\",r)}onMessage(r){this.emit(\"message-received\",r)}};r([s({readOnly:!0})],c.prototype,\"connectionError\",null),c=r([t(\"geoscene.layers.support.StreamConnection\")],c);const i=c;export{i as default};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Error.js\";import o from\"../../../../core/Logger.js\";import{after as s,createResolver as r}from\"../../../../core/promiseUtils.js\";import{addQueryParameters as n}from\"../../../../core/urlUtils.js\";import{property as i}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import{subclass as c}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{getGeometryZScaler as a}from\"../../../../geometry/support/zscale.js\";import l from\"../../../support/StreamConnection.js\";var h;!function(e){e[e.CONNECTING=0]=\"CONNECTING\",e[e.OPEN=1]=\"OPEN\",e[e.CLOSING=2]=\"CLOSING\",e[e.CLOSED=3]=\"CLOSED\"}(h||(h={}));let d=class extends l{constructor(e){super(),this._outstandingMessages=[],this.errorString=null;const{geometryType:t,spatialReference:o,sourceSpatialReference:s}=e;this._config=e,this._featureZScaler=a(t,s,o),this._open()}async _open(){await this._tryCreateWebSocket(),this.destroyed||await this._handshake()}destroy(){super.destroy(),null!=this._websocket&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null}get connectionStatus(){if(null==this._websocket)return\"disconnected\";switch(this._websocket.readyState){case h.CONNECTING:case h.OPEN:return\"connected\";case h.CLOSING:case h.CLOSED:return\"disconnected\"}}sendMessageToSocket(e){null!=this._websocket?this._websocket.send(JSON.stringify(e)):this._outstandingMessages.push(e)}sendMessageToClient(e){this._onMessage(e)}updateCustomParameters(e){this._config.customParameters=e,null!=this._websocket&&this._websocket.close()}async _tryCreateWebSocket(e=this._config.source.path,r=1e3,i=0){try{if(this.destroyed)return;const t=n(e,this._config.customParameters??{});this._websocket=await this._createWebSocket(t),this.notifyChange(\"connectionStatus\")}catch(c){const n=r/1e3;return this._config.maxReconnectionAttempts&&i>=this._config.maxReconnectionAttempts?(o.getLogger(this).error(new t(\"websocket-connection\",\"Exceeded maxReconnectionAttempts attempts. No further attempts will be made\")),void this.destroy()):(o.getLogger(this).error(new t(\"websocket-connection\",`Failed to connect. Attempting to reconnect in ${n}s`,c)),await s(r),this._tryCreateWebSocket(e,Math.min(1.5*r,1e3*this._config.maxReconnectionInterval),i+1))}}_setWebSocketJSONParseHandler(e){e.onmessage=e=>{try{const t=JSON.parse(e.data);this._onMessage(t)}catch(s){return void o.getLogger(this).error(new t(\"websocket-connection\",\"Failed to parse message, invalid JSON\",{error:s}))}}}_createWebSocket(e){return new Promise(((t,o)=>{const s=new WebSocket(e);s.onopen=()=>{if(s.onopen=null,this.destroyed)return s.onclose=null,void s.close();s.onclose=e=>this._onClose(e),s.onerror=e=>this._onError(e),this._setWebSocketJSONParseHandler(s),t(s)},s.onclose=e=>{s.onopen=s.onclose=null,o(e)}}))}async _handshake(e=1e4){const s=this._websocket;if(null==s)return;const n=r(),i=s.onmessage,{filter:c,outFields:a,spatialReference:l}=this._config;return n.timeout(e),s.onmessage=e=>{let r=null;try{r=JSON.parse(e.data)}catch(h){}r&&\"object\"==typeof r||(o.getLogger(this).error(new t(\"websocket-connection\",\"Protocol violation. Handshake failed - malformed message\",e.data)),n.reject(),this.destroy()),r.spatialReference?.wkid!==l?.wkid&&(o.getLogger(this).error(new t(\"websocket-connection\",`Protocol violation. Handshake failed - expected wkid of ${l.wkid}`,e.data)),n.reject(),this.destroy()),\"json\"!==r.format&&(o.getLogger(this).error(new t(\"websocket-connection\",\"Protocol violation. Handshake failed - format is not set\",e.data)),n.reject(),this.destroy()),c&&r.filter!==c&&o.getLogger(this).error(new t(\"websocket-connection\",\"Tried to set filter, but server doesn't support it\")),a&&r.outFields!==a&&o.getLogger(this).error(new t(\"websocket-connection\",\"Tried to set outFields, but server doesn't support it\")),s.onmessage=i;for(const t of this._outstandingMessages)s.send(JSON.stringify(t));this._outstandingMessages=[],n.resolve()},s.send(JSON.stringify({filter:c,outFields:a,format:\"json\",spatialReference:{wkid:l.wkid}})),n.promise}_onMessage(e){if(this.onMessage(e),\"type\"in e)switch(e.type){case\"features\":case\"featureResult\":for(const t of e.features)null!=this._featureZScaler&&this._featureZScaler(t.geometry),this.onFeature(t)}}_onError(e){const t=\"Encountered an error over WebSocket connection\";this._set(\"errorString\",t),o.getLogger(this).error(\"websocket-connection\",t)}_onClose(e){this._websocket=null,this.notifyChange(\"connectionStatus\"),1e3!==e.code&&o.getLogger(this).error(\"websocket-connection\",`WebSocket closed unexpectedly with error code ${e.code}`),this.destroyed||this._open()}};e([i()],d.prototype,\"connectionStatus\",null),e([i()],d.prototype,\"errorString\",void 0),d=e([c(\"geoscene.layers.graphics.sources.connections.WebSocketConnection\")],d);export{d as WebSocketConnection};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../geometry.js\";import t from\"../../../../request.js\";import r from\"../../../../core/Error.js\";import s from\"../../../../core/Logger.js\";import{createResolver as o}from\"../../../../core/promiseUtils.js\";import{addQueryParameters as i}from\"../../../../core/urlUtils.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{WebSocketConnection as a}from\"./WebSocketConnection.js\";import{executeQuery as c}from\"../../../../rest/query/operations/query.js\";import u from\"../../../../rest/support/Query.js\";import{fromJSON as l}from\"../../../../geometry/support/jsonUtils.js\";import f from\"../../../../geometry/SpatialReference.js\";const h=1e4,d={maxQueryDepth:5,maxRecordCountFactor:3};let g=class extends a{constructor(e){super({...d,...e}),this._buddyServicesQuery=null,this._relatedFeatures=null}async _open(){const e=await this._fetchServiceDefinition(this._config.source);e.timeInfo.trackIdField||s.getLogger(this).warn(\"GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.\");const t=this._fetchWebSocketUrl(e.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),await this._buddyServicesQuery,await this._tryCreateWebSocket(t);const{filter:r,outFields:o}=this._config;this.destroyed||this._setFilter(r,o)}_onMessage(e){if(\"attributes\"in e){let o;try{o=this._enrich(e),null!=this._featureZScaler&&this._featureZScaler(o.geometry)}catch(t){return void s.getLogger(this).error(new r(\"geoevent-connection\",\"Failed to parse message\",t))}this.onFeature(o)}else this.onMessage(e)}async _fetchServiceDefinition(e){const r={f:\"json\",...this._config.customParameters},s=t(e.path,{query:r,responseType:\"json\"}),o=(await s).data;return this._serviceDefinition=o,o}_fetchWebSocketUrl(e,t){const r=e[0],{urls:s,token:o}=r,n=this._inferWebSocketBaseUrl(s);return i(`${n}/subscribe`,{outSR:\"\"+t.wkid,token:o})}_inferWebSocketBaseUrl(e){if(1===e.length)return e[0];for(const t of e)if(t.includes(\"wss\"))return t;return s.getLogger(this).error(new r(\"geoevent-connection\",\"Unable to infer WebSocket url\",e)),null}async _setFilter(e,t){const i=this._websocket;if(null==i||null==e&&null==t)return;const n=JSON.stringify({filter:this._serializeFilter(e,t)});let a=!1;const c=o(),u=()=>{a||(this.destroyed||this._websocket!==i||s.getLogger(this).error(new r(\"geoevent-connection\",\"Server timed out when setting filter\")),c.reject())},l=e=>{const t=JSON.parse(e.data);t.filter&&(t.error&&(s.getLogger(this).error(new r(\"geoevent-connection\",\"Failed to set service filter\",t.error)),this._set(\"errorString\",`Could not set service filter - ${t.error}`),c.reject(t.error)),this._setWebSocketJSONParseHandler(i),a=!0,c.resolve())};return i.onmessage=l,i.send(n),setTimeout(u,h),c.promise}_serializeFilter(e,t){const o={};if(null==e&&null==t)return o;if(null!=e&&e.geometry)try{const t=l(e.geometry);if(\"extent\"!==t.type)throw new r(`Expected extent but found type ${t.type}`);o.geometry=JSON.stringify(t.shiftCentralMeridian())}catch(i){s.getLogger(this).error(new r(\"geoevent-connection\",\"Encountered an error when setting connection geometryDefinition\",i))}return null!=e&&e.where&&\"1 = 1\"!==e.where&&\"1=1\"!==e.where&&(o.where=e.where),null!=t&&(o.outFields=t.join(\",\")),o}_enrich(e){if(!this._relatedFeatures)return e;const t=this._serviceDefinition.relatedFeatures.joinField,o=e.attributes[t],i=this._relatedFeatures.get(o);if(!i)return s.getLogger(this).warn(\"geoevent-connection\",\"Feature join failed. Is the join field configured correctly?\",e),e;const{attributes:n,geometry:a}=i;for(const r in n)e.attributes[r]=n[r];return a&&(e.geometry=a),e.geometry||e.centroid||s.getLogger(this).error(new r(\"geoevent-connection\",\"Found malformed feature - no geometry found\",e)),e}async _queryBuddyServices(){try{const{relatedFeatures:e,keepLatestArchive:t}=this._serviceDefinition,r=this._queryRelatedFeatures(e),s=this._queryArchive(t);await r;const o=await s;if(!o)return;for(const i of o.features)this.onFeature(this._enrich(i))}catch(e){s.getLogger(this).error(new r(\"geoevent-connection\",\"Encountered an error when querying buddy services\",{error:e}))}}async _queryRelatedFeatures(e){if(!e)return;const t=await this._queryBuddy(e.featuresUrl);this._addRelatedFeatures(t)}async _queryArchive(e){if(e)return this._queryBuddy(e.featuresUrl)}async _queryBuddy(e){const t=new((await import(\"../../../FeatureLayer.js\")).default)({url:e}),{capabilities:r}=await t.load(),s=r.query.supportsMaxRecordCountFactor,o=r.query.supportsPagination,i=r.query.supportsCentroid,n=this._config.maxRecordCountFactor,a=t.capabilities.query.maxRecordCount,l=s?a*n:a,h=new u;if(h.outFields=this._config.outFields??[\"*\"],h.where=this._config.filter?.where??\"1=1\",h.returnGeometry=!0,h.returnExceededLimitFeatures=!0,h.outSpatialReference=f.fromJSON(this._config.spatialReference),i&&(h.returnCentroid=!0),s&&(h.maxRecordCountFactor=n),o)return h.num=l,t.destroy(),this._queryPages(e,h);const d=await c(e,h,this._config.sourceSpatialReference);return t.destroy(),d.data}async _queryPages(e,t,r=[],s=0){t.start=null!=t.num?s*t.num:null;const{data:o}=await c(e,t,this._config.sourceSpatialReference);return o.exceededTransferLimit&&s<(this._config.maxQueryDepth??0)?(o.features.forEach((e=>r.push(e))),this._queryPages(e,t,r,s+1)):(r.forEach((e=>o.features.push(e))),o)}_addRelatedFeatures(e){const t=new Map,r=e.features,s=this._serviceDefinition.relatedFeatures.joinField;for(const o of r){const e=o.attributes[s];t.set(e,o)}this._relatedFeatures=t}};g=e([n(\"geoscene.layers.graphics.sources.connections.GeoEventConnection\")],g);const y=g;export{y as default};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import{getGeometryZScaler as o}from\"../../geometry/support/zscale.js\";import s from\"./StreamConnection.js\";let c=class extends s{constructor(e){super(),this.connectionStatus=\"connected\",this.errorString=null;const{geometryType:r,spatialReference:t,sourceSpatialReference:s}=e;this._featureZScaler=o(r,s,t)}updateCustomParameters(e){}sendMessageToSocket(e){}sendMessageToClient(e){if(\"type\"in e)switch(e.type){case\"features\":case\"featureResult\":for(const r of e.features)null!=this._featureZScaler&&this._featureZScaler(r.geometry),this.onFeature(r)}this.onMessage(e)}};e([r()],c.prototype,\"connectionStatus\",void 0),e([r()],c.prototype,\"errorString\",void 0),c=e([t(\"geoscene.layers.support.ClientSideConnection\")],c);export{c as ClientSideConnection};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport e from\"./GeoEventConnection.js\";import{WebSocketConnection as t}from\"./WebSocketConnection.js\";import{ClientSideConnection as n}from\"../../../support/ClientSideConnection.js\";function o(o,r,s,i,c,a,m,p){const f={source:o,sourceSpatialReference:r,spatialReference:s,geometryType:i,filter:c,maxReconnectionAttempts:a,maxReconnectionInterval:m,customParameters:p};if(!o)return new n(f);return o.path.startsWith(\"wss://\")||o.path.startsWith(\"ws://\")?new t(f):new e(f)}export{o as createConnection};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nfunction t(n){const o={};for(const e in n){if(\"declaredClass\"===e)continue;const r=n[e];if(null!=r&&\"function\"!=typeof r)if(Array.isArray(r)){o[e]=[];for(let n=0;n<r.length;n++)o[e][n]=t(r[n])}else\"object\"==typeof r?r.toJSON&&(o[e]=JSON.stringify(r)):o[e]=r}return o}export{t as mapParameters};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport t from\"../../../request.js\";import{urlToObject as e,join as n}from\"../../../core/urlUtils.js\";import{getJsonType as r}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as i}from\"../../../geometry/support/normalizeUtils.js\";import{mapParameters as a}from\"../../operations/urlUtils.js\";import{parsePBFFeatureQuery as o}from\"./pbfQueryUtils.js\";import{applyFeatureSetZUnitScaling as u}from\"./queryZScale.js\";const l=\"Layer does not support extent calculation.\";function s(t,e){if(e&&\"extent\"===t.type)return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&\"point\"===t.type)return`${t.x},${t.y}`;const n=t.toJSON();return delete n.spatialReference,JSON.stringify(n)}function y(t,e){const n=t.geometry,i=t.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const a=i;let o,u,l;if(null!=n&&(u=n.spatialReference,l=n.spatialReference.wkid||JSON.stringify(n.spatialReference),a.geometryType=r(n),a.geometry=s(n,t.compactGeometryEnabled),a.inSR=l),i.groupByFieldsForStatistics&&(a.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(\",\")),i.objectIds&&(a.objectIds=i.objectIds.join(\",\")),i.orderByFields&&(a.orderByFields=i.orderByFields.join(\",\")),!i.outFields||!i.returnDistinctValues&&(e?.returnCountOnly||e?.returnExtentOnly||e?.returnIdsOnly)?delete a.outFields:i.outFields.includes(\"*\")?a.outFields=\"*\":a.outFields=i.outFields.join(\",\"),i.outSR?(a.outSR=i.outSR.wkid||JSON.stringify(i.outSR),o=t.outSpatialReference):n&&(i.returnGeometry||i.returnCentroid)&&(a.outSR=a.inSR,o=u),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(a.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(a.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(a.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&null!=u&&null!=t.quantizationParameters&&null!=t.quantizationParameters.extent&&u.equals(t.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,a.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(a.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(a.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(a.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const t=i.timeExtent,{start:e,end:n}=t;null==e&&null==n||(a.time=e===n?e:`${e??\"null\"},${n??\"null\"}`),delete i.timeExtent}return t.defaultSpatialReferenceEnabled&&null!=u&&null!=o&&u.equals(o)&&(a.defaultSR=a.inSR,delete a.inSR,delete a.outSR),a}async function m(t,e,n,r){const i=null!=e.timeExtent&&e.timeExtent.isEmpty?{data:{features:[]}}:await x(t,e,\"json\",r);return u(e,n,i.data),i}async function c(t,e,n,r){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:n.createFeatureResult()};const i=await f(t,e,r),a=i;return a.data=o(i.data,n),a}function f(t,e,n){return x(t,e,\"pbf\",n)}function d(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):x(t,e,\"json\",n,{returnIdsOnly:!0})}function p(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):x(t,e,\"json\",n,{returnIdsOnly:!0,returnCountOnly:!0})}async function S(t,e,n){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:{count:0,extent:null}};const r=await x(t,e,\"json\",n,{returnExtentOnly:!0,returnCountOnly:!0}),i=r.data;if(i.hasOwnProperty(\"extent\"))return r;if(i.features)throw new Error(l);if(i.hasOwnProperty(\"count\"))throw new Error(l);return r}async function x(r,o,u,l={},s={}){const m=\"string\"==typeof r?e(r):r,c=o.geometry?[o.geometry]:[];l.responseType=\"pbf\"===u?\"array-buffer\":\"json\";const f=await i(c,null,l),d=f&&f[0];null!=d&&((o=o.clone()).geometry=d);const p=a({...m.query,f:u,...s,...y(o,s)});return t(n(m.path,E(o,s)?\"query3d\":\"query\"),{...l,query:{...p,...l.query}})}function E(t,e){return null!=t.formatOf3DObjects&&!(e.returnCountOnly||e.returnExtentOnly||e.returnIdsOnly)}export{s as encodeGeometry,m as executeQuery,p as executeQueryForCount,S as executeQueryForExtent,d as executeQueryForIds,c as executeQueryPBF,f as executeQueryPBFBuffer,y as queryToQueryStringParameters,x as runQuery};"],"names":["c","o","EventedAccessor","destroy","this","emit","connectionError","errorString","e","onFeature","r","onMessage","s","readOnly","prototype","t","i","h","CONNECTING","OPEN","CLOSING","CLOSED","d","l","constructor","super","_outstandingMessages","geometryType","spatialReference","sourceSpatialReference","_config","_featureZScaler","a","_open","_tryCreateWebSocket","destroyed","_handshake","_websocket","onopen","onclose","onerror","onmessage","close","connectionStatus","readyState","sendMessageToSocket","send","JSON","stringify","push","sendMessageToClient","_onMessage","updateCustomParameters","customParameters","source","path","n","_createWebSocket","notifyChange","maxReconnectionAttempts","getLogger","error","Math","min","maxReconnectionInterval","_setWebSocketJSONParseHandler","parse","data","Promise","WebSocket","_onClose","_onError","filter","outFields","timeout","reject","wkid","format","resolve","promise","type","features","geometry","_set","code","maxQueryDepth","maxRecordCountFactor","g","_buddyServicesQuery","_relatedFeatures","_fetchServiceDefinition","timeInfo","trackIdField","warn","_fetchWebSocketUrl","streamUrls","_queryBuddyServices","_setFilter","_enrich","f","query","responseType","_serviceDefinition","urls","token","_inferWebSocketBaseUrl","outSR","length","includes","_serializeFilter","u","setTimeout","shiftCentralMeridian","where","join","relatedFeatures","joinField","attributes","get","centroid","keepLatestArchive","_queryRelatedFeatures","_queryArchive","_queryBuddy","featuresUrl","_addRelatedFeatures","default","url","capabilities","load","supportsMaxRecordCountFactor","supportsPagination","supportsCentroid","maxRecordCount","returnGeometry","returnExceededLimitFeatures","outSpatialReference","fromJSON","returnCentroid","num","_queryPages","start","exceededTransferLimit","forEach","Map","set","y","m","p","startsWith","Array","isArray","toJSON","xmin","ymin","xmax","ymax","x","compactGeometryEnabled","defaultSpatialReferenceEnabled","inSR","groupByFieldsForStatistics","objectIds","orderByFields","returnDistinctValues","returnCountOnly","returnExtentOnly","returnIdsOnly","outStatistics","fullText","pixelSize","quantizationParameters","extent","equals","parameterValues","rangeValues","dynamicDataSource","layer","timeExtent","end","time","defaultSR","async","isEmpty","createFeatureResult","count","S","hasOwnProperty","Error","clone","E","formatOf3DObjects"],"sourceRoot":""}