"use strict";(self["webpackChunksun_glare_project"]=self["webpackChunksun_glare_project"]||[]).push([[2854],{4767:function(e,t,s){s.r(t),s.d(t,{default:function(){return P}});var a=s(56768),i=s(45130),n=s(24232);const l={class:"lu-jing-gui-hua"},r={class:"search-containers"},h={class:"revert-containers"},c=(0,a.Lk)("div",{class:"car"},[(0,a.Lk)("img",{src:"https://wx3.sinaimg.cn/orj360/008tIcISgy1hsgyr8gzsjj300o00odfl.jpg"})],-1),d={class:"swap-action"},o=(0,a.Lk)("img",{src:"https://wx1.sinaimg.cn/orj360/008tIcISgy1hsiz7qtw48j301s01sq2p.jpg",alt:"revert",style:{width:"22px",height:"25px"}},null,-1),u=[o],g={class:"search-container start"},p=(0,a.Lk)("div",{class:"search-icon-wrapper"},[(0,a.Lk)("img",{src:"https://wx1.sinaimg.cn/orj360/008tIcISgy1hsgyr8gv8dj300f00f0oh.jpg",alt:"pink"})],-1),m={class:"search-box-img"},k=(0,a.Lk)("img",{src:"https://wx2.sinaimg.cn/orj360/008tIcISgy1hsnss2ckv4j300k00k0m1.jpg",alt:"delete1"},null,-1),w=[k],y={key:0,class:"search-results",ref:"searchResultsStart"},v=["onClick"],S={class:"search-container end"},b=(0,a.Lk)("div",{class:"search-icon-wrapper"},[(0,a.Lk)("img",{src:"https://wx4.sinaimg.cn/orj360/008tIcISgy1hsgyr8got8j300f00f0o9.jpg",alt:"green"})],-1),f={class:"search-box-img"},I=(0,a.Lk)("img",{src:"https://wx2.sinaimg.cn/orj360/008tIcISgy1hsnss2ckv4j300k00k0m1.jpg",alt:"delete1"},null,-1),R=[I],x={key:0,class:"search-results",ref:"searchResultsEnd"},E=["onClick"],L=(0,a.Lk)("img",{src:"https://wx4.sinaimg.cn/mw2000/008tIcISgy1hsq1fw9ob9j300w00w3ya.jpg",alt:"search"},null,-1),D=[L],C=(0,a.Lk)("div",{id:"viewDiv"},null,-1),j={key:0,class:"maploader-overlay"},T=(0,a.Lk)("div",{class:"maploader"},null,-1),_=[T],Q={class:"main-container"},$={class:"choose-time"},q={class:"form-group"},J=(0,a.Lk)("label",{for:"date-input"},"选择日期：",-1),N=["min","max"],O=(0,a.Lk)("label",{for:"time-input"},"选择时间：",-1);function V(e,t,s,o,k,I){return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",l,[(0,a.Lk)("div",r,[(0,a.Lk)("div",h,[c,(0,a.Lk)("div",d,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...t)=>e.swap&&e.swap(...t)),title:"切换起终点"},u)])]),(0,a.Lk)("div",g,[p,(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>k.searchQueryStart=e),onInput:t[2]||(t[2]=e=>I.onSearchInputChange(e,!0)),placeholder:"请输入起点",class:"search-box search-box-start"},null,544),[[i.Jo,k.searchQueryStart]]),(0,a.Lk)("span",m,[(0,a.Lk)("div",{class:"delete",title:"清空",onClick:t[3]||(t[3]=(...e)=>I.clc1&&I.clc1(...e))},w)]),k.searchResults.length&&k.searchQueryStart?((0,a.uX)(),(0,a.CE)("div",y,[(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(k.searchResults,((e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t,class:(0,n.C4)({highlighted:t===k.highlightedIndex}),onClick:t=>I.selectResult(e,!0)},(0,n.v_)(e.name),11,v)))),128))])],512)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",S,[b,(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>k.searchQueryEnd=e),onInput:t[5]||(t[5]=e=>I.onSearchInputChange(e,!1)),placeholder:"请输入终点",class:"search-box search-box-end"},null,544),[[i.Jo,k.searchQueryEnd]]),(0,a.Lk)("span",f,[(0,a.Lk)("div",{class:"delete",title:"清空",onClick:t[6]||(t[6]=(...e)=>I.clc2&&I.clc2(...e))},R)]),k.searchResultsEnd.length&&k.searchQueryEnd?((0,a.uX)(),(0,a.CE)("div",x,[(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(k.searchResultsEnd,((e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t,class:(0,n.C4)({highlighted:t===k.highlightedIndex}),onClick:t=>I.selectResult(e,!1)},(0,n.v_)(e.name),11,E)))),128))])],512)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",{class:"search-action",onClick:t[7]||(t[7]=(...e)=>I.onSearch&&I.onSearch(...e)),title:"搜索"},D)])]),C,k.ismaploading?((0,a.uX)(),(0,a.CE)("div",j,_)):(0,a.Q3)("",!0),(0,a.Lk)("div",Q,[(0,a.Lk)("div",$,[(0,a.Lk)("div",q,[J,(0,a.bo)((0,a.Lk)("input",{id:"date-input",type:"date","onUpdate:modelValue":t[8]||(t[8]=e=>k.selectedDate=e),min:I.minDate,max:I.maxDate,class:(0,n.C4)({"invalid-date":I.isDateDisabled(k.selectedDate)}),onChange:t[9]||(t[9]=(...e)=>I.handleDateChange&&I.handleDateChange(...e))},null,42,N),[[i.Jo,k.selectedDate]]),O,(0,a.bo)((0,a.Lk)("input",{id:"time-input",type:"time","onUpdate:modelValue":t[10]||(t[10]=e=>I.formattedTime=e),onInput:t[11]||(t[11]=(...e)=>I.onTimeInputChange&&I.onTimeInputChange(...e)),step:"600"},null,544),[[i.Jo,I.formattedTime]])])])])],64)}s(44114);var A=s(7382),M=s(27583),X=s(12790),K=s(3949),U=s(2889),z=s(57829),F=s(95587),H={name:"RouteplanningView",data(){return{searchQueryStart:"",ismaploading:!0,searchQueryEnd:"",highlightedIndex:-1,searchResults:[],searchResultsEnd:[],selectedResultStart:null,selectedResultEnd:null,selectedDate:"",selectedTime:""}},mounted(){this.initMap(),this.selectedDate=(new Date).toISOString().substring(0,10),this.selectedTime=(new Date).toISOString().substring(11,16),this.updateTime(),setInterval((()=>{this.updateTime()}),6e4),window.addEventListener("keydown",this.handleKeydown)},beforeUnmount(){window.removeEventListener("keydown",this.handleKeydown)},computed:{minDate(){return"2024-01-01"},maxDate(){return"2024-12-31"},formattedTime(){if(!this.selectedTime)return"";const[e,t]=this.selectedTime.split(":").map(Number),s=10*Math.floor(t/10);return`${String(e).padStart(2,"0")}:${String(s).padStart(2,"0")}`}},methods:{onTimeInputChange(e){const t=e.target.value,[s,a]=t.split(":").map(Number),i=10*Math.floor(a/10);this.selectedTime=`${String(s).padStart(2,"0")}:${String(i).padStart(2,"0")}`},isDateDisabled(e){if(!e)return!1;const t=new Date(e),s=t.getMonth()+1,a=t.getDate();return s>=1&&s<=7&&15!==a||(8===s&&a<=20||s>=10&&s<=12&&15!==a)},handleDateChange(e){const t=e.target.value;this.isDateDisabled(t)&&(alert("选择的日期未进行模拟，请选择其他日期。可选日期为，1-7月的15日，8月20日-9月30日，10-12月的15日。"),this.selectedDate="")},handleKeydown(e){if(this.searchResults.length&&this.searchQueryStart)switch(e.key){case"Escape":this.searchResults=[];break;case"Tab":e.preventDefault(),this.highlightedIndex=(this.highlightedIndex+1)%this.searchResults.length,(0,a.dY)((()=>{const e=this.$refs.searchResultsStart.querySelector("li.highlighted");e&&e.scrollIntoView({block:"nearest",behavior:"smooth"})}));break;case"Enter":this.highlightedIndex>=0&&this.highlightedIndex<this.searchResults.length&&this.selectResult(this.searchResults[this.highlightedIndex],!0);break}else if(this.searchResultsEnd.length&&this.searchQueryEnd)switch(e.key){case"Escape":this.searchResultsEnd=[];break;case"Tab":e.preventDefault(),this.highlightedIndex=(this.highlightedIndex+1)%this.searchResultsEnd.length,(0,a.dY)((()=>{const e=this.$refs.searchResultsEnd.querySelector("li.highlighted");e&&e.scrollIntoView({block:"nearest",behavior:"smooth"})}));break;case"Enter":this.highlightedIndex>=0&&this.highlightedIndex<this.searchResultsEnd.length&&this.selectResult(this.searchResultsEnd[this.highlightedIndex],!1);break}},updateTime(){const e=new Date;this.selectedTime=`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},clc1(){this.searchQueryStart=""},clc2(){this.searchQueryEnd=""},initMap(){const e=new A.A({basemap:"tianditu-vector"}),t=new X.A({wkid:4326}),s=U.A.create({spatialReference:t,numLODs:32});this.createMapView(e,s)},onSearchInputChange(e,t){const s=e.target.value,a=t?"searchResults":"searchResultsEnd";s.includes("'")?console.log("输入法临时输入，不发送请求"):s.length>=2?fetch("http://112.125.122.56/sun-glare-project/api/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({searchQueryStart:s})}).then((e=>e.json())).then((e=>{this[a]=e})).catch((e=>{console.error("错误:",e)})):this[a]=[]},selectResult(e,t=!0){console.log("用户选择了搜索结果:",e);const s={name:e.name,address:e.address,wgs84_latitude:e.wgs84_latitude,wgs84_longitude:e.wgs84_longitude,location:[e.wgs84_longitude,e.wgs84_latitude],baidu_index:e.baidu_index,baidu_latitude:e.baidu_latitude,baidu_longitude:e.baidu_longitude,id:e.id,label:e.label};t?(this.selectedResultStart=s,this.searchQueryStart=s.name,this.searchResults=[],this.$router.push({path:"/lu-jing-gui-hua/intermediate-page",query:{start:JSON.stringify(s),date:this.selectedDate,time:this.selectedTime}})):(this.selectedResultEnd=s,this.searchQueryEnd=s.name,this.searchResultsEnd=[],this.$router.push({path:"/lu-jing-gui-hua/intermediate-page",query:{end:JSON.stringify(s),date:this.selectedDate,time:this.selectedTime}}))},onSearch(){if(this.selectedResultStart&&this.selectedResultEnd){const e={...this.selectedResultStart,location:[this.selectedResultStart.wgs84_longitude,this.selectedResultStart.wgs84_latitude]},t={...this.selectedResultEnd,location:[this.selectedResultEnd.wgs84_longitude,this.selectedResultEnd.wgs84_latitude]};this.$router.push({path:"/lu-jing-gui-hua/result",query:{start:JSON.stringify(e),end:JSON.stringify(t),date:this.selectedDate,time:this.selectedTime}})}else alert("请确保起点和终点都已选择。")},createMapView(e,t){const s=new K["default"]({url:"https://www.geosceneonline.cn/server/rest/services/Hosted/wuhan_village/FeatureServer",renderer:{type:"simple",symbol:{type:"simple-fill",color:[0,0,0,0],outline:{color:[0,0,0,1],width:1}}},popupTemplate:{content:[{type:"fields",fieldInfos:[{fieldName:"县区name",label:"县区名称"}]}]}});e.add(s);const a=new M.A({map:e,center:[114.3,30.7],zoom:4,container:"viewDiv",constraints:{geometry:{type:"extent",xmin:113.6,ymin:29.9,xmax:115,ymax:31.3},minScale:500,maxScale:2e6,rotationEnabled:!1,lods:t.lods,snapToZoom:!1}});a.when((()=>{this.ismaploading=!1}));const i=new z.A({view:a,source:{query:{title:'"Basemaps for Developers" AND owner:geoscenedev'}}}),n=new F.A({view:a});return a.ui.add(i,"bottom-right"),a.ui.move("zoom","bottom-left"),a.ui.add(n,"bottom-left"),a}}},Y=s(71241);const B=(0,Y.A)(H,[["render",V]]);var P=B}}]);
//# sourceMappingURL=lu-jing-gui-hua.0fa64e2d.js.map