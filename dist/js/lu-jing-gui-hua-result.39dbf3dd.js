"use strict";(self["webpackChunksun_glare_project"]=self["webpackChunksun_glare_project"]||[]).push([[4452],{29749:function(e,t,s){s.r(t),s.d(t,{default:function(){return I}});var a=s(56768),r=s(45130),i=s(24232);const l={class:"lu-jing-gui-hua"},n=(0,a.Lk)("div",{class:"text"},[(0,a.Lk)("h1",null,"这个页面是放选中两点后的")],-1),o={class:"search-containers"},d={class:"search-container start"},u={key:0,class:"search-results"},c=["onClick"],h={class:"search-container end"},p={key:0,class:"search-results"},g=["onClick"],y={class:"search-action"},m={key:0,class:"loader-overlay"},b=(0,a.Lk)("div",{class:"loader"},null,-1),f=[b],S=(0,a.Lk)("div",{id:"mapViewDiv",style:{height:"560px"}},null,-1);function v(e,t,s,b,v,_){return(0,a.uX)(),(0,a.CE)("div",l,[n,(0,a.Lk)("div",o,[(0,a.Lk)("div",d,[(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>v.searchQueryStart=e),onInput:t[1]||(t[1]=e=>_.onSearchInputChange(e,!0)),placeholder:"搜索起点...",class:"search-box search-box-start"},null,544),[[r.Jo,v.searchQueryStart]]),v.searchResults.length&&v.searchQueryStart?((0,a.uX)(),(0,a.CE)("div",u,[(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(v.searchResults,((e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t,onClick:t=>_.selectResult(e,!0)},(0,i.v_)(e.name),9,c)))),128))])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",h,[(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>v.searchQueryEnd=e),onInput:t[3]||(t[3]=e=>_.onSearchInputChange(e,!1)),placeholder:"搜索终点...",class:"search-box search-box-end"},null,544),[[r.Jo,v.searchQueryEnd]]),v.searchResultsEnd.length&&v.searchQueryEnd?((0,a.uX)(),(0,a.CE)("div",p,[(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(v.searchResultsEnd,((e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t,onClick:t=>_.selectResult(e,!1)},(0,i.v_)(e.name),9,g)))),128))])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",y,[(0,a.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>_.clcSearch&&_.clcSearch(...e))},"重新选择"),(0,a.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>_.onSearch&&_.onSearch(...e))},"查询路径")]),v.isLoading?((0,a.uX)(),(0,a.CE)("div",m,f)):(0,a.Q3)("",!0)]),S])}s(44114),s(14603),s(47566),s(98721);var _=s(7382),w=s(56906),R=s(11134),k=s(74036),E=s(58423),N=s(94373),C={name:"RouteResultView",data(){return{selectedResultStart:null,selectedResultEnd:null,searchResults:[],searchResultsEnd:[],searchQueryStart:"",searchQueryEnd:"",isLoading:!1}},mounted(){this.initMap(),this.$route.query.start&&this.$route.query.end&&(this.selectedResultStart=JSON.parse(this.$route.query.start),this.selectedResultEnd=JSON.parse(this.$route.query.end)),this.parseUrlParams()},methods:{clcSearch(){this.$router.push("/lu-jing-gui-hua")},parseUrlParams(){const e=new URLSearchParams(window.location.search),t=e.get("start"),s=e.get("end");if(t)try{const e=JSON.parse(decodeURIComponent(t));e&&e.address&&(this.searchQueryStart=e.name)}catch(a){console.error("Error parsing start parameter:",a)}if(s)try{const e=JSON.parse(decodeURIComponent(s));e&&e.address&&(this.searchQueryEnd=e.name)}catch(a){console.error("Error parsing end parameter:",a)}},onSearchInputChange(e,t){const s=e.target.value,a=t?"searchResults":"searchResultsEnd";s.includes("'")?console.log("输入法临时输入，不发送请求"):s.length>=2?fetch("http://127.0.0.1:5000/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({searchQueryStart:s})}).then((e=>e.json())).then((e=>{this[a]=e})).catch((e=>{console.error("错误:",e)})):this[a]=[]},selectResult(e,t=!0){console.log("用户选择了搜索结果:",e);const s={name:e.name,address:e.address,wgs84_latitude:e.wgs84_latitude,wgs84_longitude:e.wgs84_longitude,location:[e.wgs84_longitude,e.wgs84_latitude],baidu_index:e.baidu_index,baidu_latitude:e.baidu_latitude,baidu_longitude:e.baidu_longitude,id:e.id,label:e.label};t?(this.selectedResultStart=s,this.searchQueryStart=s.name,this.searchResults=[],this.$router.push({path:"/lu-jing-gui-hua/intermediate-page",query:{start:JSON.stringify(s)}})):(this.selectedResultEnd=s,this.searchQueryEnd=s.name,this.searchResultsEnd=[],this.$router.push({path:"/lu-jing-gui-hua/intermediate-page",query:{end:JSON.stringify(s)}}))},onSearch(){if(this.selectedResultStart&&this.selectedResultEnd){this.isLoading=!0;const e={...this.selectedResultStart,location:[this.selectedResultStart.wgs84_longitude,this.selectedResultStart.wgs84_latitude]},t={...this.selectedResultEnd,location:[this.selectedResultEnd.wgs84_longitude,this.selectedResultEnd.wgs84_latitude]};N.A.post("http://127.0.0.1:5000/api/route/plan",{start:e,end:t}).then((s=>{const a=s.data.id;console.log("路径规划结果ID:",a),this.isLoading=!1,this.$router.push({path:"/lu-jing-gui-hua/route",query:{start:JSON.stringify(e),end:JSON.stringify(t),id:a}})})).catch((e=>{console.error(e),this.isLoading=!1,alert("路径规划失败，请稍后再试。")}))}else alert("请确保起点和终点都已选择。")},initMap(){const e=new _.A({basemap:"tianditu-vector"});this.view=new w.A({container:"mapViewDiv",map:e,center:[114.3,30.7],zoom:4,constraints:{geometry:{type:"extent",xmin:113.6,ymin:29.9,xmax:115,ymax:31.3},minScale:500,maxScale:2e6,rotationEnabled:!1,snapToZoom:!1}});const t=new E.A;e.add(t),this.drawPoints(t)},drawPoints(e){if(!this.$route.query.start||!this.$route.query.end)return void console.error("Start or end point is undefined.");const t=JSON.parse(this.$route.query.start),s=JSON.parse(this.$route.query.end);if(!t.location||!s.location)return void console.error("Start or end point does not have a location.");const a=new k.A({longitude:t.location[0],latitude:t.location[1]}),r=new k.A({longitude:s.location[0],latitude:s.location[1]}),i=new R.A({geometry:a,symbol:{type:"simple-marker",color:"green",size:"20px"},popupTemplate:{title:"起点信息",content:[{type:"fields",fieldInfos:[{fieldName:"address",label:"地址"},{fieldName:"name",label:"名称"},{fieldName:"wgs84_latitude",label:"WGS84纬度"},{fieldName:"wgs84_longitude",label:"WGS84经度"},{fieldName:"baidu_index",label:"百度索引"},{fieldName:"baidu_latitude",label:"百度纬度"},{fieldName:"baidu_longitude",label:"百度经度"},{fieldName:"id",label:"ID"},{fieldName:"label",label:"标签"}]}]},attributes:t}),l=new R.A({geometry:r,symbol:{type:"simple-marker",color:"red",size:"20px"},popupTemplate:{title:"起点信息",content:[{type:"fields",fieldInfos:[{fieldName:"address",label:"地址"},{fieldName:"name",label:"名称"},{fieldName:"wgs84_latitude",label:"WGS84纬度"},{fieldName:"wgs84_longitude",label:"WGS84经度"},{fieldName:"baidu_index",label:"百度索引"},{fieldName:"baidu_latitude",label:"百度纬度"},{fieldName:"baidu_longitude",label:"百度经度"},{fieldName:"id",label:"ID"},{fieldName:"label",label:"标签"}]}]},attributes:s});e.addMany([i,l])}}},x=s(71241);const L=(0,x.A)(C,[["render",v]]);var I=L},58423:function(e,t,s){s.d(t,{A:function(){return p}});var a=s(71457),r=s(76543),i=(s(37679),s(69292),s(51020),s(29916)),l=s(46626),n=s(71680),o=s(79366),d=s(99024),u=s(41341),c=s(9693);let h=class extends((0,o.d)((0,d.j)(n.A))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new u.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,a._)([(0,r.MZ)({type:c.A})],h.prototype,"elevationInfo",void 0),(0,a._)([(0,r.MZ)((0,l.C)(u.Y,"graphics"))],h.prototype,"graphics",void 0),(0,a._)([(0,r.MZ)({type:["show","hide"]})],h.prototype,"listMode",void 0),(0,a._)([(0,r.MZ)()],h.prototype,"screenSizePerspectiveEnabled",void 0),(0,a._)([(0,r.MZ)({readOnly:!0})],h.prototype,"type",void 0),(0,a._)([(0,r.MZ)({constructOnly:!0})],h.prototype,"internal",void 0),h=(0,a._)([(0,i.$)("geoscene.layers.GraphicsLayer")],h);const p=h}}]);
//# sourceMappingURL=lu-jing-gui-hua-result.39dbf3dd.js.map