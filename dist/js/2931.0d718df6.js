"use strict";(self["webpackChunksun_glare_project"]=self["webpackChunksun_glare_project"]||[]).push([[2931,7623,661],{1774:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAt1BMVEUAAAD///+qqqqAgICZmZmVlZWenp6Xl5eZmZmbm5uenp6ZmZmcnJyYmJiampqZmZmbm5uYmJiampqbm5uZmZmampqYmJiampqbm5uZmZmampqZmZmampqbm5ubm5uampqampqZmZmampqZmZmampqbm5uampqZmZmampqampqampqampqbm5uampqampqampqZmZmampqampqZmZmampqampqampqampqampqampqampqampqampqw7qK0AAAAPHRSTlMAAQMEBQwVFhkhIiMkJSYtLi8wRUZHSElKS3x9fn+Wl5iZmp6foKGjpLS1tre4wtLT1tfY2dvt7u/6+/wzxdzZAAAAAWJLR0QB/wIt3gAAAOdJREFUGNNVkF1XglAQRTcS3DSQlEoyv0rTtLKbGsLl/P/f1QPqwnmbvdZZc2ZDPX4/y3o+zekuC0k6LuIL8sZO2q03e8m9eCf2ITdpA3SmTquajlWk51BaaATQdS4lCAHCgLRyMbDUhGBrDRi7DZhpATeF2oRW1hgrG3Kn3KevX8BYWStrgL3uedaamtaMLz0x0AYg/JF2twDfeqSn3XX8oAT/qE7zUKS8Be+aNiu9ag7EZZU1yrsyAhg13nwoNKyFrORmHYDorToLwRs56bD5/JPKoXcxGi9yScrn0ZV7P8kGSeu0/AOgQSGjf0LSLgAAAABJRU5ErkJggg=="},71132:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAABBUlEQVR4nO2TQWoCQRBFWzcGNEcQhCQbFyZMZ+UmV0ju4iYqDDpVhJBVTuIlXMaFNzEEQrLQF3poVzrTLYMgwYJaNPxf//+ubmPOdZJllWkifFuFmM6xwiRq+H1G2wqb2OF228Lm9oVOUCDJGHjCzEAtSICaw+ZJMgYx17Pwrh6jIjtTwpM39VE+POMqd6J8PqRcxApcv9Owwspx76bclLkf+6XNTUo9VsBhHccnHxcLCMuDl6s7y16WJVhXFlDWZQLbd/3ce6OZKMOIP7CDDQp0U1ru3H/lMiSwDxtOoAwd0QqjYII92KBA1Tb/WuDXv+WfQlAVrhXUKl+JIoWgI3DPZY5af/ThJlHmC57YAAAAAElFTkSuQmCC"},65438:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAABmJLR0QA/wD/AP+gvaeTAAABRUlEQVQokaWRTU4CQRCFv2qQlTvQ4F4lRG+gmHgHI3oBDBBJPABMg0cQ8Ap6DSGu3Jrgz1qIuGDhSp1uF8yMHZwIiW9Xr+rret0N/5DMGvpR7xljKkAByABjoK9EtXVO92Ph0l1pKbucvQBO/lh2qYaqpvf1F0AydBcAAcp2zVqgCqDCqC4oVq5UQm2N3kcp69tt4DrsWWxFP+jdaHNwxwhs5pvHzrZ74MgbeGKxhwAGUwH6KhgoRHBSzuPyGt+0osJO50M4EzU+eI6DJ6mJ66+48Ftkp1iPg9Of6Q2nHLtwz4nX+EVaxFe+F5aC3EDwYFZsR6wUg17RG3hifNNKkHhC2PQffE+Qgwi20pkeEqgxaHSBclxkVyLSbuaap25s1FDVBOnOA+VFzn7iz6g+qO+ISDX4jlXgFaGnjGrrvL6dl2xhfQOqgmx7UWxefQAAAABJRU5ErkJggg=="},91971:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAABmJLR0QA/wD/AP+gvaeTAAABLElEQVQokaWS0U0CURBFz7xV/gG1AvVHO8C1CmO0AgNk2diAEOxgWTB0oJYBhA780goEtgHMjh9LllHWQOL8zX3vZO59b+AfJb8FjeNLVBuADxwAM2CCc7E0m5NCWIfDfZbLHqp3f45SfSJJWtLpfAHs5QfbQACROtWqAk0AZ6xa8BnVM0qlEiLnwIs5a2i/f7GenGXMQQmCW9O/ATcaRYLINQBp2gAmbnXBN7keCy071zWdn9sme9WskuSjEE5Tqx9aeJ7LlcpxIax6YrqZhce5LPKwyangeW0jjWD1zxpFPiIjc/sV57rM5++Uy6d4XhvVKxOhJmE4XS9JFA0QqRda/lmxBEFgbUOStIDBNpDF4j5PuJGv16uRbZAPHAGfwJg0jSUMpzs4262+ARvYazC3hlvBAAAAAElFTkSuQmCC"},81542:function(e){e.exports="data:image/png;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCABAAEADABEAAREBAhEB/8QAGwAAAgMBAQEAAAAAAAAAAAAABAYAAQcFAgP/xAAqEAABBAEDAwIGAwAAAAAAAAABAAIDBAURUWESNXMhMQYTIjJBcRQjQv/EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMAAAERAhEAPwDZkEQUgtBEEQRBEEQcrN5uLFQ9LdH2Hj6GbcnhArY/PW6d51iR7pmynWVpP3cjYoHirahu12zwPD2O/O3BQfZAjZbLZCHK2Y47krWNkIDQ70AQNuJkfNiq0kji57owS4+5KAxAHlLU1PHyzwQmV7R6Dbk/pBnsss1qd8sjnSSO1c4oPDWlx0aCTsEHSwWQt0rzY67HTNlOjoh/rngoH5Bnma7zb8pQO2F7NU8QQHIKQcfIYunTx2QnghDXyxnU7cDZAqYXvNTyhA8VcXTp2JZ4IQ18p9TtwNkBiDO813m35SgdsL2ap4ggOQRADmuzW/EUCThe81PKEGiIKQZ5mu82/KUDthezVPEEByCIAc12a34igScL3mp5Qg0NAi5fL35Mp1O66xru/rj1+3k76oObasOt2ZLDwA6Q9R09tUH3flbZ/jdEpjFZoEYb+OUD1i7U1zHxTzwmJ7h6jfkftAYgBzXZrfiKBJwveanlCDREHKzeEiysPU3Rlhg+h+/B4QI08EtaZ0MzCyRh0LSgYvh74e+b03brPo944yPu5PCBrQWg8SRsmjdHI0PY4aOafYhANHicfDI2SOnE17TqHBvqCgMQRAHaxdO7YinnhDnxH0O/B3CAtBaD/9k="},91060:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABAlBMVEUAAAAA//8AgP9Vqv9AgP9AgP85gP82hv8zgP8xhv8ugP8xif83if81hP81h/80g/8zhf8yh/80hP8yhP80hv8xhP81hv81g/80hf8yhP80hv80hv8yhP8yhP8yhf8yhv80hf8yhf8zhP8zhv8zhP8yhf8yhf8zhv8zhf8yhv80hf8zhv80hf8zhv8yhf80hf8zhf80hf8zhv8zhf8zhv80hP8zhf8yhf80hf8zhP8zhf8zhv8yhf80hf8zhf8zhf8zhf8zhP8zhf8zhf8zhf8zhf8zhf8zhf8zhf8zhf8zhf8zhf8zhf8zhf8zhf8zhf8zhf8zhv8zhf8zhf8zhf////8f5maRAAAAVHRSTlMAAQIDBAgSExQVFhocHSInMjM2ODs+P0RFTU5UV1tcYWJmaGlqa3V4eXp7fIqNjpSVo6SlpqapsbK5ur/AwcLDz9Da3t/g4uPo7/Lz9PX2+/z8/f6zDptbAAAAAWJLR0RVkwS4MwAAARJJREFUGBm9wek6AmEAhuE3k11FdjOmkH3LTihblO0b9Zz/sZh0Vd9Efrnct/5TLL25f7S3NKafOZkyX+qFCf1g8JK2+nZM3YbusOXVxbki9Ha4urhepCGnqAyhi1E1zFWA5xHZ+spAIa6mVBXYkW0SeB9TSw54kG0DOFRb/wuQlCUP5NRxDczIcgD46jgH5mXZBdbVcQukZVkGSmpL1CAYlCVRB2bVcgSUFFEAKik1rRHKKmK8BlRX+iUlTgg9OYraouG1eHZToyHwFBXLE2U8dVl5puXxAwh8dRneuScUlLKOa4DA1zfJ6YX0gEKuAQJfvbkGCHz15hnAeOrNM4CZUm+ugdO4fuGZY0e/mnL0Jz4BcBxPYxuSuGYAAAAASUVORK5CYII="},34350:function(e,t,n){n.d(t,{c:function(){return w},g:function(){return u},i:function(){return y},j:function(){return D},k:function(){return A},m:function(){return d},r:function(){return k},s:function(){return c}});var i=n(37072),r=n(71784),s=n(456),o=n(4276),a=n(67886),l=n(22095);function h(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function c(e,t,n){n*=.5;const i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function u(e,t){const n=2*Math.acos(t[3]),i=Math.sin(n/2);return i>(0,o.g)()?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n}function d(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=n[0],l=n[1],h=n[2],c=n[3];return e[0]=i*c+o*a+r*h-s*l,e[1]=r*c+o*l+s*a-i*h,e[2]=s*c+o*h+i*l-r*a,e[3]=o*c-i*a-r*l-s*h,e}function p(e,t,n){n*=.5;const i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+o*a,e[1]=r*l+s*a,e[2]=s*l-r*a,e[3]=o*l-i*a,e}function g(e,t,n){n*=.5;const i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l-s*a,e[1]=r*l+o*a,e[2]=s*l+i*a,e[3]=o*l-r*a,e}function m(e,t,n){n*=.5;const i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*a,e[1]=r*l-i*a,e[2]=s*l+o*a,e[3]=o*l-s*a,e}function _(e,t){const n=t[0],i=t[1],r=t[2];return e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),e}function f(e,t,n,i){const r=t[0],s=t[1],a=t[2],l=t[3];let h,c,u,d,p,g=n[0],m=n[1],_=n[2],f=n[3];return c=r*g+s*m+a*_+l*f,c<0&&(c=-c,g=-g,m=-m,_=-_,f=-f),1-c>(0,o.g)()?(h=Math.acos(c),u=Math.sin(h),d=Math.sin((1-i)*h)/u,p=Math.sin(i*h)/u):(d=1-i,p=i),e[0]=d*r+p*g,e[1]=d*s+p*m,e[2]=d*a+p*_,e[3]=d*l+p*f,e}function v(e){const t=o.R,n=t(),i=t(),r=t(),s=Math.sqrt(1-n),a=Math.sqrt(n);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=a*Math.sin(2*Math.PI*r),e[3]=a*Math.cos(2*Math.PI*r),e}function y(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=n*n+i*i+r*r+s*s,a=o?1/o:0;return e[0]=-n*a,e[1]=-i*a,e[2]=-r*a,e[3]=s*a,e}function w(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function x(e,t){const n=t[0]+t[4]+t[8];let i;if(n>0)i=Math.sqrt(n+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);const r=(n+1)%3,s=(n+2)%3;i=Math.sqrt(t[3*n+n]-t[3*r+r]-t[3*s+s]+1),e[n]=.5*i,i=.5/i,e[3]=(t[3*r+s]-t[3*s+r])*i,e[r]=(t[3*r+n]+t[3*n+r])*i,e[s]=(t[3*s+n]+t[3*n+s])*i}return e}function A(e,t,n,i){const r=.5*Math.PI/180;t*=r,n*=r,i*=r;const s=Math.sin(t),o=Math.cos(t),a=Math.sin(n),l=Math.cos(n),h=Math.sin(i),c=Math.cos(i);return e[0]=s*l*c-o*a*h,e[1]=o*a*c+s*l*h,e[2]=o*l*h-s*a*c,e[3]=o*l*c+s*a*h,e}function b(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const M=l.c,S=l.s,T=l.a,P=d,V=l.b,C=l.d,O=l.l,E=l.e,Z=E,R=l.f,L=R,H=l.n,D=l.g,I=l.h;function k(e,t,n){const i=(0,a.e)(t,n);return i<-.999999?((0,a.f)(z,G,t),(0,a.u)(z)<1e-6&&(0,a.f)(z,U,t),(0,a.n)(z,z),c(e,z,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):((0,a.f)(z,t,n),e[0]=z[0],e[1]=z[1],e[2]=z[2],e[3]=1+i,H(e,e))}const z=(0,s.c)(),G=(0,s.f)(1,0,0),U=(0,s.f)(0,1,0);function B(e,t,n,i,r,s){return f(N,t,r,s),f(F,n,i,s),f(e,N,F,2*s*(1-s)),e}const N=(0,r.a)(),F=(0,r.a)();function q(e,t,n,i){const r=W;return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-t[0],r[5]=-t[1],r[8]=-t[2],H(e,x(e,r))}const W=(0,i.c)();Object.freeze(Object.defineProperty({__proto__:null,add:T,calculateW:_,conjugate:w,copy:M,dot:C,equals:I,exactEquals:D,fromEuler:A,fromMat3:x,getAxisAngle:u,identity:h,invert:y,len:Z,length:E,lerp:O,mul:P,multiply:d,normalize:H,random:v,rotateX:p,rotateY:g,rotateZ:m,rotationTo:k,scale:V,set:S,setAxes:q,setAxisAngle:c,slerp:f,sqlerp:B,sqrLen:L,squaredLength:R,str:b},Symbol.toStringTag,{value:"Module"}))},89226:function(e,t,n){n.d(t,{$:function(){return b},N2:function(){return M},RH:function(){return T},ZD:function(){return S}});n(44114);function i(e){return"r"in e&&"g"in e&&"b"in e}function r(e){return"h"in e&&"s"in e&&"v"in e}function s(e){return"l"in e&&"a"in e&&"b"in e}function o(e){return"l"in e&&"c"in e&&"h"in e}function a(e){return"x"in e&&"y"in e&&"z"in e}const l=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],h=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function c(e,t){const n=[];let i,r;if(e[0].length!==t.length)throw new Error("dimensions do not match");const s=e.length,o=e[0].length;let a=0;for(i=0;i<s;i++){for(a=0,r=0;r<o;r++)a+=e[i][r]*t[r];n.push(a)}return n}function u(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),n=c(l,t);return{x:100*n[0],y:100*n[1],z:100*n[2]}}function d(e){const t=c(h,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function p(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function g(e){const t=e.l,n=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*n[0],y:100*n[1],z:108.883*n[2]}}function m(e){const t=e.l,n=e.a,i=e.b,r=Math.sqrt(n*n+i*i);let s=Math.atan2(i,n);return s=s>0?s:s+2*Math.PI,{l:t,c:r,h:s}}function _(e){const t=e.l,n=e.c,i=e.h;return{l:t,a:n*Math.cos(i),b:n*Math.sin(i)}}function f(e){return p(u(e))}function v(e){return d(g(e))}function y(e){return m(p(u(e)))}function w(e){return d(g(_(e)))}function x(e){const t=e.r,n=e.g,i=e.b,r=Math.max(t,n,i),s=r-Math.min(t,n,i);let o=r,a=0===s?0:r===t?(n-i)/s%6:r===n?(i-t)/s+2:(t-n)/s+4,l=0===s?0:s/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function A(e){const t=(e.h+360)%360/60,n=e.s/100,i=e.v/100*255,r=i*n,s=r*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:r,g:s,b:0};break;case 1:o={r:s,g:r,b:0};break;case 2:o={r:0,g:r,b:s};break;case 3:o={r:0,g:s,b:r};break;case 4:o={r:s,g:0,b:r};break;case 5:case 6:o={r:r,g:0,b:s};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+i-r),o.g=Math.round(o.g+i-r),o.b=Math.round(o.b+i-r),o}function b(e){return i(e)?e:o(e)?w(e):s(e)?v(e):a(e)?d(e):r(e)?A(e):e}function M(e){return r(e)?e:x(b(e))}function S(e){return s(e)?e:f(b(e))}function T(e){return o(e)?e:y(b(e))}},17874:function(e,t,n){n.d(t,{Ee:function(){return c},tr:function(){return u},v7:function(){return p},zJ:function(){return h}});var i=n(92403),r=(n(4048),n(26011)),s=n(79547),o=n(79075),a=n(14811);function l(e,t,n){return e.units[t][n]}function h(e,t,n,i=2,r="abbr"){return`${(0,a.ZV)(t,{minimumFractionDigits:i,maximumFractionDigits:i,signDisplay:t>0?"never":"exceptZero"})} ${l(e,n,r)}`}function c(e,t,n,i=2,r="abbr"){const s=(0,o.EF)(t,n);return h(e,(0,o.oU)(t,n,s),s,i,r)}function u(e,t,n,i=2,r="abbr"){const s=(0,o.tM)(t,n);return h(e,(0,o.oU)(t,n,s),s,i,r)}new Map;const d=["B","kB","MB","GB","TB"];function p(e,t){let n=0===t?0:Math.floor(Math.log(t)/Math.log(i.u.KILOBYTES));n=(0,r.qE)(n,0,d.length-1);const o=(0,a.ZV)(t/i.u.KILOBYTES**n,{maximumFractionDigits:2});return(0,s.HC)(e.units.bytes[d[n]],{fileSize:o})}},7623:function(e,t,n){n.r(t),n.d(t,{hydratedAdapter:function(){return l}});var i=n(41759),r=n(42346),s=n(74036),o=n(9737),a=n(68491);const l={convertToGEGeometry:h,exportPoint:c,exportPolygon:u,exportPolyline:d,exportMultipoint:p,exportExtent:g};function h(e,t){if(null==t)return null;let n="cache"in t?t.cache._geVersion:void 0;return null==n&&(n=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=n)),n}function c(e,t,n){const i=e.hasZ(t),r=e.hasM(t),o=new s.A({x:e.getPointX(t),y:e.getPointY(t),spatialReference:n});return i&&(o.z=e.getPointZ(t)),r&&(o.m=e.getPointM(t)),o.cache._geVersion=t,o}function u(e,t,n){const i=new o.A({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:n});return i.cache._geVersion=t,i}function d(e,t,n){const i=new a.A({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:n});return i.cache._geVersion=t,i}function p(e,t,n){const i=new r.A({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:n});return i.cache._geVersion=t,i}function g(e,t,n){const r=e.hasZ(t),s=e.hasM(t),o=new i.A({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:n});if(r){const n=e.getZExtent(t);o.zmin=n.vmin,o.zmax=n.vmax}if(s){const n=e.getMExtent(t);o.mmin=n.vmin,o.mmax=n.vmax}return o.cache._geVersion=t,o}},40661:function(e,t,n){n.r(t),n.d(t,{buffer:function(){return P},changeDefaultSpatialReferenceTolerance:function(){return F},clearDefaultSpatialReferenceTolerance:function(){return q},clip:function(){return a},contains:function(){return h},convexHull:function(){return x},crosses:function(){return c},cut:function(){return l},densify:function(){return I},difference:function(){return A},disjoint:function(){return _},distance:function(){return u},equals:function(){return d},extendedSpatialReferenceInfo:function(){return o},flipHorizontal:function(){return L},flipVertical:function(){return H},generalize:function(){return D},geodesicArea:function(){return U},geodesicBuffer:function(){return V},geodesicDensify:function(){return k},geodesicLength:function(){return B},intersect:function(){return M},intersectLinesToPoints:function(){return N},intersects:function(){return p},isSimple:function(){return y},nearestCoordinate:function(){return C},nearestVertex:function(){return O},nearestVertices:function(){return E},offset:function(){return T},overlaps:function(){return f},planarArea:function(){return z},planarLength:function(){return G},relate:function(){return v},rotate:function(){return R},simplify:function(){return w},symmetricDifference:function(){return b},touches:function(){return g},union:function(){return S},within:function(){return m}});var i=n(88574),r=n(7623);function s(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function o(e){return i.G.extendedSpatialReferenceInfo(e)}function a(e,t){return i.G.clip(r.hydratedAdapter,s(e),e,t)}function l(e,t){return i.G.cut(r.hydratedAdapter,s(e),e,t)}function h(e,t){return i.G.contains(r.hydratedAdapter,s(e),e,t)}function c(e,t){return i.G.crosses(r.hydratedAdapter,s(e),e,t)}function u(e,t,n){return i.G.distance(r.hydratedAdapter,s(e),e,t,n)}function d(e,t){return i.G.equals(r.hydratedAdapter,s(e),e,t)}function p(e,t){return i.G.intersects(r.hydratedAdapter,s(e),e,t)}function g(e,t){return i.G.touches(r.hydratedAdapter,s(e),e,t)}function m(e,t){return i.G.within(r.hydratedAdapter,s(e),e,t)}function _(e,t){return i.G.disjoint(r.hydratedAdapter,s(e),e,t)}function f(e,t){return i.G.overlaps(r.hydratedAdapter,s(e),e,t)}function v(e,t,n){return i.G.relate(r.hydratedAdapter,s(e),e,t,n)}function y(e){return i.G.isSimple(r.hydratedAdapter,s(e),e)}function w(e){return i.G.simplify(r.hydratedAdapter,s(e),e)}function x(e,t=!1){return i.G.convexHull(r.hydratedAdapter,s(e),e,t)}function A(e,t){return i.G.difference(r.hydratedAdapter,s(e),e,t)}function b(e,t){return i.G.symmetricDifference(r.hydratedAdapter,s(e),e,t)}function M(e,t){return i.G.intersect(r.hydratedAdapter,s(e),e,t)}function S(e,t=null){return i.G.union(r.hydratedAdapter,s(e),e,t)}function T(e,t,n,o,a,l){return i.G.offset(r.hydratedAdapter,s(e),e,t,n,o,a,l)}function P(e,t,n,o=!1){return i.G.buffer(r.hydratedAdapter,s(e),e,t,n,o)}function V(e,t,n,o,a,l){return i.G.geodesicBuffer(r.hydratedAdapter,s(e),e,t,n,o,a,l)}function C(e,t,n=!0){return i.G.nearestCoordinate(r.hydratedAdapter,s(e),e,t,n)}function O(e,t){return i.G.nearestVertex(r.hydratedAdapter,s(e),e,t)}function E(e,t,n,o){return i.G.nearestVertices(r.hydratedAdapter,s(e),e,t,n,o)}function Z(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent?.center??null:null}function R(e,t,n){if(null==e)throw new W;const r=e.spatialReference;if(null==(n=n??Z(e)))throw new W;const s=e.constructor.fromJSON(i.G.rotate(e,t,n));return s.spatialReference=r,s}function L(e,t){if(null==e)throw new W;const n=e.spatialReference;if(null==(t=t??Z(e)))throw new W;const r=e.constructor.fromJSON(i.G.flipHorizontal(e,t));return r.spatialReference=n,r}function H(e,t){if(null==e)throw new W;const n=e.spatialReference;if(null==(t=t??Z(e)))throw new W;const r=e.constructor.fromJSON(i.G.flipVertical(e,t));return r.spatialReference=n,r}function D(e,t,n,o){return i.G.generalize(r.hydratedAdapter,s(e),e,t,n,o)}function I(e,t,n){return i.G.densify(r.hydratedAdapter,s(e),e,t,n)}function k(e,t,n,o=0){return i.G.geodesicDensify(r.hydratedAdapter,s(e),e,t,n,o)}function z(e,t){return i.G.planarArea(r.hydratedAdapter,s(e),e,t)}function G(e,t){return i.G.planarLength(r.hydratedAdapter,s(e),e,t)}function U(e,t,n){return i.G.geodesicArea(r.hydratedAdapter,s(e),e,t,n)}function B(e,t,n){return i.G.geodesicLength(r.hydratedAdapter,s(e),e,t,n)}function N(e,t){return i.G.intersectLinesToPoints(r.hydratedAdapter,s(e),e,t)}function F(e,t){i.G.changeDefaultSpatialReferenceTolerance(e,t)}function q(e){i.G.clearDefaultSpatialReferenceTolerance(e)}class W extends Error{constructor(){super("Illegal Argument Exception")}}},44655:function(e,t,n){n.d(t,{Ow:function(){return _},TT:function(){return g},l1:function(){return m}});n(44114),n(2516);var i=n(47966),r=n(79075),s=n(43759),o=n(72465),a=n(68491),l=n(9737),h=(n(74036),n(12790));function c(e){if(!e)return null;if((0,o.EA)(e)&&e.wkid){const t=s.uw[e.wkid];if(t)return t}if(e.wkt){const t=u(e.wkt);if(t)return t}return null}function u(e){const t=s.Ex.exec(e);if(!t||2!==t.length)return null;const n=t[1].split(",");if(!n||n.length<3)return null;const i=parseFloat(n[1]),r=parseFloat(n[2]);return isNaN(i)||isNaN(r)?null:{a:i,f:0===r?0:1/r}}function d(e){const t=c(e??h.A.WGS84);if(p(t))return t;const n=t.a*(1-t.f);return Object.assign(t,{b:n,eSq:1-(n/t.a)**2,radius:(2*t.a+n)/3,densificationRatio:1e4/((2*t.a+n)/3)})}function p(e){return null!=e&&"b"in e&&"eSq"in e&&"radius"in e}function g(e){return null!==c(e)}function m(e,t="meters"){if(!e)throw new i.A("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some((e=>!g(e.spatialReference))))throw new i.A("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const n=[];for(let i=0;i<e.length;i++){const s=e[i],{spatialReference:o}=s,a="polyline"===s.type?s.paths:s.rings;let l=0;for(let e=0;e<a.length;e++){const t=a[e];let n=0;for(let e=1;e<t.length;e++){const i=t[e-1][0],r=t[e][0],s=t[e-1][1],a=t[e][1];if(s!==a||i!==r){const e=new f;y(e,[i,s],[r,a],o),n+=e.distance}}l+=n}l=(0,r.oU)(l,"meters",t),n.push(l)}return n}function _(e,t){if("polyline"!==e.type&&"polygon"!==e.type)throw new i.A("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:n}=e;if(!g(n))throw new i.A("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const r="polyline"===e.type?e.paths:e.rings,s=[],o=[0,0],h=new f;for(const i of r){const e=[];s.push(e),e.push([i[0][0],i[0][1]]);let r,a,l=i[0][0],c=i[0][1];for(let s=0;s<i.length-1;s++){if(r=i[s+1][0],a=i[s+1][1],l===r&&c===a)continue;const u=[l,c];y(h,[l,c],[r,a],n);const{azimuth:d,distance:p}=h,g=p/t;if(g>1){for(let i=1;i<=g-1;i++)v(o,u,d,i*t,n),e.push(o.slice(0));v(o,u,d,(p+Math.floor(g-1)*t)/2,n),e.push(o.slice(0))}v(o,u,d,p,n),e.push(o.slice(0)),l=o[0],c=o[1]}}return"polyline"===e.type?new a.A({paths:s,spatialReference:n}):new l.A({rings:s,spatialReference:n})}class f{constructor(e=0,t=void 0,n=void 0){this.distance=e,this.azimuth=t,this.reverseAzimuth=n}}function v(e,t,n,i,r){const o=t[0],a=t[1],l=o*s.eh,h=a*s.eh,c=(n??0)*s.eh,{a:u,b:p,f:g}=d(r),m=Math.sin(c),_=Math.cos(c),f=(1-g)*Math.tan(h),v=1/Math.sqrt(1+f*f),y=f*v,w=Math.atan2(f,_),x=v*m,A=x*x,b=1-A,M=b*(u*u-p*p)/(p*p),S=1+M/16384*(4096+M*(M*(320-175*M)-768)),T=M/1024*(256+M*(M*(74-47*M)-128));let P,V,C,O,E=i/(p*S),Z=2*Math.PI;for(;Math.abs(E-Z)>1e-12;)C=Math.cos(2*w+E),P=Math.sin(E),V=Math.cos(E),O=T*P*(C+T/4*(V*(2*C*C-1)-T/6*C*(4*P*P-3)*(4*C*C-3))),Z=E,E=i/(p*S)+O;const R=y*P-v*V*_,L=Math.atan2(y*V+v*P*_,(1-g)*Math.sqrt(A+R*R)),H=Math.atan2(P*m,v*V-y*P*_),D=g/16*b*(4+g*(4-3*b)),I=L/s.eh,k=(l+(H-(1-D)*g*x*(E+D*P*(C+D*V*(2*C*C-1)))))/s.eh;return e[0]=k,e[1]=I,e}function y(e,t,n,i){const r=t[0]*s.eh,o=t[1]*s.eh,a=n[0]*s.eh,l=n[1]*s.eh,{a:h,b:c,f:u,radius:p}=d(i),g=a-r,m=Math.atan((1-u)*Math.tan(o)),_=Math.atan((1-u)*Math.tan(l)),f=Math.sin(m),v=Math.cos(m),y=Math.sin(_),w=Math.cos(_);let x,A,b,M,S,T,P,V,C,O,E=1e3,Z=g;do{if(P=Math.sin(Z),V=Math.cos(Z),b=Math.sqrt(w*P*(w*P)+(v*y-f*w*V)*(v*y-f*w*V)),0===b)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;S=f*y+v*w*V,T=Math.atan2(b,S),C=v*w*P/b,A=1-C*C,M=S-2*f*y/A,isNaN(M)&&(M=0),O=u/16*A*(4+u*(4-3*A)),x=Z,Z=g+(1-O)*u*C*(T+O*b*(M+O*S*(2*M*M-1)))}while(Math.abs(Z-x)>1e-12&&--E>0);if(0===E){const t=p,n=Math.acos(Math.sin(o)*Math.sin(l)+Math.cos(o)*Math.cos(l)*Math.cos(a-r))*t,i=a-r,h=Math.sin(i)*Math.cos(l),c=Math.cos(o)*Math.sin(l)-Math.sin(o)*Math.cos(l)*Math.cos(i),u=Math.atan2(h,c);return e.azimuth=u/s.eh,e.distance=n,e.reverseAzimuth=void 0,e}const R=A*(h*h-c*c)/(c*c),L=R/1024*(256+R*(R*(74-47*R)-128)),H=c*(1+R/16384*(4096+R*(R*(320-175*R)-768)))*(T-L*b*(M+L/4*(S*(2*M*M-1)-L/6*M*(4*b*b-3)*(4*M*M-3)))),D=Math.atan2(w*Math.sin(Z),v*y-f*w*Math.cos(Z)),I=Math.atan2(v*Math.sin(Z),v*y*Math.cos(Z)-f*w);return e.azimuth=D/s.eh,e.distance=H,e.reverseAzimuth=I/s.eh,e}},42638:function(e,t,n){n.d(t,{el:function(){return T},mT:function(){return P},XX:function(){return A}});n(44114);var i=n(19470),r=n(47966),s=n(15114),o=n(9737),a=n(68491),l=n(43166),h=n(72465),c=n(30075),u=(n(2516),n(86039)),d=n(55772),p=n(42116);async function g(e,t,n,i){const r=(0,p.Dl)(e),s=t[0].spatialReference,o={...i,query:{...r.query,f:"json",sr:JSON.stringify(s),target:JSON.stringify({geometryType:(0,d.$B)(t[0]),geometries:t}),cutter:JSON.stringify(n)}},a=await(0,u["default"])(r.path+"/cut",o),{cutIndexes:l,geometries:h=[]}=a.data;return{cutIndexes:l,geometries:h.map((e=>{const t=(0,d.rS)(e);return t.spatialReference=s,t}))}}var m=n(4244),_=n(63504);async function f(e,t,n){const i="string"==typeof e?(0,m.An)(e):e,r=t[0].spatialReference,s=(0,d.$B)(t[0]),o={...n,query:{...i.query,f:"json",sr:r.wkid??JSON.stringify(r),geometries:JSON.stringify((0,_.X)(t))}},{data:a}=await(0,u["default"])(i.path+"/simplify",o);return(0,_.V)(a.geometries,s,r)}const v=s.A.getLogger("geoscene.geometry.support.normalizeUtils");function y(e){return"polygon"===e.type}function w(e){return"polygon"===e[0].type}function x(e){return"polyline"===e[0].type}function A(e,t){if(!(e instanceof a.A||e instanceof o.A)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw v.error(e),new r.A(e)}const n=(0,l.r8)(e),i=[];for(const r of n){const e=[];i.push(e),e.push([r[0][0],r[0][1]]);for(let n=0;n<r.length-1;n++){const i=r[n][0],s=r[n][1],o=r[n+1][0],a=r[n+1][1],l=Math.sqrt((o-i)*(o-i)+(a-s)*(a-s)),h=(a-s)/l,c=(o-i)/l,u=l/t;if(u>1){for(let a=1;a<=u-1;a++){const n=a*t,r=c*n+i,o=h*n+s;e.push([r,o])}const n=(l+Math.floor(u-1)*t)/2,r=c*n+i,o=h*n+s;e.push([r,o])}e.push([o,a])}}return y(e)?new o.A({rings:i,spatialReference:e.spatialReference}):new a.A({paths:i,spatialReference:e.spatialReference})}function b(e,t,n){if(t){const t=A(e,1e6);e=(0,c.ci)(t,!0)}return n&&(e=(0,l.kS)(e,n)),e}function M(e,t,n){if(Array.isArray(e)){const i=e[0];if(i>t){const n=(0,l.kd)(i,t);e[0]=i+n*(-2*t)}else if(i<n){const t=(0,l.kd)(i,n);e[0]=i+t*(-2*n)}}else{const i=e.x;if(i>t){const n=(0,l.kd)(i,t);e=e.clone().offset(n*(-2*t),0)}else if(i<n){const t=(0,l.kd)(i,n);e=e.clone().offset(t*(-2*n),0)}}return e}function S(e,t){let n=-1;for(let i=0;i<t.cutIndexes.length;i++){const r=t.cutIndexes[i],s=t.geometries[i],o=(0,l.r8)(s);for(let e=0;e<o.length;e++){const t=o[e];t.some((n=>{if(n[0]<180)return!0;{let n=0;for(let e=0;e<t.length;e++){const i=t[e][0];n=i>n?i:n}n=Number(n.toFixed(9));const i=-360*(0,l.kd)(n,180);for(let r=0;r<t.length;r++){const t=s.getPoint(e,r);s.setPoint(e,r,t.clone().offset(i,0))}return!0}}))}if(r===n){if(w(e))for(const t of(0,l.r8)(s))e[r]=e[r].addRing(t);else if(x(e))for(const t of(0,l.r8)(s))e[r]=e[r].addPath(t)}else n=r,e[r]=s}return e}async function T(e,t,n){if(!Array.isArray(e))return T([e],t);t&&"string"!=typeof t&&v.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r="string"==typeof t?t:t?.url??i.A.geometryServiceUrl;let s,u,d,p,m,_,y,w,x=0;const A=[],P=[];for(const i of e)if(null!=i)if(s||(s=i.spatialReference,u=(0,h.Vp)(s),d=s.isWebMercator,_=d?102100:4326,p=l.j7[_].maxX,m=l.j7[_].minX,y=l.j7[_].plus180Line,w=l.j7[_].minus180Line),u)if("mesh"===i.type)P.push(i);else if("point"===i.type)P.push(M(i.clone(),p,m));else if("multipoint"===i.type){const e=i.clone();e.points=e.points.map((e=>M(e,p,m))),P.push(e)}else if("extent"===i.type){const e=i.clone()._normalize(!1,!1,u);P.push(e.rings?new o.A(e):e)}else if(i.extent){const e=i.extent,t=(0,l.kd)(e.xmin,m)*(2*p);let n=0===t?i.clone():(0,l.kS)(i.clone(),t);e.offset(t,0),e.intersects(y)&&e.xmax!==p?(x=e.xmax>x?e.xmax:x,n=b(n,d),A.push(n),P.push("cut")):e.intersects(w)&&e.xmin!==m?(x=e.xmax*(2*p)>x?e.xmax*(2*p):x,n=b(n,d,360),A.push(n),P.push("cut")):P.push(n)}else P.push(i.clone());else P.push(i);else P.push(i);let V=(0,l.kd)(x,p),C=-90;const O=V,E=new a.A;for(;V>0;){const e=360*V-180;E.addPath([[e,C],[e,-1*C]]),C*=-1,V--}if(A.length>0&&O>0){const t=S(A,await g(r,A,E,n)),i=[],s=[];for(let n=0;n<P.length;n++){const r=P[n];if("cut"!==r)s.push(r);else{const r=t.shift(),o=e[n];null!=o&&"polygon"===o.type&&o.rings&&o.rings.length>1&&r.rings.length>=o.rings.length?(i.push(r),s.push("simplify")):s.push(d?(0,c.Gh)(r):r)}}if(!i.length)return s;const o=await f(r,i,n),a=[];for(let e=0;e<s.length;e++){const t=s[e];"simplify"!==t?a.push(t):a.push(d?(0,c.Gh)(o.shift()):o.shift())}return a}const Z=[];for(let i=0;i<P.length;i++){const e=P[i];if("cut"!==e)Z.push(e);else{const e=A.shift();Z.push(!0===d?(0,c.Gh)(e):e)}}return Z}function P(e,t){const n=(0,h.Vp)(t);if(n){const[t,i]=n.valid,r=i-t;if(e<t)for(;e<t;)e+=r;if(e>i)for(;e>i;)e-=r}return e}},43166:function(e,t,n){n.d(t,{j7:function(){return o},kS:function(){return l},kd:function(){return a},r8:function(){return h}});var i=n(68491),r=n(12790),s=n(55772);const o={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new i.A({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:r.A.WebMercator}),minus180Line:new i.A({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:r.A.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new i.A({paths:[[[180,-180],[180,180]]],spatialReference:r.A.WGS84}),minus180Line:new i.A({paths:[[[-180,-180],[-180,180]]],spatialReference:r.A.WGS84})}};function a(e,t){return Math.ceil((e-t)/(2*t))}function l(e,t){const n=h(e);for(const i of n)for(const e of i)e[0]+=t;return e}function h(e){return(0,s.Bi)(e)?e.rings:e.paths}},91253:function(e,t,n){n.d(t,{$X:function(){return C},Gy:function(){return b},P5:function(){return O},SW:function(){return P},Tr:function(){return V},VV:function(){return a},qj:function(){return T}});n(44114);var i=n(55772);const r=(e,t,n)=>[t,n],s=(e,t,n)=>[t,n,e[2]],o=(e,t,n)=>[t,n,e[2],e[3]];function a(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function l({scale:e,translate:t},n){return Math.round((n-t[0])/e[0])}function h({scale:e,translate:t},n){return Math.round((t[1]-n)/e[1])}function c(e,t,n){const i=[];let r,s,o,a;for(let c=0;c<n.length;c++){const u=n[c];c>0?(o=l(e,u[0]),a=h(e,u[1]),o===r&&a===s||(i.push(t(u,o-r,a-s)),r=o,s=a)):(r=l(e,u[0]),s=h(e,u[1]),i.push(t(u,r,s)))}return i.length>0?i:null}function u(e,t,n,i){return c(e,n?i?o:s:i?s:r,t)}function d(e,t,n,i){const a=[],l=n?i?o:s:i?s:r;for(let r=0;r<t.length;r++){const n=c(e,l,t[r]);n&&n.length>=3&&a.push(n)}return a.length?a:null}function p(e,t,n,i){const a=[],l=n?i?o:s:i?s:r;for(let r=0;r<t.length;r++){const n=c(e,l,t[r]);n&&n.length>=2&&a.push(n)}return a.length?a:null}function g({scale:e,translate:t},n){return n*e[0]+t[0]}function m({scale:e,translate:t},n){return t[1]-n*e[1]}function _(e,t,n){const i=new Array(n.length);if(!n.length)return i;const[r,s]=e.scale;let o=g(e,n[0][0]),a=m(e,n[0][1]);i[0]=t(n[0],o,a);for(let l=1;l<n.length;l++){const e=n[l];o+=e[0]*r,a-=e[1]*s,i[l]=t(e,o,a)}return i}function f(e,t,n){const i=new Array(n.length);for(let r=0;r<n.length;r++)i[r]=_(e,t,n[r]);return i}function v(e,t,n,i){return _(e,n?i?o:s:i?s:r,t)}function y(e,t,n,i){return f(e,n?i?o:s:i?s:r,t)}function w(e,t,n,i){return f(e,n?i?o:s:i?s:r,t)}function x(e,t,n,i,r){return t.xmin=l(e,n.xmin),t.ymin=h(e,n.ymin),t.xmax=l(e,n.xmax),t.ymax=h(e,n.ymax),t!==n&&(i&&(t.zmin=n.zmin,t.zmax=n.zmax),r&&(t.mmin=n.mmin,t.mmax=n.mmax)),t}function A(e,t,n,i,r){return t.points=u(e,n.points,i,r)??[],t}function b(e,t,n,i,r){return t.x=l(e,n.x),t.y=h(e,n.y),t!==n&&(i&&(t.z=n.z),r&&(t.m=n.m)),t}function M(e,t,n,i,r){const s=d(e,n.rings,i,r);return s?(t.rings=s,t):null}function S(e,t,n,i,r){const s=p(e,n.paths,i,r);return s?(t.paths=s,t):null}function T(e,t){return e&&t?(0,i.fT)(t)?b(e,{},t,!1,!1):(0,i.Rg)(t)?S(e,{},t,!1,!1):(0,i.Bi)(t)?M(e,{},t,!1,!1):(0,i.U9)(t)?A(e,{},t,!1,!1):(0,i.ZC)(t)?x(e,{},t,!1,!1):null:null}function P(e,t,n,i,r){return null!=n&&(t.points=v(e,n.points,i,r)),t}function V(e,t,n,i,r){return null==n||(t.x=g(e,n.x),t.y=m(e,n.y),t!==n&&(i&&(t.z=n.z),r&&(t.m=n.m))),t}function C(e,t,n,i,r){return null!=n&&(t.rings=w(e,n.rings,i,r)),t}function O(e,t,n,i,r){return null!=n&&(t.paths=y(e,n.paths,i,r)),t}},58423:function(e,t,n){n.d(t,{A:function(){return p}});var i=n(71457),r=n(76543),s=(n(37679),n(69292),n(51020),n(29916)),o=n(46626),a=n(71680),l=n(79366),h=n(99024),c=n(41341),u=n(9693);let d=class extends((0,l.d)((0,h.j)(a.A))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new c.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,i._)([(0,r.MZ)({type:u.A})],d.prototype,"elevationInfo",void 0),(0,i._)([(0,r.MZ)((0,o.C)(c.Y,"graphics"))],d.prototype,"graphics",void 0),(0,i._)([(0,r.MZ)({type:["show","hide"]})],d.prototype,"listMode",void 0),(0,i._)([(0,r.MZ)()],d.prototype,"screenSizePerspectiveEnabled",void 0),(0,i._)([(0,r.MZ)({readOnly:!0})],d.prototype,"type",void 0),(0,i._)([(0,r.MZ)({constructOnly:!0})],d.prototype,"internal",void 0),d=(0,i._)([(0,s.$)("geoscene.layers.GraphicsLayer")],d);const p=d},7194:function(e,t,n){n.d(t,{C:function(){return r}});n(51020);var i=n(72465);function r(e,t){return e===t||null!=e&&null!=t&&(0,i.aI)(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}},90314:function(e,t,n){n.d(t,{HP:function(){return i},TH:function(){return s},jy:function(){return r}});n(51020),n(48119),n(12790),n(32604),n(99359),n(91253),n(11894),n(81937),n(7194);class i{constructor(e,t,n){this.uid=e,this.geometry=t,this.attributes=n,this.visible=!0,this.objectId=null,this.centroid=null}}class r{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function s(e,t,n,i){return{x:e,y:t,z:n,hasZ:null!=n,hasM:!1,spatialReference:i,type:"point"}}},70343:function(e,t,n){n.d(t,{q:function(){return o}});var i=n(79075),r=n(67681);function s(e){const t="metric";if(null==e)return t;const n=e.map,s=(n&&"portalItem"in n?n.portalItem?.portal:null)??r.A.getDefault();switch(s.user?.units??s.units){case t:return t;case"english":return"imperial"}return(0,i.jM)(e.spatialReference)??t}const o={readOnly:!0,get(){return s(this.view)}}},753:function(e,t,n){function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e){let t=0,n=0;for(let i=0;i<e.length;i++){const r=e[i].size;"number"==typeof r&&(t+=r,n++)}return t/n}function s(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?r(e.stops):t}function o(e,t){if(!t)return e;const n=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:n,minSize:i}=t;return(s(n,e)+s(i,e))/2}));let i=0;const r=n.length;if(0===r)return e;for(let s=0;s<r;s++)i+=n[s];const o=Math.floor(i/r);return Math.max(o,e)}function a(e){const t=e&&e.renderer,n="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return n;const r="visualVariables"in t?o(n,t.visualVariables):n;if("simple"===t.type)return i(r,t.symbol);if("unique-value"===t.type){let e=r;return t.uniqueValueInfos?.forEach((t=>{e=i(e,t.symbol)})),e}if("class-breaks"===t.type){let e=r;return t.classBreakInfos.forEach((t=>{e=i(e,t.symbol)})),e}return"dot-density"===t.type||t.type,r}n.d(t,{o:function(){return a}})},25120:function(e,t,n){n.d(t,{bK:function(){return s},id:function(){return h},ky:function(){return a},qt:function(){return g},w7:function(){return o},wS:function(){return c}});n(81739);function i(e){return e?g:m}function r(e,t){return null!=t&&t.mode?t.mode:i(e).mode}function s(e,t){return null!=t?t:i(e)}function o(e,t){return r(null!=e&&e.hasZ,t)}function a(e){const t=l(e);return o(e.geometry,t)}function l(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function h(e,t,n){if(null==n||!n.mode)return;const i=e.hasZ?e.z:0,r=null!=n.offset?n.offset:0;switch(n.mode){case"absolute-height":return i-r;case"on-the-ground":return 0;case"relative-to-ground":return i-((t.elevationProvider.getElevation(e.x,e.y,i,e.spatialReference,"ground")??0)+r);case"relative-to-scene":return i-((t.elevationProvider.getElevation(e.x,e.y,i,e.spatialReference,"scene")??0)+r)}}function c(e,t,n,i=null){return u(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,n,i)}function u(e,t,n,i,r,s,o=null){if(null==s)return;const a=null!=o?o.mode:"absolute-height";if("on-the-ground"===a)return 0;const{absoluteZ:l}=d(t,n,i,r,e,s);return p(l,t,n,i,r,e,o,a)}function d(e,t,n,i,r,s){const o=null!=s.offset?s.offset:0;switch(s.mode){case"absolute-height":return{absoluteZ:n+o,elevation:0};case"on-the-ground":{const n=r.elevationProvider.getElevation(e,t,0,i,"ground")??0;return{absoluteZ:n,elevation:n}}case"relative-to-ground":{const s=r.elevationProvider.getElevation(e,t,n,i,"ground")??0;return{absoluteZ:n+s+o,elevation:s}}case"relative-to-scene":{const s=r.elevationProvider.getElevation(e,t,n,i,"scene")??0;return{absoluteZ:n+s+o,elevation:s}}}}function p(e,t,n,i,r,s,o,a){const l=null!=o&&null!=o.offset?o.offset:0;switch(a){case"absolute-height":return e-l;case"relative-to-ground":return e-((s.elevationProvider.getElevation(t,n,i,r,"ground")??0)+l);case"relative-to-scene":return e-((s.elevationProvider.getElevation(t,n,i,r,"scene")??0)+l)}}const g={mode:"absolute-height",offset:0},m={mode:"on-the-ground",offset:null}},55754:function(e,t,n){var i,r,s,o,a,l,h,c,u,d,p,g,m,_,f,v,y,w,x,A,b,M,S,T,P,V,C,O,E,Z,R,L,H,D,I,k,z,G,U,B,N,F,q,W,K,Y,X,Q,j,J,$,ee,te,ne,ie,re,se,oe,ae,le,he;n.d(t,{$2:function(){return a},C1:function(){return s},JO:function(){return r},M1:function(){return M},O$:function(){return se},Q1:function(){return Y},TZ:function(){return v},WE:function(){return O},Y:function(){return h},YI:function(){return Q},bj:function(){return c},e_:function(){return K},f0:function(){return re},fu:function(){return p},g7:function(){return u},ip:function(){return X},mU:function(){return E},oF:function(){return A},uQ:function(){return b},uT:function(){return k},vG:function(){return ae},wd:function(){return B},xR:function(){return i},xn:function(){return y},xw:function(){return P},yS:function(){return z}}),function(e){e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e[e.UNKNOWN=4]="UNKNOWN"}(i||(i={})),function(e){e[e.BEVEL=0]="BEVEL",e[e.ROUND=1]="ROUND",e[e.MITER=2]="MITER",e[e.UNKNOWN=4]="UNKNOWN"}(r||(r={})),function(e){e[e.SCREEN=0]="SCREEN",e[e.MAP=1]="MAP"}(s||(s={})),function(e){e[e.Tint=0]="Tint",e[e.Ignore=1]="Ignore",e[e.Multiply=99]="Multiply"}(o||(o={})),function(e){e.Both="Both",e.JustBegin="JustBegin",e.JustEnd="JustEnd",e.None="None"}(a||(a={})),function(e){e[e.Mosaic=0]="Mosaic",e[e.Centered=1]="Centered"}(l||(l={})),function(e){e[e.Normal=0]="Normal",e[e.Superscript=1]="Superscript",e[e.Subscript=2]="Subscript"}(h||(h={})),function(e){e[e.MSSymbol=0]="MSSymbol",e[e.Unicode=1]="Unicode"}(c||(c={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.TrueType=1]="TrueType",e[e.PSOpenType=2]="PSOpenType",e[e.TTOpenType=3]="TTOpenType",e[e.Type1=4]="Type1"}(u||(u={})),function(e){e[e.Display=0]="Display",e[e.Map=1]="Map"}(d||(d={})),function(e){e.None="None",e.Loop="Loop",e.Oscillate="Oscillate"}(p||(p={})),function(e){e[e.Z=0]="Z",e[e.X=1]="X",e[e.Y=2]="Y"}(g||(g={})),function(e){e[e.XYZ=0]="XYZ",e[e.ZXY=1]="ZXY",e[e.YXZ=2]="YXZ"}(m||(m={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.RoundedRectangle=1]="RoundedRectangle",e[e.Oval=2]="Oval"}(_||(_={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.Screen=2]="Screen",e[e.Multiply=3]="Multiply",e[e.Add=4]="Add"}(f||(f={})),function(e){e[e.TTB=0]="TTB",e[e.RTL=1]="RTL",e[e.BTT=2]="BTT"}(v||(v={})),function(e){e[e.None=0]="None",e[e.SignPost=1]="SignPost",e[e.FaceNearPlane=2]="FaceNearPlane"}(y||(y={})),function(e){e[e.Float=0]="Float",e[e.String=1]="String",e[e.Boolean=2]="Boolean"}(w||(w={})),function(e){e[e.Intersect=0]="Intersect",e[e.Subtract=1]="Subtract"}(x||(x={})),function(e){e.OpenEnded="OpenEnded",e.Block="Block",e.Crossed="Crossed"}(A||(A={})),function(e){e.FullGeometry="FullGeometry",e.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",e.ReversedFirstSegment="ReversedFirstSegment",e.PerpendicularToSecondSegment="PerpendicularToSecondSegment",e.SecondSegmentWithTicks="SecondSegmentWithTicks",e.DoublePerpendicular="DoublePerpendicular",e.OppositeToFirstSegment="OppositeToFirstSegment",e.TriplePerpendicular="TriplePerpendicular",e.HalfCircleFirstSegment="HalfCircleFirstSegment",e.HalfCircleSecondSegment="HalfCircleSecondSegment",e.HalfCircleExtended="HalfCircleExtended",e.OpenCircle="OpenCircle",e.CoverageEdgesWithTicks="CoverageEdgesWithTicks",e.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",e.GapExtentMidline="GapExtentMidline",e.Chevron="Chevron",e.PerpendicularWithArc="PerpendicularWithArc",e.ClosedHalfCircle="ClosedHalfCircle",e.TripleParallelExtended="TripleParallelExtended",e.ParallelWithTicks="ParallelWithTicks",e.Parallel="Parallel",e.PerpendicularToFirstSegment="PerpendicularToFirstSegment",e.ParallelOffset="ParallelOffset",e.OffsetOpposite="OffsetOpposite",e.OffsetSame="OffsetSame",e.CircleWithArc="CircleWithArc",e.DoubleJog="DoubleJog",e.PerpendicularOffset="PerpendicularOffset",e.LineExcludingLastSegment="LineExcludingLastSegment",e.MultivertexArrow="MultivertexArrow",e.CrossedArrow="CrossedArrow",e.ChevronArrow="ChevronArrow",e.ChevronArrowOffset="ChevronArrowOffset",e.PartialFirstSegment="PartialFirstSegment",e.Arch="Arch",e.CurvedParallelTicks="CurvedParallelTicks",e.Arc90Degrees="Arc90Degrees"}(b||(b={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square",e.TrueBuffer="TrueBuffer"}(M||(M={})),function(e){e.ClosePath="ClosePath",e.ConvexHull="ConvexHull",e.RectangularBox="RectangularBox"}(S||(S={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(T||(T={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square"}(P||(P={})),function(e){e.Fast="Fast",e.Accurate="Accurate"}(V||(V={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(C||(C={})),function(e){e.Sinus="Sinus",e.Square="Square",e.Triangle="Triangle",e.Random="Random"}(O||(O={})),function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Force=2]="Force"}(E||(E={})),function(e){e[e.Buffered=0]="Buffered",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.AlongLine=3]="AlongLine"}(Z||(Z={})),function(e){e[e.Linear=0]="Linear",e[e.Rectangular=1]="Rectangular",e[e.Circular=2]="Circular",e[e.Buffered=3]="Buffered"}(R||(R={})),function(e){e[e.Discrete=0]="Discrete",e[e.Continuous=1]="Continuous"}(L||(L={})),function(e){e[e.AcrossLine=0]="AcrossLine",e[e.AloneLine=1]="AloneLine"}(H||(H={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e[e.Justify=3]="Justify"}(D||(D={})),function(e){e[e.Base=0]="Base",e[e.MidPoint=1]="MidPoint",e[e.ThreePoint=2]="ThreePoint",e[e.FourPoint=3]="FourPoint",e[e.Underline=4]="Underline",e[e.CircularCW=5]="CircularCW",e[e.CircularCCW=6]="CircularCCW"}(I||(I={})),function(e){e.Butt="Butt",e.Round="Round",e.Square="Square"}(k||(k={})),function(e){e.NoConstraint="NoConstraint",e.HalfPattern="HalfPattern",e.HalfGap="HalfGap",e.FullPattern="FullPattern",e.FullGap="FullGap",e.Custom="Custom"}(z||(z={})),function(e){e[e.None=-1]="None",e[e.Custom=0]="Custom",e[e.Circle=1]="Circle",e[e.OpenArrow=2]="OpenArrow",e[e.ClosedArrow=3]="ClosedArrow",e[e.Diamond=4]="Diamond"}(G||(G={})),function(e){e[e.ExtraLeading=0]="ExtraLeading",e[e.Multiple=1]="Multiple",e[e.Exact=2]="Exact"}(U||(U={})),function(e){e.Bevel="Bevel",e.Round="Round",e.Miter="Miter"}(B||(B={})),function(e){e[e.Default=0]="Default",e[e.String=1]="String",e[e.Numeric=2]="Numeric"}(N||(N={})),function(e){e[e.InsidePolygon=0]="InsidePolygon",e[e.PolygonCenter=1]="PolygonCenter",e[e.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(F||(F={})),function(e){e[e.Tint=0]="Tint",e[e.Replace=1]="Replace",e[e.Multiply=2]="Multiply"}(q||(q={})),function(e){e[e.ClipAtBoundary=0]="ClipAtBoundary",e[e.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",e[e.DoNotTouchBoundary=2]="DoNotTouchBoundary",e[e.DoNotClip=3]="DoNotClip"}(W||(W={})),function(e){e.NoConstraint="NoConstraint",e.WithMarkers="WithMarkers",e.WithFullGap="WithFullGap",e.WithHalfGap="WithHalfGap",e.Custom="Custom"}(K||(K={})),function(e){e.Fixed="Fixed",e.Random="Random",e.RandomFixedQuantity="RandomFixedQuantity"}(Y||(Y={})),function(e){e.LineMiddle="LineMiddle",e.LineBeginning="LineBeginning",e.LineEnd="LineEnd",e.SegmentMidpoint="SegmentMidpoint"}(X||(X={})),function(e){e.OnPolygon="OnPolygon",e.CenterOfMass="CenterOfMass",e.BoundingBoxCenter="BoundingBoxCenter"}(Q||(Q={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(j||(j={})),function(e){e[e.MarkerCenter=0]="MarkerCenter",e[e.MarkerBounds=1]="MarkerBounds"}(J||(J={})),function(e){e[e.None=0]="None",e[e.PropUniform=1]="PropUniform",e[e.PropNonuniform=2]="PropNonuniform",e[e.DifUniform=3]="DifUniform",e[e.DifNonuniform=4]="DifNonuniform"}($||($={})),function(e){e.Tube="Tube",e.Strip="Strip",e.Wall="Wall"}(ee||(ee={})),function(e){e[e.Random=0]="Random",e[e.Increasing=1]="Increasing",e[e.Decreasing=2]="Decreasing",e[e.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(te||(te={})),function(e){e[e.Relative=0]="Relative",e[e.Absolute=1]="Absolute"}(ne||(ne={})),function(e){e[e.Normal=0]="Normal",e[e.LowerCase=1]="LowerCase",e[e.Allcaps=2]="Allcaps"}(ie||(ie={})),function(e){e[e.LTR=0]="LTR",e[e.RTL=1]="RTL"}(re||(re={})),function(e){e.Draft="Draft",e.Picture="Picture",e.Text="Text"}(se||(se={})),function(e){e[e.Top=0]="Top",e[e.Center=1]="Center",e[e.Baseline=2]="Baseline",e[e.Bottom=3]="Bottom"}(oe||(oe={})),function(e){e[e.Right=0]="Right",e[e.Upright=1]="Upright"}(ae||(ae={})),function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large"}(le||(le={})),function(e){e[e.Calm=0]="Calm",e[e.Rippled=1]="Rippled",e[e.Slight=2]="Slight",e[e.Moderate=3]="Moderate"}(he||(he={}))},99179:function(e,t,n){n.d(t,{Ws:function(){return s}});var i=n(37257);n(89226),n(18439);function r(e){let{r:t,g:n,b:r,a:s}=e;return s<1&&(t=Math.round(s*t+255*(1-s)),n=Math.round(s*n+255*(1-s)),r=Math.round(s*r+255*(1-s))),new i.A({r:t,g:n,b:r})}function s(e,t){const{r:n,g:i,b:s}=t?.ignoreAlpha?e:r(e);return.2126*n+.7152*i+.0722*s}},70568:function(e,t,n){n.d(t,{V:function(){return o},t:function(){return a}});n(2516);var i=n(79075),r=n(753),s=n(41759);function o(e,t,n,r=new s.A){let o=0;if("2d"===n.type)o=t*(n.resolution??0);else if("3d"===n.type){const r=n.overlayPixelSizeInMapUnits(e),s=n.basemapSpatialReference;o=null==s||s.equals(n.spatialReference)?t*r:(0,i.GA)(s)/(0,i.GA)(n.spatialReference)}const a=e.x-o,l=e.y-o,h=e.x+o,c=e.y+o,{spatialReference:u}=n;return r.xmin=Math.min(a,h),r.ymin=Math.min(l,c),r.xmax=Math.max(a,h),r.ymax=Math.max(l,c),r.spatialReference=u,r}function a(e,t,n){const i=n.toMap(e);return null!=i&&o(i,(0,r.o)(),n,l).intersects(t)}const l=new s.A},44432:function(e,t,n){n.d(t,{A:function(){return Ti}});var i=n(71457),r=n(71120),s=n(79075),o=n(76543),a=(n(37679),n(69292)),l=(n(51020),n(29916)),h=n(43895),c=n(87400),u=n(39582),d=n(70343),p=(n(44114),n(2516),n(11134)),g=(n(38730),n(85092),n(37257)),m=n(19470),_=n(99179);function f(e){return(0,_.Ws)(e,{ignoreAlpha:!0})>225?new g.A([0,0,0,e.a]):new g.A([255,255,255,e.a])}function v(e,t){const n=new g.A(e);return n.a*=t,n}function y(e=1){return v(m.A.analysisTheme.accentColor,e)}function w(e=1){return f(y(e))}function x(e=1){return v(m.A.analysisTheme.textColor,e)}function A(e=1){return f(x(e))}var b=n(79908),M=n(17874),S=n(40661),T=n(44655),P=n(58423),V=n(79515),C=n(3734),O=n(15114),E=(n(47966),n(20573)),Z=n(57411),R=n(1834),L=n(18513),H=n(90314),D=n(44199),I=n(28589),k=n(15329),z=n(456),G=n(55754);const U={main:new g.A([255,127,0]),selected:new g.A([255,255,255]),outline:new g.A([0,0,0,.5]),selectedOutline:new g.A([255,255,255]),hoverOutline:new g.A([255,255,255]),secondary:new g.A([255,255,255]),secondaryOutline:new g.A([100,100,100]),transparent:new g.A([0,0,0,0])};function B(e,t){Object.assign(e,t)}class N{constructor(e){this.size=8,this.hoverSize=10,this.color=U.main,this.hoverColor=U.main,this.outlineColor=U.outline,this.hoverOutlineColor=U.hoverOutline,B(this,e)}}class F{constructor(e){this.color=U.secondary,this.hoverColor=U.main,B(this,e)}}class q{constructor(e){this.color=U.transparent,this.hoverColor=U.transparent,this.outlineColor=U.main,this.hoverOutlineColor=U.main,this.stagedColor=U.transparent,this.stagedOutlineColor=U.secondary,B(this,e)}}class W{constructor(e){this.vertex=new N,this.midpoint=new N({color:U.secondary,outlineColor:U.secondaryOutline,size:6}),this.selected=new N({color:U.selected,hoverColor:U.selected,hoverOutlineColor:U.hoverOutline}),B(this,e)}}class K{constructor(e){this.center=new N({color:U.secondaryOutline}),this.fill=new q,this.line=new F,this.vertex=new N({color:U.selected,outlineColor:U.main,hoverColor:U.selected,hoverOutlineColor:U.secondaryOutline}),B(this,e)}}class Y{constructor(e){this.reshapeGraphics=new W,this.transformGraphics=new K,B(this,e)}}new Y;var X=n(28920);let Q=class extends X.oY{constructor(){super(...arguments),this.enabled=!0}};(0,i._)([(0,o.MZ)({type:Boolean})],Q.prototype,"enabled",void 0),Q=(0,i._)([(0,l.$)("geoscene.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Q);let j=class extends X.oY{constructor(e){super(e),this.lineSnapper=new Q,this.parallelLineSnapper=new Q,this.rightAngleSnapper=new Q,this.rightAngleTriangleSnapper=new Q,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThreshold=.1,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new g.A([255,127,0]),this.orangeTransparent=new g.A([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,i._)([(0,o.MZ)({type:Q,constructOnly:!0,nonNullable:!0,json:{write:!0}})],j.prototype,"lineSnapper",void 0),(0,i._)([(0,o.MZ)({type:Q,constructOnly:!0,nonNullable:!0,json:{write:!0}})],j.prototype,"parallelLineSnapper",void 0),(0,i._)([(0,o.MZ)({type:Q,constructOnly:!0,nonNullable:!0,json:{write:!0}})],j.prototype,"rightAngleSnapper",void 0),(0,i._)([(0,o.MZ)({type:Q,constructOnly:!0,nonNullable:!0,json:{write:!0}})],j.prototype,"rightAngleTriangleSnapper",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],j.prototype,"shortLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],j.prototype,"distance",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],j.prototype,"pointThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],j.prototype,"intersectionParallelLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],j.prototype,"parallelLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],j.prototype,"verticalLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],j.prototype,"touchSensitivityMultiplier",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],j.prototype,"pointOnLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:g.A,nonNullable:!0})],j.prototype,"orange",void 0),(0,i._)([(0,o.MZ)({type:g.A,nonNullable:!0})],j.prototype,"orangeTransparent",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],j.prototype,"lineHintWidthReference",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],j.prototype,"lineHintWidthTarget",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],j.prototype,"lineHintFadedExtensions",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],j.prototype,"parallelLineHintWidth",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],j.prototype,"parallelLineHintLength",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],j.prototype,"parallelLineHintOffset",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],j.prototype,"rightAngleHintSize",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],j.prototype,"rightAngleHintOutlineSize",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],j.prototype,"satisfiesConstraintScreenThreshold",void 0),j=(0,i._)([(0,l.$)("geoscene.views.interactive.snapping.Settings.Defaults")],j);const J=new j;var $,ee=n(67886);!function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}($||($={}));class te{constructor(e,t){this.isDraped=e,this.domain=t}}class ne extends te{constructor(e,t,n=$.ALL){super(t,n),this.intersectionPoint=e}equals(e){return e instanceof ne&&(0,ee.k)(this.intersectionPoint,e.intersectionPoint)}}class ie extends te{constructor(e,t,n,i,r=$.ALL,s=!0,o=!0){super(i,r),this.type=e,this.lineStart=t,this.lineEnd=n,this.fadeLeft=s,this.fadeRight=o}equals(e){return e instanceof ie&&this.type===e.type&&(0,ee.k)(this.lineStart,e.lineStart)&&(0,ee.k)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return(0,ee.i)(this.lineStart,this.lineEnd)}}class re extends te{constructor(e,t,n,i=$.ALL){super(n,i),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof re&&(0,ee.k)(this.lineStart,e.lineStart)&&(0,ee.k)(this.lineEnd,e.lineEnd)}}class se extends te{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof se&&(0,ee.k)(this.point,e.point)}}class oe extends te{constructor(e,t,n,i,r=$.ALL){super(i,r),this.previousVertex=e,this.centerVertex=t,this.nextVertex=n}equals(e){return e instanceof oe&&(0,ee.k)(this.previousVertex,e.previousVertex)&&(0,ee.k)(this.centerVertex,e.centerVertex)&&(0,ee.k)(this.nextVertex,e.nextVertex)}}class ae{draw(e,t){const n=this._getUniqueHints(e),i=this.sortUniqueHints(n),r=[];for(const s of i)s instanceof ne&&r.push(this.visualizeIntersectionPoint(s,t)),s instanceof ie&&r.push(this.visualizeLine(s,t)),s instanceof re&&r.push(this.visualizeParallelSign(s,t)),s instanceof oe&&r.push(this.visualizeRightAngleQuad(s,t)),s instanceof se&&r.push(this.visualizePoint(s,t));return(0,D.vE)(r)}sortUniqueHints(e){return e}_getUniqueHints(e){const t=[];for(const n of e){let e=!0;for(const i of t)if(n.equals(i)){e=!1;break}e&&t.push(n)}return t}}var le=n(8494),he=n(73484),ce=n(95259),ue=n(74036),de=n(68491);class pe extends ae{constructor(e){super(),this._graphicsLayer=e}visualizeIntersectionPoint(e,t){return this._visualizeSnappingIndicator(new ue.A({x:e.intersectionPoint[0],y:e.intersectionPoint[1],spatialReference:t.spatialReference}),_e)}visualizePoint(e,t){return this._visualizeSnappingIndicator(new ue.A({x:e.point[0],y:e.point[1],spatialReference:t.spatialReference}),fe)}visualizeLine(e,t){return this._visualizeSnappingIndicator(new de.A({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.spatialReference}),ve)}visualizeParallelSign(e,t){return this._visualizeSnappingIndicator(new de.A({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.spatialReference}),ye)}visualizeRightAngleQuad(e,t){return this._visualizeSnappingIndicator(new de.A({paths:[[e.previousVertex,e.centerVertex,e.nextVertex]],spatialReference:t.spatialReference}),be(e))}_visualizeSnappingIndicator(e,t){const n=new p.A({geometry:e,symbol:t});return this._graphicsLayer.add(n),(0,D.hA)((()=>{this._graphicsLayer.remove(n)}))}}const ge=U.main.toArray(),me=[...U.main.toRgb(),100],_e=new le.A({outline:new he.A({width:1.5,color:ge}),size:15,color:[0,0,0,0]}),fe=new le.A({outline:{width:.5,color:[0,0,0,1]},size:10,color:ge}),ve=new ce.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:G.uT.Butt,joinStyle:G.wd.Round,miterLimit:10,width:(0,L.PN)(J.lineHintWidthTarget),color:ge}]}}}),ye=new ce.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:ge}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:ge}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}}),we=e=>new ce.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:(0,L.PN)(J.rightAngleHintSize),rotation:e,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:(0,L.PN)(J.rightAngleHintOutlineSize),color:ge},{type:"CIMSolidFill",enable:!0,color:me}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}}),xe=we(45),Ae=we(225),be=(()=>{const e=(0,k.a)(),t=(0,k.a)(),n=(0,z.c)();return i=>((0,I.c)(e,i.centerVertex,i.previousVertex),(0,I.c)(t,i.nextVertex,i.previousVertex),(0,I.f)(n,e,t),n[2]<0?xe:Ae)})();var Me,Se=n(22095),Te=n(18439);!function(e){e[e.Z=0]="Z",e[e.M=1]="M"}(Me||(Me={}));class Pe{constructor(e){this.spatialReference=e}createVector(){return this._tag((0,k.a)())}pointToVector(e){return this._tag((0,k.f)(e.x,e.y))}arrayToVector(e){return this._tag((0,k.f)(e[0],e[1]))}vectorToArray(e){return[e[0],e[1]]}pointToArray(e){return[e.x,e.y]}vectorToPoint(e,t=new ue.A){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new ue.A){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"}){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}lerp(e,t,n,i){return(0,I.l)(i,e,t,n)}addDelta(e,t,n){e[0]+=t,e[1]+=n}distance(e,t){return(0,I.d)(e,t)}getZ(e,t=void 0){return t}hasZ(){return!1}getM(e,t=void 0){return t}hasM(){return!1}clone(e){return this._tag((0,k.b)(e))}copy(e,t){return(0,I.j)(t,e)}fromXYZ(e){return this._tag((0,k.f)(e[0],e[1]))}toXYZ(e,t=(0,z.c)()){return(0,ee.s)(t,e[0],e[1],0)}pointToXYZ(e,t=(0,z.c)()){return(0,ee.s)(t,e.x,e.y,0)}equals(e,t){return(0,I.o)(e,t)}_tag(e){return e}}class Ve{constructor(e,t){this._valueType=e,this.spatialReference=t}createVector(){return this._tag((0,z.c)())}pointToVector(e){return this._tag((0,z.f)(e.x,e.y,this._valueType===Me.Z?e.z:e.m))}arrayToVector(e){return this._tag((0,z.f)(e[0],e[1],e[2]||0))}vectorToArray(e){return[e[0],e[1],e[2]]}pointToArray(e){return this._valueType===Me.Z?[e.x,e.y,e.z]:[e.x,e.y,e.m]}vectorToPoint(e,t=new ue.A){return t.x=e[0],t.y=e[1],t.z=this._valueType===Me.Z?e[2]:void 0,t.m=this._valueType===Me.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new ue.A){return t.x=e[0],t.y=e[1],t.z=this._valueType===Me.Z?e[2]:void 0,t.m=this._valueType===Me.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"}){const n=this._valueType===Me.Z,i=this._valueType===Me.M;return t.x=e[0],t.y=e[1],t.z=n?e[2]:void 0,t.m=i?e[2]:void 0,t.hasZ=n,t.hasM=i,t.spatialReference=this.spatialReference,t}lerp(e,t,n,i){return(0,ee.h)(i,e,t,n)}addDelta(e,t,n,i){e[0]+=t,e[1]+=n,this._valueType===Me.Z&&(e[2]+=i)}distance(e,t){return this._valueType===Me.Z?(0,ee.i)(e,t):(0,I.d)(e,t)}getZ(e,t=void 0){return this._valueType===Me.Z?e[2]:t}hasZ(){return this._valueType===Me.Z}getM(e,t=void 0){return this._valueType===Me.M?e[2]:t}hasM(){return this._valueType===Me.M}clone(e){return this._tag((0,z.g)(e))}copy(e,t){return(0,ee.c)(t,e)}fromXYZ(e,t=0,n=0){return this._tag((0,z.f)(e[0],e[1],this._valueType===Me.Z?e.length>2?e[2]:t:n))}toXYZ(e,t=(0,z.c)()){return(0,ee.s)(t,e[0],e[1],this._valueType===Me.Z?e[2]:0)}pointToXYZ(e,t=(0,z.c)()){return(0,ee.s)(t,e.x,e.y,this._valueType===Me.Z?e.z??0:0)}equals(e,t){return(0,ee.F)(e,t)}_tag(e){return e}}class Ce{constructor(e){this.spatialReference=e}createVector(){return this._tag((0,Te.c)())}pointToVector(e){return this._tag((0,Te.f)(e.x,e.y,e.z,e.m))}arrayToVector(e){return this._tag((0,Te.f)(e[0],e[1],e[2]||0,e[3]||0))}vectorToArray(e){return[e[0],e[1],e[2],e[3]]}pointToArray(e){return[e.x,e.y,e.z,e.m]}vectorToPoint(e,t=new ue.A){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new ue.A){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"}){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}lerp(e,t,n,i){return(0,Se.l)(i,e,t,n)}addDelta(e,t,n,i){e[0]+=t,e[1]+=n,e[2]+=i}distance(e,t){return(0,ee.i)(e,t)}getZ(e){return e[2]}hasZ(){return!0}getM(e){return e[3]}hasM(){return!0}clone(e){return this._tag((0,Te.b)(e))}copy(e,t){return(0,Se.c)(t,e)}fromXYZ(e,t=0,n=0){return this._tag((0,Te.f)(e[0],e[1],e.length>2?e[2]:t,n))}toXYZ(e,t=(0,z.c)()){return(0,ee.s)(t,e[0],e[1],e[2])}pointToXYZ(e,t=(0,z.c)()){return(0,ee.s)(t,e.x,e.y,e.z??0)}equals(e,t){return(0,Se.h)(e,t)}_tag(e){return e}}function Oe(e,t,n){return e&&t?new Ce(n):t?new Ve(Me.M,n):e?new Ve(Me.Z,n):new Pe(n)}var Ee,Ze,Re=n(9737),Le=n(72465);function He(e,t){if(!t.supported)return;let n=1/0,i=-1/0;const r=t.upperBoundX-t.lowerBoundX;e.forEach((e=>{let s=e.pos[0];for(;s<t.lowerBoundX;)s+=r;for(;s>t.upperBoundX;)s-=r;n=Math.min(n,s),i=Math.max(i,s),e.pos[0]=s}));const s=i-n;r-s<s&&e.forEach((e=>{e.pos[0]<0&&(e.pos[0]+=r)}))}function De(e,t){const n=(0,Le.Vp)(e);return t===V.RT.Global&&n?{supported:!0,lowerBoundX:n.valid[0],upperBoundX:n.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}class Ie{constructor(e){this.component=e,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}}class ke{constructor(e,t,n){this.component=e,this.leftVertex=t,this.rightVertex=n,this.type="edge",t.rightEdge=this,n.leftEdge=this}}class ze{constructor(e,t){this._spatialReference=e,this._viewingMode=t,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||He(this.vertices,De(this._spatialReference,this._viewingMode))}updateVertexIndex(e,t){if(0===this.vertices.length)return;const n=this.vertices[0];let i=null,r=e,s=t;do{i=r,i.index=s++,r=i.rightEdge?i.rightEdge.rightVertex:null}while(null!=r&&r!==n);i.leftEdge&&i!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(i),this.vertices.length-1)}getFirstVertex(){return 0===this.vertices.length?null:this.vertices[0]}getLastVertex(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]}isClosed(){return this.vertices.length>2&&null!==this.vertices[0].leftEdge}swapVertices(e,t){const n=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=n}iterateVertices(e){if(0===this.vertices.length)return;const t=this.vertices[0];let n=t;do{e(n,n.index),n=null!=n.rightEdge?n.rightEdge.rightVertex:null}while(n!==t&&null!=n)}}class Ge extends E.A{constructor(e,t){super(),this.type=e,this.coordinateHelper=t,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon()}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}notifyChanges(e){this._dirty=!0,this.emit("change",e)}_toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const e=[],t=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const i=[];let r=n.vertices.find((e=>null==e.leftEdge));const s=r;do{i.push(t(r.pos)),r=r.rightEdge?r.rightEdge.rightVertex:null}while(r&&r!==s);e.push(i)}return new de.A({paths:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const e=[],t=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const i=[],r=n.vertices[0];let s=r;const o=s;do{i.push(t(s.pos)),s=null!=s.rightEdge?s.rightEdge.rightVertex:null}while(s&&s!==o);n.isClosed()&&i.push(t(r.pos)),e.push(i)}return new Re.A({rings:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(e,t){const n=e.spatialReference,i=Oe(e.hasZ,e.hasM,n),r=new Ge(e.type,i);switch(e.type){case"polygon":{const s=e.rings;for(let e=0;e<s.length;++e){const o=s[e],l=new ze(n,t);l.index=e;const h=o.length>2&&(0,a.aI)(o[0],o[o.length-1]),c=h?o.length-1:o.length;for(let e=0;e<c;++e){const t=i.arrayToVector(o[e]),n=new Ie(l);l.vertices.push(n),n.pos=t,n.index=e}const u=l.vertices.length-1;for(let e=0;e<u;++e){const t=l.vertices[e],n=l.vertices[e+1],i=new ke(l,t,n);l.edges.push(i)}if(h){const e=new ke(l,l.vertices[l.vertices.length-1],l.vertices[0]);l.edges.push(e)}r.components.push(l)}break}case"polyline":{const s=e.paths;for(let e=0;e<s.length;++e){const o=s[e],a=new ze(n,t);a.index=e;const l=o.length;for(let e=0;e<l;++e){const t=i.arrayToVector(o[e]),n=new Ie(a);a.vertices.push(n),n.pos=t,n.index=e}const h=a.vertices.length-1;for(let e=0;e<h;++e){const t=a.vertices[e],n=a.vertices[e+1],i=new ke(a,t,n);a.edges.push(i)}r.components.push(a)}break}case"point":{const s=new ze(n,t);s.index=0;const o=new Ie(s);o.index=0,o.pos=i.pointToVector(e),s.vertices.push(o),r.components.push(s);break}}return r}}!function(e){e[e.NEW_STEP=0]="NEW_STEP",e[e.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS"}(Ee||(Ee={}));class Ue{constructor(e,t,n){this._editGeometry=e,this._component=t,this._pos=n,this._addedVertex=null,this._originalEdge=null,this._left=null,this._right=null}apply(){let e="redo";null==this._addedVertex&&(e="apply",this._addedVertex=new Ie(this._component));const t=this._component.getLastVertex();if(null==t)this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._addedVertex.index=0;else{let e=null;t.rightEdge&&(this._originalEdge=t.rightEdge,e=this._originalEdge.rightVertex,this._component.edges.splice(this._component.edges.indexOf(this._originalEdge),1)),this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,null==this._left&&(this._left=new ke(this._component,t,this._addedVertex)),this._component.edges.push(this._left),t.rightEdge=this._left,null!=this._originalEdge&&null!=e&&(null==this._right&&(this._right=new ke(this._component,this._addedVertex,e)),this._component.edges.push(this._right),e.leftEdge=this._right),this._component.updateVertexIndex(this._addedVertex,t.index+1)}this._editGeometry.notifyChanges({operation:e,addedVertices:[this._addedVertex]})}undo(){null!=this._addedVertex&&(this._component.vertices.splice(this._component.vertices.indexOf(this._addedVertex),1),null!=this._left&&(this._component.edges.splice(this._component.edges.indexOf(this._left),1),this._left.leftVertex.rightEdge=null),null!=this._right&&(this._component.edges.splice(this._component.edges.indexOf(this._right),1),this._right.rightVertex.leftEdge=null),null!=this._originalEdge&&(this._component.edges.push(this._originalEdge),this._originalEdge.leftVertex.rightEdge=this._originalEdge,this._originalEdge.rightVertex.leftEdge=this._originalEdge),null!=this._left?this._component.updateVertexIndex(this._left.leftVertex,this._left.leftVertex.index):this._component.updateVertexIndex(this._addedVertex,0),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this._addedVertex]}))}accumulate(){return!1}}class Be{constructor(e,t,n){this._editGeometry=e,this._vertices=t,this.operation=n,this._undone=!1}apply(){this._vertices.forEach((e=>this.operation.apply(e))),this._editGeometry.components.forEach((e=>e.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:this._undone?"redo":"apply",updatedVertices:this._vertices})}undo(){this._vertices.forEach((e=>this.operation.undo(e))),this._editGeometry.notifyChanges({operation:"undo",updatedVertices:this._vertices}),this._undone=!0}canAccumulate(e){if(this._undone||e._vertices.length!==this._vertices.length)return!1;for(let t=0;t<e._vertices.length;++t)if(e._vertices[t]!==this._vertices[t])return!1;return this.operation.canAccumulate(e.operation)}accumulate(e){return!!(e instanceof Be&&this.canAccumulate(e))&&(this._vertices.forEach((t=>this.operation.accumulate(t,e.operation))),this.operation.accumulateParams(e.operation),this._editGeometry.components.forEach((e=>e.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:"apply",updatedVertices:this._vertices}),!0)}}!function(e){e[e.CUMULATIVE=0]="CUMULATIVE",e[e.REPLACE=1]="REPLACE"}(Ze||(Ze={}));class Ne{constructor(e,t,n=0){this._editGeometry=e,this._vertices=t,this._minNumberOfVertices=n,this.removedVertices=null}apply(){let e="redo";if(null==this.removedVertices){const t=this.removedVertices=[];this._vertices.forEach((e=>{const n=this._removeVertex(e);null!=n&&t.push(n)})),e="apply"}else this.removedVertices.forEach((e=>{this._removeVertex(e.removedVertex)}));this._editGeometry.notifyChanges({operation:e,removedVertices:this._vertices})}undo(){this.removedVertices?.forEach((e=>{this._undoRemoveVertex(e)})),this._editGeometry.notifyChanges({operation:"undo",addedVertices:this._vertices})}accumulate(){return!1}_removeVertex(e){const t=e.component;if(t.vertices.length<=this._minNumberOfVertices)return null;const n={removedVertex:e,createdEdge:null},i=e.leftEdge,r=e.rightEdge;return t.vertices.splice(t.vertices.indexOf(e),1),i&&(t.edges.splice(t.edges.indexOf(i),1),i.leftVertex.rightEdge=null),r&&(t.edges.splice(t.edges.indexOf(r),1),r.rightVertex.leftEdge=null),0===e.index&&r&&this._vertices.length>0&&t.swapVertices(t.vertices.indexOf(r.rightVertex),0),i&&r&&(n.createdEdge=new ke(t,i.leftVertex,r.rightVertex),t.edges.push(n.createdEdge)),r&&t.updateVertexIndex(r.rightVertex,r.rightVertex.index-1),n}_undoRemoveVertex(e){const t=e.removedVertex,n=e.removedVertex.component,i=t.leftEdge,r=t.rightEdge;e.createdEdge&&n.edges.splice(n.edges.indexOf(e.createdEdge),1),n.vertices.push(t),i&&(n.edges.push(i),i.leftVertex.rightEdge=i),r&&(n.edges.push(r),r.rightVertex.leftEdge=r),n.updateVertexIndex(t,t.index)}}class Fe{constructor(e,t,n){this._editGeometry=e,this._edge=t,this._t=n,this.createdVertex=null,this._left=null,this._right=null}apply(){let e="redo";const t=this._edge,n=t.component,i=t.leftVertex,r=t.rightVertex;n.edges.splice(n.edges.indexOf(t),1),null==this.createdVertex&&(e="apply",this.createdVertex=new Ie(t.component)),n.vertices.push(this.createdVertex),this.createdVertex.pos=this._editGeometry.coordinateHelper.lerp(t.leftVertex.pos,t.rightVertex.pos,this._t,this._editGeometry.coordinateHelper.createVector()),null==this._left&&(this._left=new ke(n,i,this.createdVertex)),this._left.leftVertex.leftEdge?n.edges.push(this._left):n.edges.unshift(this._left),i.rightEdge=this._left,null==this._right&&(this._right=new ke(n,this.createdVertex,r)),n.edges.push(this._right),r.leftEdge=this._right,n.updateVertexIndex(this.createdVertex,i.index+1),this._editGeometry.notifyChanges({operation:e,addedVertices:[this.createdVertex]})}undo(){if(null==this.createdVertex||null==this._left||null==this._right)return null;const e=this._edge,t=e.component,n=this.createdVertex.leftEdge,i=this.createdVertex.rightEdge,r=n?.leftVertex,s=i?.rightVertex;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this._left),1),t.edges.splice(t.edges.indexOf(this._right),1),this._edge.leftVertex.leftEdge?t.edges.push(this._edge):t.edges.unshift(this._edge),r&&(r.rightEdge=e),s&&(s.leftEdge=e),r&&t.updateVertexIndex(r,r.index),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}}class qe{constructor(e,t,n){this._editGeometry=e,this._vertex=t,this._pos=n}apply(){const e=null==this._originalPosition;e&&(this._originalPosition=this._vertex.pos),this._apply(e?"apply":"redo")}undo(){this._vertex.pos=this._originalPosition,this._editGeometry.notifyChanges({operation:"undo",updatedVertices:[this._vertex]})}accumulate(e){return e instanceof qe&&e._vertex===this._vertex&&(this._pos=e._pos,this._apply("apply"),!0)}_apply(e){this._vertex.pos=this._pos,this._editGeometry.components.forEach((e=>e.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:e,updatedVertices:[this._vertex]})}}class We{constructor(e,t){this._editGeometry=e,this._component=t,this._createdEdge=null}apply(){let e="redo";if(null==this._createdEdge){e="apply";const t=this._component.getFirstVertex(),n=this._component.getLastVertex();if(this._component.isClosed()||this._component.vertices.length<3||null==t||null==n)return;this._createdEdge=new ke(this._component,n,t)}this._createdEdge.leftVertex.rightEdge=this._createdEdge,this._createdEdge.rightVertex.leftEdge=this._createdEdge,this._component.edges.push(this._createdEdge),this._editGeometry.notifyChanges({operation:e})}undo(){null!=this._createdEdge&&((0,a.TF)(this._component.edges,this._createdEdge),this._createdEdge.leftVertex.rightEdge=null,this._createdEdge.rightVertex.leftEdge=null,this._editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}}class Ke{constructor(e,t,n,i){this._helper=e,this.dx=t,this.dy=n,this.dz=i}_move(e,t,n,i){this._helper.addDelta(e.pos,t,n,i)}apply(e){this._move(e,this.dx,this.dy,this.dz)}undo(e){this._move(e,-this.dx,-this.dy,-this.dz)}canAccumulate(e){return e instanceof Ke}accumulate(e,t){this._move(e,t.dx,t.dy,t.dz)}accumulateParams(e){this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz}}var Ye,Xe=n(26011),Qe=n(67336),je=n(47148);function Je(e,t){return e[0]*t[1]-e[1]*t[0]}function $e(e,t){const n=e.start,i=e.end,r=t.start,s=t.end,o=(0,I.c)(tt,i,n),a=(0,I.c)(nt,s,r),l=Je(o,a);if(Math.abs(l)<=et)return[];const h=(0,I.c)(it,n,r),c=Je(a,h)/l,u=Je(o,h)/l;if(c>=0){if(u>=0||t.type===Ye.LINE)return[(0,I.y)(rt,n,o,c)]}else if(e.type===Ye.LINE&&(u>=0||t.type===Ye.LINE))return[(0,I.y)(rt,n,o,c)];return[]}!function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"}(Ye||(Ye={}));const et=1e-6,tt=(0,k.a)(),nt=(0,k.a)(),it=(0,k.a)(),rt=(0,k.a)();class st{get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}constructor(e,t,n,i=0,r=ht.IMMEDIATE){this._helper=e,this._planeType=t,this._edge=n,this.distance=i,this._plane=(0,Qe.vt)(),this._offsetPlane=(0,Qe.vt)(),this._minDistance=-1/0,this._maxDistance=1/0,this._selectedArrow=1,r===ht.IMMEDIATE&&this._initialize()}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){const e=this._toXYZ(this._edge.leftVertex.pos),t=this._toXYZ(this._edge.leftVertex.leftEdge?.leftVertex?.pos),n=this._toXYZ(this._edge.rightVertex.pos),i=this._toXYZ(this._edge.rightVertex.rightEdge?.rightVertex?.pos);this._edgeDirection=(0,ee.r)((0,z.c)(),e,n),this._left=this._computeNeighbor(e,t,this._edgeDirection),this._right=this._computeNeighbor(n,i,this._edgeDirection)}_toXYZ(e){return null!=e?this._helper.toXYZ(e):null}_pointToXYZ(e){return this._toXYZ(this._helper.pointToVector(e))}_computeNeighbor(e,t,n){if(null==t)return{start:e,end:t,direction:(0,z.f)(-n[1],n[0],0),isOriginalDirection:!0};const i=(0,ee.r)((0,z.c)(),e,t),r=!this._passesBisectingAngleThreshold(i,n);return{start:e,end:t,direction:r?this._bisectVectorsPerpendicular(n,i):i,isOriginalDirection:!r}}_passesBisectingAngleThreshold(e,t){const n=Math.abs((0,je.g7)(t,e));return n>=ot&&n<=Math.PI-ot}_bisectVectorsPerpendicular(e,t){const n=(0,ee.e)(e,t)<0?e:(0,ee.o)((0,z.c)(),e),i=Math.abs((0,ee.e)(n,t));if(!(i<at||i>1-at))return this._bisectDirection(n,t);const r=(0,ee.f)((0,z.c)(),n,[0,0,1]);return(0,ee.n)(r,r)}_bisectDirection(e,t){const n=(0,ee.a)((0,z.c)(),e,t);return(0,ee.n)(n,n)}_initializePlane(){const e=this._computeNormalDirection(this._left),t=this._computeNormalDirection(this._right);(0,ee.e)(e,t)<0&&(0,ee.o)(t,t),(0,Qe.O_)(this._left.start,this._bisectDirection(e,t),this._plane)}_computeNormalDirection(e){const t=(0,ee.f)((0,z.c)(),e.direction,this._edgeDirection);(0,ee.n)(t,t);const n=(0,ee.f)((0,z.c)(),this._edgeDirection,t);return this._planeType===lt.XY&&(n[2]=0),(0,ee.n)(n,n)}_initializeDistanceConstraints(){null==this._left.end||this.requiresSplitEdgeLeft||this._updateDistanceConstraint((0,Qe.mN)(this._plane,this._left.end)),null==this._right.end||this.requiresSplitEdgeRight||this._updateDistanceConstraint((0,Qe.mN)(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(e){e<=0&&(this._minDistance=Math.max(this._minDistance,e)),e>=0&&(this._maxDistance=Math.min(this._maxDistance,e))}_updateIntersectDistanceConstraint(e){const t=(0,Qe.qb)(e),n=this._edgeDirection,i=(0,ee.a)((0,z.c)(),this._left.start,this._left.direction),r=(0,ee.a)((0,z.c)(),this._right.start,this._right.direction),s=this._pointInBasis2D((0,k.a)(),t,n,this._left.start),o=this._pointInBasis2D((0,k.a)(),t,n,i),a=this._pointInBasis2D((0,k.a)(),t,n,this._right.start),l=this._pointInBasis2D((0,k.a)(),t,n,r),[h]=$e({start:o,end:s,type:Ye.LINE},{start:l,end:a,type:Ye.LINE});if(!h)return;const c=(0,I.c)((0,k.a)(),s,o);(0,I.e)(c,c);const u=(0,I.c)((0,k.a)(),h,o),d=(0,I.g)(c,u),p=(0,ee.a)((0,z.c)(),i,(0,ee.g)((0,z.c)(),this._left.direction,-d)),g=(0,Qe.mN)(e,p);this._updateDistanceConstraint(g)}_pointInBasis2D(e,t,n,i){return e[0]=(0,je.gr)(t,i),e[1]=(0,je.gr)(n,i),e}_offset(e,t){Number.isFinite(this._minDistance)&&(t=Math.max(this._minDistance,t)),Number.isFinite(this._maxDistance)&&(t=Math.min(this._maxDistance,t)),(0,Qe.C)(this._offsetPlane,this._plane),this._offsetPlane[3]-=t;const n=(e,t,n)=>null!=t&&(0,Qe.U5)(this._offsetPlane,e,(0,ee.a)((0,z.c)(),e,t),n),i=(0,z.c)();(e===this._edge.leftVertex?n(this._left.start,this._left.direction,i):n(this._right.start,this._right.direction,i))&&this._helper.copy(this._helper.fromXYZ(i,void 0,this._helper.getM(e.pos)),e.pos)}selectArrowFromStartPoint(e){this._selectedArrow=(0,Qe.Tj)(this.plane,this._pointToXYZ(e))?1:-1}get selectedArrow(){return this._selectedArrow}signedDistanceToPoint(e){return(0,Qe.mN)(this.plane,this._pointToXYZ(e))}apply(e){this._offset(e,this.distance)}undo(e){this._offset(e,0)}canAccumulate(e){return e instanceof st&&this._edge.leftVertex.index===e._edge.leftVertex.index&&this._edge.rightVertex.index===e._edge.rightVertex.index&&this._edge.component===e._edge.component&&this._maybeEqualsVec3(this._left.direction,e._left.direction)&&this._maybeEqualsVec3(this._right.direction,e._right.direction)&&(0,ee.F)((0,Qe.qb)(this._plane),(0,Qe.qb)(e._plane))}accumulate(e,t){const n=this._plane[3]-t._plane[3]+t.distance;this._offset(e,n)}accumulateParams(e){const t=e.distance-e._plane[3];this.distance=t+this._plane[3]}clone(){const e=new st(this._helper,this._planeType,this._edge,this.distance,ht.DEFERRED);return(0,Qe.C)(e._plane,this._plane),(0,Qe.C)(e._offsetPlane,this._offsetPlane),e._maxDistance=this._maxDistance,e._minDistance=this._minDistance,e._left=this._cloneNeighbor(this._left),e._right=this._cloneNeighbor(this._right),e._edgeDirection=(0,ee.c)((0,z.c)(),this._edgeDirection),e}_maybeEqualsVec3(e,t){return null==e&&null==t||null!=e&&null!=t&&(0,ee.F)(e,t)}_cloneNeighbor({start:e,end:t,direction:n,isOriginalDirection:i}){return{start:(0,ee.c)((0,z.c)(),e),end:null!=t?(0,ee.c)((0,z.c)(),t):null,direction:(0,ee.c)((0,z.c)(),n),isOriginalDirection:i}}}const ot=(0,Xe.kU)(15),at=.001;var lt,ht;!function(e){e[e.XYZ=0]="XYZ",e[e.XY=1]="XY"}(lt||(lt={})),function(e){e[e.IMMEDIATE=0]="IMMEDIATE",e[e.DEFERRED=1]="DEFERRED"}(ht||(ht={}));class ct{constructor(e,t,n=Ze.CUMULATIVE){this.origin=e,this.angle=t,this._accumulationType=n}_rotate(e,t){(0,I.r)(e.pos,e.pos,this.origin,t)}apply(e){this._rotate(e,this.angle)}undo(e){this._rotate(e,-this.angle)}canAccumulate(e){return e instanceof ct&&(0,a.aI)(this.origin,e.origin)}accumulate(e,t){const n=t._accumulationType===Ze.REPLACE;this._rotate(e,n?t.angle-this.angle:t.angle)}accumulateParams(e){const t=e._accumulationType===Ze.REPLACE;this.angle=t?e.angle:this.angle+e.angle}}class ut{constructor(e,t,n,i,r=Ze.CUMULATIVE){this.origin=e,this.axis1=t,this.factor1=n,this.factor2=i,this._accumulationType=r,this.axis2=(0,k.f)(t[1],-t[0])}_scale(e,t,n){(0,I.w)(e.pos,e.pos,this.origin,this.axis1,t),(0,I.w)(e.pos,e.pos,this.origin,this.axis2,n)}apply(e){this._scale(e,this.factor1,this.factor2)}undo(e){this._scale(e,1/this.factor1,1/this.factor2)}canAccumulate(e){return e instanceof ut&&(0,a.aI)(this.origin,e.origin)&&(0,a.aI)(this.axis1,e.axis1)}accumulate(e,t){t._accumulationType===Ze.REPLACE?this._scale(e,t.factor1/this.factor1,t.factor2/this.factor2):this._scale(e,t.factor1,t.factor2)}accumulateParams(e){const t=e._accumulationType===Ze.REPLACE;this.factor1=t?e.factor1:this.factor1*e.factor1,this.factor2=t?e.factor2:this.factor2*e.factor2}}class dt{constructor(){this._operations=[],this._closed=!1}close(){this._closed=!0}apply(){for(const e of this._operations)e.apply()}undo(){for(let e=this._operations.length-1;e>=0;e--)this._operations[e].undo()}accumulate(e){if(this._closed)return!1;const t=this._operations.length?this._operations[this._operations.length-1]:null;return t&&t.accumulate(e)||(this._operations.push(e),e.apply()),!0}}class pt extends E.A{constructor(e){super(),this.data=e,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",(e=>{e.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:e.addedVertices,operation:e.operation}),e.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:e.removedVertices,operation:e.operation}),e.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:e.updatedVertices,operation:e.operation})}))}destroy(){this._listener.remove()}splitEdge(e,t){return this._apply(new Fe(this.data,e,t))}updateVertices(e,t,n=Ee.ACCUMULATE_STEPS){return this._apply(new Be(this.data,e,t),n)}moveVertices(e,t,n,i,r=Ee.ACCUMULATE_STEPS){return this.updateVertices(e,new Ke(this.data.coordinateHelper,t,n,i),r)}scaleVertices(e,t,n,i,r,s=Ee.ACCUMULATE_STEPS,o=Ze.CUMULATIVE){return this.updateVertices(e,new ut(t,n,i,r,o),s)}rotateVertices(e,t,n,i=Ee.ACCUMULATE_STEPS,r=Ze.CUMULATIVE){return this.updateVertices(e,new ct(t,n,r),i)}removeVertices(e){return this._apply(new Ne(this.data,e,this._minNumVerticesPerType))}appendVertex(e){return 0===this.data.components.length?null:this._apply(new Ue(this.data,this.data.components[0],e))}setVertexPosition(e,t){return this._apply(new qe(this.data,e,t))}offsetEdge(e,t,n,i=Ee.ACCUMULATE_STEPS){return this.updateVertices([t.leftVertex,t.rightVertex],new st(this.data.coordinateHelper,e,t,n),i)}closeComponent(e){return this.data.components.includes(e)?this._apply(new We(this.data,e)):null}canRemoveVertex(){return this.data.components[0].vertices.length>this._minNumVerticesPerType}createUndoGroup(){const e=new dt;return this._apply(e),{remove:()=>e.close()}}undo(){if(this._undoStack.length>0){const e=this._undoStack.pop();return e.undo(),this._redoStack.push(e),e}return null}redo(){if(this._redoStack.length>0){const e=this._redoStack.pop();return e.apply(),this._undoStack.push(e),e}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(e,t=Ee.ACCUMULATE_STEPS){return t!==Ee.NEW_STEP&&null!=this.lastOperation&&this.lastOperation.accumulate(e)||(e.apply(),this._undoStack.push(e),this._redoStack=[]),e}static fromGeometry(e,t){return new pt(Ge.fromGeometry(e,t))}}class gt{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}var mt=n(75942);let _t=class extends C.A{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,r.sg)((async(e,t,n,i)=>{const r=this._frameTask;if(null==r)return;const s=await r.schedule((()=>t.snap({...e,context:n,signal:i})),i);s.valid&&await r.schedule((()=>{this.stagedPoint=s.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update({...this._snapPoints,context:n}))}),i)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){const e="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=e?e.registerTask(mt.W6.SNAPPING):mt.nu}destroy(){this._abortController=(0,b.DC)(this._abortController),this._frameTask=(0,b.xt)(this._frameTask)}update(e,t,n){this._snapPoints=e;const{point:i,scenePoint:r}=e,s=t.update({point:i,scenePoint:r,context:n});return this.stagedPoint=s,s}async snap(e,t,n){const{point:i,scenePoint:r}=e;return this.stagedPoint=t.update({point:i,scenePoint:r,context:n}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,n,this._abortController.signal)}async resnap(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,b.DC)(this._abortController),this._snapPoints=null}};var ft;(0,i._)([(0,o.MZ)({constructOnly:!0})],_t.prototype,"view",void 0),(0,i._)([(0,o.MZ)()],_t.prototype,"stagedPoint",null),(0,i._)([(0,o.MZ)()],_t.prototype,"constrainResult",void 0),(0,i._)([(0,o.MZ)()],_t.prototype,"_stagedPoint",void 0),_t=(0,i._)([(0,l.$)("geoscene.views.interactive.snapping.SnappingOperation")],_t);let vt=ft=class extends E.A.EventedAccessor{constructor(e){super(e),this._hasZ=null,this._cursorScreenPoint=null,this._activePointerId=null,this._stagedVertexUnsnapped=null,this._lastVertexUnsnapped=null,this._handles=new Z.A,this._viewHandlesKey="view-handles",this._undoRedoHandlesKey="undo-redo-handles",this._drawToolHandlesKey="draw-tool",this._nativeEventHistory={undoStack:[],redoStack:[]},this.interactiveUndoDisabled=!1,this.history=[],this.redoHistory=[],this.snapToScene=!1,this.view=null,this.elevationInfo=null,this.defaultZ=0,this._coordinateHelper=Oe(!!e.hasZ,!1,e.view.spatialReference),this._snappingManager=e.snappingManager,this._editGeometryOperations=new pt(new Ge(e.editGeometryType??"polygon",this._coordinateHelper)),this._snappingGraphicsLayer=new P.A({id:ft.SNAPPING_GRAPHICS_LAYER_ID,listMode:"hide",internal:!0}),this._snappingContext=new gt({editGeometryOperations:this._editGeometryOperations,elevationInfo:{mode:"on-the-ground",offset:0},pointer:"mouse",visualizer:new pe(this._snappingGraphicsLayer)}),this._activeComponent=new ze(e.view.spatialReference,V.RT.Local),this._editGeometryOperations.data.components.push(this._activeComponent)}normalizeCtorArgs(e){const t={...e};return delete t.editGeometryType,t}initialize(){this._snappingOperation=new _t({view:this.view}),"2d"===this.view.type&&this.view.map.layers.add(this._snappingGraphicsLayer)}destroy(){this._handles.destroy(),this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this._snappingOperation=(0,b.pR)(this._snappingOperation),this._editGeometryOperations.destroy()}get _committedVertices(){return this._editGeometryOperations.data.components[0].vertices.map((e=>e.pos))}get vertices(){return null!=this._stagedVertex?[...this._committedVertices,this._coordinateHelper.pointToArray(this._stagedVertex)]:this._committedVertices}get hasZ(){return null!=this._hasZ?this._hasZ:"3d"===this.view.type}set hasZ(e){this._hasZ=e,this.notifyChange("hasZ")}get _stagedVertex(){return this._snappingOperation.stagedPoint}set _stagedVertex(e){this._snappingOperation.stagedPoint=(0,R.o8)(e)}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this.canUndo&&this._editGeometryOperations.undo()}redo(){this.canRedo&&this._editGeometryOperations.redo()}getCoordsFromScreenPoint(e){const t=e&&this.screenToMap(e);return null==t?null:t.hasZ?[t.x,t.y,t.z]:[t.x,t.y]}getCoordsAndPointFromScreenPoint(e){const t=this.screenToMap(e);return null==t?null:t.hasZ?{vertex:[t.x,t.y,t.z],mapPoint:t}:{vertex:[t.x,t.y],mapPoint:t}}screenToMap(e){let t=null;if("3d"===this.view.type)if(this.hasZ){const n=this.elevationInfo??yt;t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,L.gs)(e.x,e.y),n,this._getGeometryZValue())}else{const n=this.elevationInfo??wt;t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,L.gs)(e.x,e.y),n,0),null!=t&&(t.z=void 0)}else t=this.view.toMap(e),null!=t&&(t.z=this.hasZ?this._getGeometryZValue():void 0);return t}_pushCursorVertex(e,t){const n=(0,H.TH)(e[0],e[1],void 0,this.view.spatialReference);this._stagedVertexUnsnapped=n;const i=this._snappingManager;if(null==i)return this._stagedVertex=n,void t();(0,r.QZ)(this._snappingOperation.snap({point:n},i,this._snappingContext)).then((()=>{t()}))}_popCursorVertex(){this._stagedVertexUnsnapped=null,this._stagedVertex=null}_getGeometryZValue(){return this.defaultZ}_abortSnapping(){this._snappingOperation.abort()}_isDuplicateOfLastVertex(e){const t=this._editGeometryOperations.data.components[0].getLastVertex()?.pos;if(t&&e[0]===t[0]&&e[1]===t[1])return!0;const{x:n,y:i}=this._coordinateHelper.vectorToDehydratedPoint(e);return null!=this._lastVertexUnsnapped&&n===this._lastVertexUnsnapped.x&&i===this._lastVertexUnsnapped.y}_shouldHandlePointerEvent(e){return this._isPrimaryPointerAction(e)&&(null==this._activePointerId||this._activePointerId===e.pointerId)}_vertexAddHandler(e){const t=null!=this._stagedVertex?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);null!=t&&this._addVertex(t,e.native)}_drawCompleteHandler(e){this._completeDrawing(e.native)}_isPrimaryPointerAction(e){return"mouse"!==e.pointerType||0===e.button}};vt.SNAPPING_GRAPHICS_LAYER_ID="DrawAction-snapping-graphics-layer",(0,i._)([(0,o.MZ)({readOnly:!0})],vt.prototype,"vertices",null),(0,i._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],vt.prototype,"interactiveUndoDisabled",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],vt.prototype,"history",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],vt.prototype,"redoHistory",void 0),(0,i._)([(0,o.MZ)()],vt.prototype,"snapToScene",void 0),(0,i._)([(0,o.MZ)()],vt.prototype,"view",void 0),(0,i._)([(0,o.MZ)()],vt.prototype,"elevationInfo",void 0),(0,i._)([(0,o.MZ)({nonNullable:!0})],vt.prototype,"defaultZ",void 0),(0,i._)([(0,o.MZ)()],vt.prototype,"hasZ",null),(0,i._)([(0,o.MZ)()],vt.prototype,"_snappingOperation",void 0),(0,i._)([(0,o.MZ)()],vt.prototype,"_stagedVertex",null),vt=ft=(0,i._)([(0,l.$)("geoscene.views.draw.DrawAction")],vt);const yt={mode:"absolute-height",offset:0},wt={mode:"on-the-ground",offset:0},xt=vt;class At{constructor(e,t,n,i){this.view=e,this.native=t,this.vertexIndex=n,this.vertices=i,this.defaultPrevented=!1,this.type="vertex-add"}preventDefault(){this.defaultPrevented=!0}}class bt{constructor(e,t,n,i){this.view=e,this.native=t,this.vertexIndex=n,this.vertices=i,this.defaultPrevented=!1,this.type="vertex-remove"}preventDefault(){this.defaultPrevented=!0}}class Mt{constructor(e,t,n,i,r=null){this.view=e,this.native=t,this.vertexIndex=n,this.vertices=i,this.mapPoint=r,this.coordinates=null,this.defaultPrevented=!1,this.type="cursor-update",this.coordinates=1===i.length?i[0]:null}preventDefault(){this.defaultPrevented=!0}}class St{constructor(e,t){this.native=e,this.vertices=t,this.coordinates=null,this.defaultPrevented=!1,this.type="draw-complete",this.coordinates=1===t.length?t[0]:null}preventDefault(){this.defaultPrevented=!0}}var Tt=n(16824);const Pt={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},Vt={toggle:"Control"};var Ct=n(83350);let Ot=class extends xt{constructor(e){super(e),this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1}initialize(){this._addViewHandles(),this._addUndoRedoHandles()}destroy(){this._removeViewHandles(),this._removeUndoRedoHandles(),this.emit("destroy")}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){this._completeDrawing()}_addViewHandles(){this._removeViewHandles(),this._handles.add([this.view.on("click",(e=>{e.stopPropagation()}),Tt.o.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,Ct.ZV)(e),"touch"===e.pointerType&&this._updateCursor(e.native))}),Tt.o.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._abortSnapping(),this._cursorScreenPoint=(0,Ct.ZV)(e),"touch"!==e.pointerType&&this._updateCursor(e.native)}),Tt.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._addVertexOnPointerUp=!1)}),Tt.o.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp)this._vertexAddHandler(e);else{const t="touch"===e.pointerType;this._updateCursor(e.native,t)}}),Tt.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),Tt.o.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),Tt.o.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),Tt.o.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:n}=e;t===Pt.vertexAdd&&!n&&this._cursorScreenPoint?(e.stopPropagation(),this._abortSnapping(),this._vertexAddHandler(e)):t!==Pt.complete||n?t!==Pt.undo||this.interactiveUndoDisabled||n?t!==Pt.redo||this.interactiveUndoDisabled||n?t!==Pt.pan||n||e.stopPropagation():(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e))}),Tt.o.TOOL),this.view.on("key-up",(e=>{e.key===Pt.pan&&e.stopPropagation()}),Tt.o.TOOL)],this._viewHandlesKey)}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this._handles.add([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=this._nativeEventHistory.undoStack.pop();this._nativeEventHistory.redoStack.push(t);const n=[...this._committedVertices];null!=this._stagedVertex&&n.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new bt(this.view,t,e.vertices[0].index,n))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._nativeEventHistory.undoStack[this._nativeEventHistory.undoStack.length],t=this._committedVertices.length-1,n=new At(this.view,e,t,this.vertices);this.emit("vertex-add",n),n.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=this._nativeEventHistory.redoStack.pop();this._nativeEventHistory.undoStack.push(t);const n=[...this._committedVertices];null!=this._stagedVertex&&n.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new At(this.view,t,e.vertices[0].index,n))}}))],this._undoRedoHandlesKey)}_removeViewHandles(){this._handles.remove(this._viewHandlesKey)}_removeUndoRedoHandles(){this._handles.remove(this._undoRedoHandlesKey)}_addVertex(e,t){const n=this._coordinateHelper.arrayToVector(e);if(this._isDuplicateOfLastVertex(n))return;this._popCursorVertex(),this._editGeometryOperations.appendVertex(n);const i=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(i)}_updateCursor(e,t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const n=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==n||t||this._pushCursorVertex(n.vertex,(()=>this.emit("cursor-update",new Mt(this.view,e,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new ue.A(this._stagedVertex):null))))}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const t=new St(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}};Ot=(0,i._)([(0,l.$)("geoscene.views.draw.MultipointDrawAction")],Ot);var Et=n(45477),Zt=n(25120),Rt=(n(17642),n(58004),n(33853),n(45876),n(32475),n(15024),n(31698),n(47161)),Lt=n(7194);const Ht=["freehand","hybrid","click"],Dt="click";class It{constructor({grabbableForEvent:e}){this.events=new E.A,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=e}intersectionDistance(e,t){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}n(48119),n(55772);var kt,zt=n(12790);function Gt(e){return"declaredClass"in e}function Ut(e,t){if(!e)return null;let n;if(Gt(e)){if(null==t)return e.clone();if(Gt(t))return t.copy(e)}return null!=t?(n=t,n.x=e.x,n.y=e.y,n.spatialReference=e.spatialReference,e.hasZ?(n.z=e.z,n.hasZ=e.hasZ):(n.z=void 0,n.hasZ=!1),e.hasM?(n.m=e.m,n.hasM=!0):(n.m=void 0,n.hasM=!1)):(n=(0,H.TH)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(n.m=e.m,n.hasM=!0)),n}function Bt(e){const{wkid:t,wkt:n,latestWkid:i}=e,r={wkid:t,wkt:n,latestWkid:i};return zt.A.fromJSON(r)}!function(e){e[e.EnableFastUpdates=0]="EnableFastUpdates",e[e.DisableFastUpdates=1]="DisableFastUpdates",e[e.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"}(kt||(kt={}));n(99359),n(84509);var Nt=n(55040);function Ft(e,t,n,i){if(null==i||e.hasZ||(i=void 0),"point"===e.type)return e.x+=t,e.y+=n,e.hasZ&&null!=i&&(e.z+=i),e;if("multipoint"===e.type){const r=e.points;for(let e=0;e<r.length;e++)r[e]=qt(r[e],t,n,i);return e}if("extent"===e.type)return e.xmin+=t,e.xmax+=t,e.ymin+=n,e.ymax+=n,null!=i&&(e.zmin??=0,e.zmin+=i,e.zmax??=0,e.zmax+=i),e;const r=(0,Nt.$K)(e),s="polyline"===e.type?e.paths:e.rings;for(let o=0;o<r.length;o++){const e=r[o];for(let r=0;r<e.length;r++)e[r]=qt(e[r],t,n,i)}return"paths"in e?e.paths=s:e.rings=s,e}function qt(e,t,n,i){return Wt(e,e[0]+t,e[1]+n,null!=e[2]&&null!=i?e[2]+i:void 0)}function Wt(e,t,n,i){const r=[t,n];return e.length>2&&r.push(null!=i?i:e[2]),e.length>3&&r.push(e[3]),r}function Kt(e,t){let n=null,i=null;return r=>{if("cancel"===r.action)return void(null!=i&&(i.execute({action:"cancel"}),n=null,i=null));const s={action:r.action,screenStart:r.start,screenEnd:r.screenPoint};"start"===r.action&&null==n&&(n=new nn,i=new nn,t(e,n,i,r.pointerType,s)),null!=n&&n.execute(s),"end"===r.action&&null!=n&&(n=null,i=null)}}function Yt(e,t){return e.events.on("drag",Kt(e,t))}function Xt(e,t){let n=null;return i=>{if("start"===i.action&&(n=jt(e,i.mapStart.spatialReference,t)),null==n)return null;const r=i.mapEnd.x-i.mapStart.x,s=i.mapEnd.y-i.mapStart.y,o=i.mapEnd.z-i.mapStart.z;return n.move(r,s,o,i.action),{...i,translationX:r,translationY:s,translationZ:o}}}function Qt(e,t){return null==e?null:e.spatialReference.equals(t)?e.clone():(0,u.Cv)(e,t)}function jt(e,t,n){const i=e.geometry,r=Bt(t);if(null==i)return null;if("mesh"===i.type)return Jt(e,i,r,n);const s=Qt(i,r),o=i.spatialReference;return null==s?null:{move:(t,n,i)=>{const r=Ft(s.clone(),t,n,i);r.spatialReference.equals(o)?e.geometry=r:e.geometry=(0,u.Cv)(r,o)}}}function Jt(e,t,n,i){if(t.vertexSpace.isRelative)return $t(e,t,t.vertexSpace,n);if(!t.spatialReference.equals(n))return null;let r=0,s=0,o=0;return{move:(n,a,l)=>{const h=n-r,c=a-s,u=l-o;if(h||c||u){const d=new ue.A(t.origin.x+h,t.origin.y+c,(t.origin.z??0)+u,t.origin.spatialReference);t.centerAt(d,{geographic:t.vertexSpace.isRelative?void 0:i===V.RT.Global}),e.notifyGeometryChanged(),r=n,s=a,o=l}}}}function $t(e,t,n,i){const r=Qt(n.getOriginPoint(t.spatialReference),i),s=t.spatialReference;return null==r?null:{move:(t,i,o,a)=>{const l=Ft(r.clone(),t,i,o);if(l.spatialReference.equals(s))n.setOriginFormPoint(l);else{const e=(0,u.Cv)(l,s);null!=e&&n.setOriginFormPoint(e)}if(n.isGeoreferenced)e.notifyGeometryChanged();else{const t="end"===a;e.notifyMeshTransformChanged(t?{action:kt.UpdateFastLocalOrigin}:{})}}}}function en(e,t=null,n){let i=null;const r=null==t||e.spatialReference?.equals(t)?e=>e:e=>null!=e?(0,u.Cv)(e,t):e,s={exclude:[],...n};return t=>{if("start"===t.action&&(i=r(e.toMap(t.screenStart,s))),null==i)return null;const n=r(e.toMap(t.screenEnd,s));return null!=n?{...t,mapStart:i,mapEnd:n}:null}}const tn=()=>{};class nn{constructor(){this.execute=tn}next(e,t=new nn){return null!=e&&(this.execute=n=>{const i=e(n);null!=i&&t.execute(i)}),t}}function rn(e,t,n=[]){if("2d"===e.type)return e=>e;let i=null;return r=>{"start"===r.action&&(i=e.toMap(r.screenStart,{exclude:n}),null!=i&&(i.z=(0,Zt.id)(i,e,t)));const s=e.toMap(r.screenEnd,{exclude:n});null!=s&&(s.z=(0,Zt.id)(s,e,t));const o=null!=i&&null!=s?{sceneStart:i,sceneEnd:s}:null;return{...r,scenePoints:o}}}let sn=class extends C.A{constructor(e){super(e),this.enabled=!1}};(0,i._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],sn.prototype,"enabled",void 0),sn=(0,i._)([(0,l.$)("geoscene.views.interactive.sketch.SketchLabelOptions")],sn);const on=sn;let an=class extends C.A{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};(0,i._)([(0,o.MZ)({type:String,nonNullable:!0})],an.prototype,"mode",void 0),an=(0,i._)([(0,l.$)("geoscene.widgets.Sketch.SketchTooltipOptions.ElevationOptions")],an);let ln=class extends C.A{constructor(){super(...arguments),this.distance=!0,this.elevation=!0,this.size=!0,this.scale=!0,this.rotation=!0,this.orientation=!0,this.totalLength=!0,this.area=!0,this.radius=!0,this.helpMessage=!1}toJSON(){return{distance:this.distance,size:this.size,scale:this.scale,rotation:this.rotation,orientation:this.orientation,totalLength:this.totalLength,area:this.area,radius:this.radius}}};(0,i._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],ln.prototype,"distance",void 0),(0,i._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],ln.prototype,"elevation",void 0),(0,i._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],ln.prototype,"size",void 0),(0,i._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],ln.prototype,"scale",void 0),(0,i._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],ln.prototype,"rotation",void 0),(0,i._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],ln.prototype,"orientation",void 0),(0,i._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],ln.prototype,"totalLength",void 0),(0,i._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],ln.prototype,"area",void 0),(0,i._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],ln.prototype,"radius",void 0),(0,i._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],ln.prototype,"helpMessage",void 0),ln=(0,i._)([(0,l.$)("geoscene.widgets.Sketch.SketchTooltipOptions.VisibleElements")],ln);let hn=class extends C.A{constructor(e){super(e),this.enabled=!1,this.elevation=new an,this.visibleElements=new ln,this.visualVariables=null}toJSON(){return{enabled:this.enabled,elevation:this.elevation,visibleElements:this.visibleElements}}};(0,i._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],hn.prototype,"enabled",void 0),(0,i._)([(0,o.MZ)({type:an,nonNullable:!0})],hn.prototype,"elevation",void 0),(0,i._)([(0,o.MZ)({type:ln,nonNullable:!0})],hn.prototype,"visibleElements",void 0),(0,i._)([(0,o.MZ)()],hn.prototype,"visualVariables",void 0),hn=(0,i._)([(0,l.$)("geoscene.widgets.Sketch.SketchTooltipOptions")],hn);const cn=hn;function un({predicate:e=()=>!0,snappingManager:t,snappingContext:n,updatingHandles:i,useZ:s=!0}){const o=new nn;if(null==t)return{snappingStep:[wn,o],cancelSnapping:wn};let a,l=null,h=null,u=null;const d=()=>{l=(0,b.DC)(l),t.doneSnapping(),null!=h&&h.frameTask.remove(),h=null,a=(0,b.xt)(a),u=null},p=dn(t,s,o);let g=null,m=null,_=null;return{snappingStep:[o=>{if(!e(o))return o;const{action:f}=o;if("start"===f){const{info:e}=o,i=pn(t.view);if(h=gn(n,o,i),h.context.selfSnappingZ=null,!s&&null!=e){const t=yn(n.coordinateHelper,e.handle.component);null!=t&&(h.context.selfSnappingZ={value:t,elevationInfo:n.elevationInfo??Zt.qt})}}if(null!=h){const{context:e,originalScenePos:n,originalPos:d}=h,{mapEnd:v,mapStart:y,scenePoints:w}=o,x=mn(d,fn(v,y)),A=fn(y,d),b={...o,action:"update"},M=h.context,S=_n(n,w),T=t.update({point:x,scenePoint:S,context:e});if(_=T,vn(v,T,A,s),g=x,m=S,"end"!==f){const{frameTask:e}=h;null==l&&(l=new AbortController),u=t=>{i.addPromise((0,r.QZ)(p({frameTask:e,event:b,context:M,point:x,scenePoint:S,delta:A,getLastState:()=>({point:g,scenePoint:m,updatePoint:t.forceUpdate?null:_})},l.signal)))},u({forceUpdate:!1}),null==a&&(a=(0,c.wB)((()=>t.options.effectiveEnabled),(()=>u?.({forceUpdate:!0}))))}}return"end"===f&&d(),o},o],cancelSnapping:e=>(d(),e)}}function dn(e,t,n){return(0,r.sg)((async({frameTask:i,point:r,scenePoint:s,context:o,event:a,delta:l,getLastState:h},c)=>{const u=await i.schedule((()=>e.snap({point:r,scenePoint:s,context:o,signal:c})),c);if(u.valid){let s=await i.schedule((()=>u.apply()),c);const d=h();null!=d.point&&r!==d.point&&(s=e.update({point:d.point,scenePoint:d.scenePoint,context:o})),null!=d.updatePoint&&(0,Lt.C)(s,d.updatePoint)||(vn(a.mapEnd,s,l,t),n.execute(a))}}))}function pn(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(mt.W6.SNAPPING):mt.nu}function gn(e,t,n){return{context:new gt({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:null!=t.info?t.info.handle:null,excludeFeature:e.excludeFeature,visualizer:e.visualizer}),originalPos:null!=t.snapOrigin?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:null!=t.scenePoints?t.scenePoints.sceneStart:null,frameTask:n}}function mn(e,[t,n,i]){const r=Ut(e);return r.x+=t,r.y+=n,r.hasZ&&(r.z+=i),r}function _n(e,t){return null==e||null==t?null:mn(e,fn(t.sceneEnd,t.sceneStart))}function fn(e,t){const n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function vn(e,t,[n,i,r],s){e.x=t.x+n,e.y=t.y+i,s&&e.hasZ&&t.hasZ&&(e.z=t.z+r)}function yn(e,t){if(!e.hasZ())return null;const n=t.vertices;let i=null;for(const r of n){const t=e.getZ(r.pos);if(null!=i&&null!=t&&Math.abs(t-i)>1e-6)return null;null==i&&(i=t)}return i}function wn(e){return e}(0,H.TH)(0,0,0,null);var xn;function An(e,t=()=>{}){const n=(0,c.wB)((()=>({view:e.view,snappingOptions:e.snappingOptions})),(({view:n,snappingOptions:i})=>{const r="snapping-toggle",s=Tt.o.TOOL;if(e.removeHandles(r),n&&null!=i){const o=[n.on("key-down",(e=>{e.key!==Vt.toggle||e.repeat||(i.enabledToggled=!0,t())}),s),n.on("key-up",(e=>{e.key===Vt.toggle&&(i.enabledToggled=!1,t())}),s),n.on("pointer-move",(e=>{const n=e.native.ctrlKey;i.enabledToggled!==n&&(i.enabledToggled=n,t())}),s)];e.addHandles(o,r)}}),c.pc);e.addHandles(n)}!function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(xn||(xn={}));let bn=class extends(E.A.EventedMixin(Et.a)){constructor(e){super(e),this._createOperationCompleted=!1,this._pointerDownStates=new Set,this._stagedScreenPoint=null,this._stagedPointerType=null,this.isDraped=!0,this.labelOptions=new on,this.tooltipOptions=new cn,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.lastVertex=null,null==e.elevationInfo&&(this.elevationInfo=(0,Zt.bK)(!!e.hasZ))}initialize(){const{geometryType:e,view:t}=this,n=t.spatialReference,i="viewingMode"in t.state?t.state.viewingMode:V.RT.Local,s="segment"===e||"multipoint"===e?"polyline":e;this.coordinateHelper=Oe(this.hasZ,this.hasM,n),this._editGeometryOperations=new pt(new Ge(s,this.coordinateHelper)),this._snappingOperation=new _t({view:t,constrainResult:e=>null==e?e:this._getEffectiveDrawSurface()?.constrainZ(e)}),this.addHandles([(0,c.wB)((()=>this.stagedVertex),(e=>{null!=e&&this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(e)}],operation:"apply",type:"vertex-update"})}),{sync:!0,equals:(e,t)=>(0,b.CM)(e,t,Lt.C)}),(0,c.wB)((()=>this.view.viewpoint),((e,t)=>{e&&t&&(0,Rt.Ui)(e,t)&&this._onViewpointChange()}))]),this._activeComponent=new ze(n,i),this._editGeometryOperations.data.components.push(this._activeComponent);const o=this.segmentLabels;null!=o&&(o.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles([(0,c.wB)((()=>this.labelOptions.enabled),(e=>{o.visible=e}),c.pc),this.on("cursor-update",(()=>{const e=this.stagedVertex;o.stagedVertex=null!=e?this.coordinateHelper.pointToVector(e):null}))])),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(e=>{const t=e.vertices.map((e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)}))),n=t.map((e=>e.coordinates));switch(e.type){case"vertex-add":this.emit(e.type,{...e,added:n,vertices:t});break;case"vertex-update":this.emit(e.type,{...e,updated:n,vertices:t});break;case"vertex-remove":this.emit(e.type,{...e,removed:n,vertices:t})}const i=this._activeComponent.getLastVertex(),r=null!=i?this.coordinateHelper.vectorToDehydratedPoint(i.pos):null;null!=r&&null!=this.lastVertex&&(0,Lt.C)(this.lastVertex,r)||(this.lastVertex=r)})));const a=this._manipulator=new It({grabbableForEvent:e=>"click"!==this.drawingMode||"touch"===e.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size});this.manipulators.add(a),a.grabbable="point"!==e,this.addHandles([this._createManipulatorDragPipeline(a),a.events.on("immediate-click",(e=>this._onImmediateClick(e))),a.events.on("immediate-double-click",(e=>this._onImmediateDoubleClick(e))),(0,c.wB)((()=>({cursor:this.cursor,loading:this.loading})),(({cursor:e,loading:t})=>{a.cursor=t?"progress":e}),c.pc)]),An(this,(()=>{const e=this.view.inputManager.latestPointerType??"mouse",t=this._getSnappingContext(e);null!=this.snappingManager&&this.updatingHandles.addPromise((0,r.QZ)(this._snappingOperation.resnap(this.snappingManager,t)))}))}destroy(){(0,b.pR)(this.segmentLabels),(0,b.pR)(this._snappingOperation),this._editGeometryOperations=(0,b.pR)(this._editGeometryOperations)}get _snappingEnabled(){return null!=this.snappingManager&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const e=this._getEffectiveDrawSurface();return"3d"===this.view.type&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((e=>this.coordinateHelper.vectorToArray(e.pos)))}set drawingMode(e){this._set("drawingMode",e??Dt)}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return null!=this.stagedVertex?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get snappingOptions(){return null!=this.snappingManager?this.snappingManager.options:null}get stagedVertex(){return this._snappingOperation.stagedPoint}set stagedVertex(e){this._snappingOperation.stagedPoint=(0,R.o8)(e)}get updating(){return this.updatingHandles.updating}get vertices(){const e=this.committedVertices;return null!=this.stagedVertex&&e.push(this.coordinateHelper.pointToArray(this.stagedVertex)),e}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingOperation.abort(),null!=this.stagedVertex){const{stagedVertex:e}=this;this.stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}}complete(e){const t=e&&e.aborted||!1;this._snappingOperation.abort(),null!=this.snappingManager&&this.snappingManager.doneSnapping(),"segment"===this.geometryType||"point"===this.geometryType?this.commitStagedVertex():this.stagedVertex=null;const n="multipoint"===this.geometryType&&0===this.numVertices||"polyline"===this.geometryType&&this.numVertices<2||"polygon"===this.geometryType&&this.numVertices<3;this._createOperationCompleted=!n,(this.isCompleted||t)&&this.emit("complete",{vertices:this.vertices.map(((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e}))),aborted:t,type:"complete"})}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(e){const t=this._activeComponent;if("polygon"===this.geometryType&&t.vertices.length>2){if(this._vertexWithinPointerDistance(t.vertices[0].pos,e))return 0;if(this._vertexWithinPointerDistance(t.vertices[t.vertices.length-1].pos,e))return t.vertices.length-1}return null}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return Yt(e,((e,t,n,i)=>{const r="touch"===i&&this._snappingEnabled;if(this.isCompleted||!r)return;const{snappingStep:s,cancelSnapping:o}=un({predicate:()=>r,snappingManager:this.snappingManager,snappingContext:new gt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:i,visualizer:this.snappingVisualizer}),updatingHandles:this.updatingHandles,useZ:!this._requiresScenePoint});n=n.next((e=>(r&&null!=this.snappingManager&&this.snappingManager.doneSnapping(),e))).next(o),t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,("segment"===this.geometryType||r&&0===this.numVertices)&&this.commitStagedVertex()),e))).next(rn(this.view,this.elevationInfo)).next(...s).next((e=>(r&&(this.stagedVertex=e.mapEnd,"end"===e.action&&this.commitStagedVertex()),e))).next((e=>("end"===e.action&&("segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),e)))}))}_createManipulatorDragPipelineFreehand(e){return Yt(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(null==this.stagedVertex&&(this.stagedVertex=e.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return e}))}))}_createManipulatorDragPipelineHybrid(e){return Yt(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(null==this.stagedVertex&&(this.stagedVertex=e.mapStart),this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return e}))}))}get _drawAtFixedElevation(){return("segment"===this.geometryType||"polygon"===this.geometryType)&&this.numCommittedVertices>0}_getEffectiveDrawSurface(){if(null==this.elevationDrawSurface)return this.drawSurface;if(!this.coordinateHelper.hasZ())return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let e=this.defaultZ,t=!1;return null!=this.elevationInfo&&"absolute-height"===this.elevationInfo.mode&&(t=!0),null!=this.snapToSceneEnabled&&(t=this.snapToSceneEnabled),null!=this.elevationInfo&&"on-the-ground"===this.elevationInfo.mode&&(t=!1),this._drawAtFixedElevation&&(e=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),t=!1),t?this.drawSurface:(this.elevationDrawSurface.defaultZ=e,this.elevationDrawSurface)}_mapToScreen(e){return this._getEffectiveDrawSurface()?.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&(this.stagedVertex=e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if("mouse"===e.pointerType&&2===e.button||this._manipulator.dragging)return;const t=this._activeComponent;if(null!=this._closeOnClickVertexIndex(e.screenPoint))return e.stopPropagation(),void this.complete();const n=this._screenToMap(e.screenPoint);if(null!=n)switch(this.drawingMode){case"freehand":"point"===this.geometryType&&(null!=this.stagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(n)),this.complete());break;case"click":case"hybrid":this._snappingOperation.abort(),null!=this.stagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(n)),("point"===this.geometryType||"segment"===this.geometryType&&2===t.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===t.vertices.length)&&this.complete()}e.stopPropagation()}_onImmediateDoubleClick(e){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}_onPointerMove(e){const t=(0,L.tc)(e.x,e.y);this._stagedScreenPoint=t,this._stagedPointerType=e.pointerType;const n=this._snappingOperation,i=this._manipulator;i.dragging||this._pointerDownStates.has(e.pointerId)||i.grabbing||!i.interactive?n.abort():(e.stopPropagation(),this._updateStagedVertexOnPointerMove(t,e.pointerType))}_onViewpointChange(){const e=this._manipulator;this._stagedScreenPoint&&!e.dragging&&!e.grabbing&&e.interactive?this._updateStagedVertexOnPointerMove(this._stagedScreenPoint,this._stagedPointerType??"mouse"):this._snappingOperation.abort()}_updateStagedVertexOnPointerMove(e,t){const n=this._snappingOperation,i=this._closeOnClickVertexIndex(e);if(null!=i)return this._closeOnVertex(i),void n.abort();const s=this._screenToMap(e),o=this._requiresScenePoint?this.drawSurface?.screenToMap(e):null;if(null==s)return this.cursor=null,void n.abort();this.cursor="crosshair";const a=this.snappingManager;if(null==a)return this.stagedVertex=s,void n.abort();const l=this._getSnappingContext(t);this.updatingHandles.addPromise((0,r.QZ)(n.snap({point:s,scenePoint:o},a,l)))}_closeOnVertex(e){this.stagedVertex=null;const t={componentIndex:0,vertexIndex:e,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[e].pos)};this.emit("cursor-update",{updated:null,vertices:[t],operation:"apply",type:"vertex-update"})}_screenToMap(e){return this._getEffectiveDrawSurface()?.screenToMap(e)}_screenToMapDragEventStep(){let e=null;return t=>{if("start"===t.action&&(e=this._screenToMap(t.screenStart)),null==e)return null;const n=this._screenToMap(t.screenEnd);return null!=n?{...t,mapStart:e,mapEnd:n}:null}}_vertexWithinPointerDistance(e,t){const n=25,i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return null!=i&&Mn(i,t,n)}_getSnappingContext(e){const t=this._drawAtFixedElevation?(0,b.Rh)(this.elevationDrawSurface,(({defaultZ:e})=>e)):null;return new gt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,visualizer:this.snappingVisualizer,selfSnappingZ:null!=t?{value:t,elevationInfo:this.elevationInfo}:null})}};function Mn(e,t,n){const i=e.x-t.x,r=e.y-t.y;return i*i+r*r<=n}(0,i._)([(0,o.MZ)()],bn.prototype,"_snappingEnabled",null),(0,i._)([(0,o.MZ)()],bn.prototype,"defaultZ",void 0),(0,i._)([(0,o.MZ)()],bn.prototype,"isDraped",void 0),(0,i._)([(0,o.MZ)({value:Dt})],bn.prototype,"drawingMode",null),(0,i._)([(0,o.MZ)({constructOnly:!0})],bn.prototype,"elevationDrawSurface",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],bn.prototype,"elevationInfo",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0,type:on})],bn.prototype,"labelOptions",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0,type:cn})],bn.prototype,"tooltipOptions",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],bn.prototype,"geometryType",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],bn.prototype,"hasM",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],bn.prototype,"hasZ",void 0),(0,i._)([(0,o.MZ)()],bn.prototype,"cursor",void 0),(0,i._)([(0,o.MZ)()],bn.prototype,"loading",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],bn.prototype,"manipulators",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],bn.prototype,"drawSurface",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],bn.prototype,"segmentLabels",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],bn.prototype,"snappingManager",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],bn.prototype,"snappingVisualizer",void 0),(0,i._)([(0,o.MZ)()],bn.prototype,"snapToSceneEnabled",void 0),(0,i._)([(0,o.MZ)()],bn.prototype,"_snappingOperation",void 0),(0,i._)([(0,o.MZ)()],bn.prototype,"stagedVertex",null),(0,i._)([(0,o.MZ)()],bn.prototype,"lastVertex",void 0),(0,i._)([(0,o.MZ)()],bn.prototype,"updating",null),(0,i._)([(0,o.MZ)({constructOnly:!0})],bn.prototype,"view",void 0),bn=(0,i._)([(0,l.$)("geoscene.views.draw.DrawOperation")],bn);class Sn{constructor(e,t,n,i=null){this._elevationInfo=e,this.defaultZ=t,this._view=n,this._excludeGraphics=i}screenToMap(e){if(null!=this.defaultZ)return this._view.sceneIntersectionHelper.intersectElevationFromScreen((0,L.gs)(e.x,e.y),this._elevationInfo,this.defaultZ,this._excludeGraphics);const t=this._view.sceneIntersectionHelper.intersectElevationFromScreen((0,L.gs)(e.x,e.y),this._elevationInfo,0,this._excludeGraphics);return null!=t&&(t.z=void 0),t}mapToScreen(e){const t=(0,H.TH)(e.x,e.y,(0,Zt.wS)(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(t)}constrainZ(e){const{defaultZ:t}=this;return null!=t&&e.z!==t&&((e=Ut(e)).z=t),e}}class Tn{constructor(e,t,n=[]){this.view=e,this.elevationInfo=t,this.exclude=n}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude});return null!=t&&(t.z=(0,Zt.id)(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return null!=this.elevationInfo&&(t=(0,H.TH)(e.x,e.y,(0,Zt.wS)(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}constrainZ(e){return e}}var Pn,Vn=n(95642),Cn=n(41879);!function(e){e[e.WhenToolEditable=0]="WhenToolEditable",e[e.WhenToolNotEditable=1]="WhenToolNotEditable",e[e.Always=2]="Always"}(Pn||(Pn={}));class On{constructor(){this._isToolEditable=!0,this._manipulators=new Cn.A,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=Pn.WhenToolEditable){this.addMany([e],t)}addMany(e,t=Pn.WhenToolEditable){for(const n of e){const e={manipulator:n,visibilityPredicate:t,attached:!1};this._manipulators.add(e),this._attached&&this._updateManipulatorAttachment(e)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){const e=this._manipulators.splice(t,1)[0];this._detachManipulator(e);break}}removeAll(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((e=>{this._updateManipulatorAttachment(e)})),this._attached=!0}detach(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((({manipulator:e})=>{e.destroy&&e.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,(e=>{t(e)}))}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach((t=>e.push(t.manipulator))),e}intersect(e,t){let n=null,i=Number.MAX_VALUE;return this._manipulators.forEach((({manipulator:r,attached:s})=>{if(!s||!r.interactive)return;const o=r.intersectionDistance(e,t);null!=o&&o<i&&(i=o,n=r)})),n}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===Pn.Always||(this._isToolEditable?e.visibilityPredicate===Pn.WhenToolEditable:e.visibilityPredicate===Pn.WhenToolNotEditable)}}let En=class extends C.A{constructor(e){super(e),this.manipulators=new On,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[Vn.PK.MANAGER,!0],[Vn.PK.USER,!0]]),this._creationFinishedResolver=(0,r.Tw)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(Vn.PK.USER)}set editable(e){this.setEditableFlag(Vn.PK.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view?(this.view.focus(),this.onActivate()):O.A.getLogger(this).error("Can't activate tool if view is not defined.")}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===Vn.PK.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(Vn.PK.USER)&&this.getEditableFlag(Vn.PK.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,i._)([(0,o.MZ)({constructOnly:!0})],En.prototype,"view",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],En.prototype,"active",null),(0,i._)([(0,o.MZ)({value:!0})],En.prototype,"visible",null),(0,i._)([(0,o.MZ)({value:!0})],En.prototype,"editable",null),(0,i._)([(0,o.MZ)({readOnly:!0})],En.prototype,"manipulators",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],En.prototype,"updating",null),(0,i._)([(0,o.MZ)()],En.prototype,"cursor",null),(0,i._)([(0,o.MZ)({readOnly:!0})],En.prototype,"automaticManipulatorSelection",void 0),(0,i._)([(0,o.MZ)()],En.prototype,"hasFocusedManipulators",null),(0,i._)([(0,o.MZ)()],En.prototype,"hasGrabbedManipulators",void 0),(0,i._)([(0,o.MZ)()],En.prototype,"hasHoveredManipulators",void 0),(0,i._)([(0,o.MZ)()],En.prototype,"firstGrabbedManipulator",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],En.prototype,"created",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],En.prototype,"removeIncompleteOnCancel",void 0),En=(0,i._)([(0,l.$)("geoscene.views.interactive.InteractiveToolBase")],En);let Zn=class extends((0,Et.$)(E.A.EventedMixin(En))){constructor(e){super(e),this.defaultZ=0,this.elevationInfo=null,this.hasZ=!0,this.mode=null,this.snapToScene=null,this.type="draw-3d"}initialize(){const e=this.view,t=(0,Zt.bK)(this.hasZ,this.elevationInfo);this.drawOperation=new bn({view:e,manipulators:this.manipulators,geometryType:this.geometryType,drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:"3d"===e.type?new Tn(e,t):null,elevationDrawSurface:"3d"===e.type?new Sn(t,this.defaultZ,e):null,hasM:!1,elevationInfo:t}),this.handles.add([this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))]),this.finishToolCreation()}destroy(){this.drawOperation=(0,b.pR)(this.drawOperation),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}get updating(){return this.drawOperation?.updating??!1}completeCreateOperation(){this.drawOperation.complete()}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.vertices}onInputEvent(e){this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}onComplete(e){this.emit("complete",e)}onCursorUpdate(e){this.emit("cursor-update",e)}onVertexAdd(e){this.emit("vertex-add",e)}onVertexRemove(e){this.emit("vertex-remove",e)}onVertexUpdate(e){this.emit("vertex-update",e)}};(0,i._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],Zn.prototype,"defaultZ",void 0),(0,i._)([(0,o.MZ)()],Zn.prototype,"drawOperation",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],Zn.prototype,"elevationInfo",void 0),(0,i._)([(0,o.MZ)({value:!0})],Zn.prototype,"enabled",null),(0,i._)([(0,o.MZ)({constructOnly:!0})],Zn.prototype,"geometryType",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],Zn.prototype,"hasZ",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],Zn.prototype,"mode",void 0),(0,i._)([(0,o.MZ)()],Zn.prototype,"snapToScene",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],Zn.prototype,"type",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],Zn.prototype,"updating",null),(0,i._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],Zn.prototype,"view",void 0),Zn=(0,i._)([(0,l.$)("geoscene.views.draw.DrawTool")],Zn);let Rn=class extends xt{constructor(e){super(e),this._addVertexOnPointerUp=!1}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool()}destroy(){"2d"===this.view.type?this._removeViewHandles():this._removeDrawTool(),this.emit("destroy")}complete(){"2d"===this.view.type?this._cursorScreenPoint&&this._completeDrawing():this._drawTool.completeCreateOperation()}_addViewHandles(){this._removeViewHandles(),this._handles.add([this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,Ct.ZV)(e),"touch"===e.pointerType&&this._updateCursor(e.native))}),Tt.o.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,Ct.ZV)(e),"touch"!==e.pointerType&&this._updateCursor(e.native)}),Tt.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._addVertexOnPointerUp=!1)}),Tt.o.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp)e.stopPropagation(),this._vertexAddHandler(e);else{const t="touch"===e.pointerType;this._updateCursor(e.native,t)}}),Tt.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),Tt.o.TOOL),this.view.on("key-down",(e=>{e.key===Pt.complete&&this._cursorScreenPoint&&(this._abortSnapping(),this._vertexAddHandler(e))}),Tt.o.TOOL)],this._viewHandlesKey)}_removeViewHandles(){this._handles.remove(this._viewHandlesKey)}_addDrawTool(){this._drawTool=new Zn({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point",mode:"click"}),this.view.addAndActivateTool(this._drawTool),this._handles.add([this._drawTool.on("cursor-update",(e=>{1===e.vertices.length&&this.emit("cursor-update",new Mt(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(e=>{this.emit("draw-complete",new St(null,this._drawTool.getVertexCoords())),this._removeDrawTool()}))],this._drawToolHandlesKey)}_removeDrawTool(){this._handles.remove(this._drawToolHandlesKey),this.view.tools.remove(this._drawTool),this._drawTool=(0,b.pR)(this._drawTool)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t),this.notifyChange("vertices"),this._completeDrawing())}_updateCursor(e,t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const n=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==n||t||this._pushCursorVertex(n.vertex,(()=>this.emit("cursor-update",new Mt(this.view,e,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new ue.A(this._stagedVertex):null))))}_completeDrawing(e){this._activePointerId=null,this._popCursorVertex(),this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const t=new St(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}};Rn=(0,i._)([(0,l.$)("geoscene.views.draw.PointDrawAction")],Rn);let Ln=class extends xt{constructor(e){super(e),this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this.mode=Dt}initialize(){"2d"===this.view.type?(this._addViewHandles(),this._addUndoRedoHandles()):this._addDrawTool()}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._removeUndoRedoHandles()):this._removeDrawTool(),this.emit("destroy")}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}_getGeometryZValue(){return this.hasZ&&this.vertices.length>0?this.vertices[0][2]:this.defaultZ}_addViewHandles(){this._removeViewHandles(),this._handles.add([this.view.on("click",(e=>{e.stopPropagation()}),Tt.o.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,Ct.ZV)(e),"touch"===e.pointerType&&this._updateCursor(e.native))}),Tt.o.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._cursorScreenPoint=(0,Ct.ZV)(e),"touch"!==e.pointerType&&this._updateCursor(e.native)}),Tt.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._cursorScreenPoint=(0,Ct.ZV)(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)}),Tt.o.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(e.native,t)}}),Tt.o.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&null!=this._activePointerId&&!this._panEnabled&&e.stopPropagation()}),Tt.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),Tt.o.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),Tt.o.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),Tt.o.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:n}=e;t===Pt.vertexAdd&&!n&&this._cursorScreenPoint?(e.stopPropagation(),this._abortSnapping(),this._vertexAddHandler(e)):t!==Pt.complete||n?t!==Pt.undo||this.interactiveUndoDisabled||n?t!==Pt.redo||this.interactiveUndoDisabled||n?t!==Pt.pan||n||(e.stopPropagation(),this._panEnabled=!0):(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e))}),Tt.o.TOOL),this.view.on("key-up",(e=>{e.key===Pt.pan&&(e.stopPropagation(),this._panEnabled=!1)}),Tt.o.TOOL)],this._viewHandlesKey)}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this._handles.add([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=this._nativeEventHistory.undoStack.pop();this._nativeEventHistory.redoStack.push(t);const n=[...this._committedVertices];null!=this._stagedVertex&&n.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new bt(this.view,t,e.vertices[0].index,n))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._nativeEventHistory.undoStack[this._nativeEventHistory.undoStack.length],t=this._committedVertices.length-1,n=new At(this.view,e,t,this.vertices);this.emit("vertex-add",n),n.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=this._nativeEventHistory.redoStack.pop();this._nativeEventHistory.undoStack.push(t);const n=[...this._committedVertices];null!=this._stagedVertex&&n.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new At(this.view,t,e.vertices[0].index,n))}}))],this._undoRedoHandlesKey)}_removeViewHandles(){this._handles.remove(this._viewHandlesKey)}_removeUndoRedoHandles(){this._handles.remove(this._undoRedoHandlesKey)}_addDrawTool(){this._drawTool=new Zn({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polygon",mode:this.mode}),this.view.addAndActivateTool(this._drawTool),this._drawTool.on("vertex-add",(e=>{1===e.vertices.length&&this.emit("vertex-add",new At(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(e=>{1===e.vertices.length&&this.emit("cursor-update",new Mt(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(e=>{this.emit("draw-complete",new St(null,this._drawTool.getVertexCoords())),this._removeDrawTool()}))}_removeDrawTool(){this._handles.remove(this._drawToolHandlesKey),this.view.tools.remove(this._drawTool),this._drawTool=(0,b.pR)(this._drawTool)}_addVertex(e,t){const n=this._coordinateHelper.arrayToVector(e);if(this._isDuplicateOfLastVertex(n))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(n);const i=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(i)}_updateCursor(e,t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const n=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==n||t||this._pushCursorVertex(n.vertex,(()=>this.emit("cursor-update",new Mt(this.view,e,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new ue.A(this._stagedVertex):null))))}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this._committedVertices.length<3)return;this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const t=new St(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}};(0,i._)([(0,o.MZ)()],Ln.prototype,"_dragEnabled",null),(0,i._)([(0,o.MZ)()],Ln.prototype,"_clickEnabled",null),(0,i._)([(0,o.MZ)({type:Ht})],Ln.prototype,"mode",void 0),Ln=(0,i._)([(0,l.$)("geoscene.views.draw.PolygonDrawAction")],Ln);let Hn=class extends xt{constructor(e){super(e),this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this.mode=Dt}initialize(){"2d"===this.view.type?(this._addViewHandles(),this._addUndoRedoHandles()):this._addDrawTool()}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._removeUndoRedoHandles()):this._removeDrawTool(),this.emit("destroy")}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}_addViewHandles(){this._removeViewHandles(),this._handles.add([this.view.on("click",(e=>{e.stopPropagation()}),Tt.o.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&!this._panEnabled&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,Ct.ZV)(e),"touch"===e.pointerType&&this._updateCursor(e.native))}),Tt.o.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._abortSnapping(),this._cursorScreenPoint=(0,Ct.ZV)(e),"touch"!==e.pointerType&&this._updateCursor(e.native)}),Tt.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._cursorScreenPoint=(0,Ct.ZV)(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)}),Tt.o.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(e.native,t)}}),Tt.o.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&null!=this._activePointerId&&!this._panEnabled&&e.stopPropagation()}),Tt.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),Tt.o.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),Tt.o.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),Tt.o.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:n}=e;t===Pt.vertexAdd&&!n&&this._cursorScreenPoint?(e.stopPropagation(),this._abortSnapping(),this._vertexAddHandler(e)):t!==Pt.complete||n?t!==Pt.undo||this.interactiveUndoDisabled||n?t!==Pt.redo||this.interactiveUndoDisabled||n?t!==Pt.pan||n||(e.stopPropagation(),this._panEnabled=!0):(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e))}),Tt.o.TOOL),this.view.on("key-up",(e=>{e.key===Pt.pan&&(e.stopPropagation(),this._panEnabled=!1)}),Tt.o.TOOL)],this._viewHandlesKey)}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this._handles.add([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=this._nativeEventHistory.undoStack.pop();this._nativeEventHistory.redoStack.push(t);const n=[...this._committedVertices];null!=this._stagedVertex&&n.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new bt(this.view,t,e.vertices[0].index,n))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._nativeEventHistory.undoStack[this._nativeEventHistory.undoStack.length],t=this._committedVertices.length-1,n=new At(this.view,e,t,this.vertices);this.emit("vertex-add",n),n.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=this._nativeEventHistory.redoStack.pop();this._nativeEventHistory.undoStack.push(t);const n=[...this._committedVertices];null!=this._stagedVertex&&n.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new At(this.view,t,e.vertices[0].index,n))}}))],this._undoRedoHandlesKey)}_removeViewHandles(){this._handles.remove(this._viewHandlesKey)}_removeUndoRedoHandles(){this._handles.remove(this._undoRedoHandlesKey)}_addDrawTool(){this._drawTool=new Zn({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polyline",mode:this.mode}),this.view.addAndActivateTool(this._drawTool),this._handles.add([this._drawTool.on("vertex-add",(e=>{1===e.vertices.length&&this.emit("vertex-add",new At(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(e=>{1===e.vertices.length&&this.emit("cursor-update",new Mt(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(e=>{this.emit("draw-complete",new St(null,this._drawTool.getVertexCoords())),this._removeDrawTool()}))],this._drawToolHandlesKey)}_removeDrawTool(){this._handles.remove(this._drawToolHandlesKey),this.view.tools.remove(this._drawTool),this._drawTool=(0,b.pR)(this._drawTool)}_addVertex(e,t){const n=this._coordinateHelper.arrayToVector(e);if(this._isDuplicateOfLastVertex(n))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(n);const i=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(i)}_updateCursor(e,t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const n=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==n||t||this._pushCursorVertex(n.vertex,(()=>this.emit("cursor-update",new Mt(this.view,e,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new ue.A(this._stagedVertex):null))))}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this._committedVertices.length<2)return;this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const t=new St(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}};(0,i._)([(0,o.MZ)()],Hn.prototype,"_clickEnabled",null),(0,i._)([(0,o.MZ)()],Hn.prototype,"_dragEnabled",null),(0,i._)([(0,o.MZ)({type:Ht})],Hn.prototype,"mode",void 0),Hn=(0,i._)([(0,l.$)("geoscene.views.draw.PolylineDrawAction")],Hn);var Dn=n(21749),In=n(27929),kn=n(34350),zn=n(71784),Gn=n(22426);function Un(e,t,n=null){return null!=n?[e,t,n]:[e,t]}function Bn(e,t,n=null){return null!=n?{x:e,y:t,z:n}:{x:e,y:t}}class Nn{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map((e=>this.mapToLocal(e))).filter(a.Ru)}get doUnnormalization(){return!1}}class Fn extends Nn{constructor(e,t,n=null){super(t),this._defaultZ=n,this.transform=(0,In.c)(),this.transformInv=(0,In.c)(),this.transform=(0,In.a)(e),(0,Dn.i)(this.transformInv,this.transform)}makeMapPoint(e,t){return Un(e,t,this._defaultZ)}mapToLocal(e){return Bn(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return Un(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}}class qn extends Nn{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=(0,z.c)(),this.tangentFrameUpWS=(0,z.c)(),this.tangentFrameRightWS=(0,z.c)(),this.tangentFrameForwardWS=(0,z.c)(),this.localFrameRightWS=(0,z.c)(),this.localFrameUpWS=(0,z.c)(),this.worldToLocalTransform=(0,zn.a)(),this.localToWorldTransform=(0,zn.a)(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const n=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Gn._.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Gn._.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Gn._.Z,this.tangentFrameForwardWS);const i=(0,z.c)();(0,ee.g)(i,this.tangentFrameForwardWS,(0,ee.e)(n,this.tangentFrameForwardWS)),(0,ee.b)(this.localFrameRightWS,n,i),(0,ee.n)(this.localFrameRightWS,this.localFrameRightWS),(0,ee.f)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),(0,kn.r)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),(0,kn.i)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return Un(e,t,this.defaultZ)}mapToLocal(e){const t=(0,z.c)();this.view.renderCoordsHelper.toRenderCoords(new ue.A({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),(0,ee.q)(t,t,this.worldToLocalTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return null!=n?Bn(n.x/this.scale,n.y/this.scale):null}localToMap(e){const t=(0,z.c)();this.view.renderCoordsHelper.toRenderCoords(new ue.A({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),(0,ee.q)(t,t,this.localToWorldTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return null!=n?Un(n.x,n.y,this.defaultZ):null}}function Wn(e,t){if("2d"===e.type)return new Fn(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const n=t.length>2?new ue.A({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new ue.A({x:t[0],y:t[1],spatialReference:e.spatialReference});return new qn(e,n)}return null}const Kn=["freehand","click"];let Yn=class extends xt{constructor(e){super(e),this._isDragging=!1,this._panEnabled=!1,this._addVertexOnPointerUp=!1,this.viewAlignedCoordinateSystem=null,this.mode="freehand"}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool()}destroy(){"2d"===this.view.type?this._removeViewHandles():this._removeDrawTool(),this.emit("destroy")}complete(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}_getGeometryZValue(){return this.hasZ&&this.vertices.length>0?this.vertices[0][2]:this.defaultZ}_addViewHandles(){this._removeViewHandles(),"click"===this.mode?this._handles.add(this._getClickModeViewHandles(),this._viewHandlesKey):this._handles.add(this._getDragModeViewHandles(),this._viewHandlesKey)}_getDragModeViewHandles(){return[this.view.on("immediate-click",(e=>{e.stopPropagation(),e.mapPoint&&!this._panEnabled&&null!=this.getCoordsFromScreenPoint((0,Ct.ZV)(e))&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}),Tt.o.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._panEnabled||(this._resetGeometry(),this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,Ct.ZV)(e),this._activePointerId=e.pointerId,this._vertexAddHandler(e),this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor(e.native)))}),Tt.o.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),null==this._activePointerId&&"touch"!==e.pointerType&&(this._cursorScreenPoint=(0,Ct.ZV)(e),this._updateCursor(e.native))}),Tt.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._isDragging=!0,this._cursorScreenPoint=(0,Ct.ZV)(e),this._updateCursor(e.native))}),Tt.o.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&this._addVertexOnPointerUp&&(this._abortSnapping(),this._activePointerId=null,this._isDragging&&this._vertexAddHandler(e),2===this._committedVertices.length&&this._drawCompleteHandler(e),this._isDragging=!1)}),Tt.o.TOOL),this.view.on("key-down",(e=>{e.key===Pt.complete&&this._cursorScreenPoint?(this._abortSnapping(),this._vertexAddHandler(e),this._drawCompleteHandler(e)):e.key===Pt.pan&&(this._panEnabled=!0)}),Tt.o.TOOL),this.view.on("key-up",(e=>{e.key===Pt.pan&&(this._panEnabled=!1)}),Tt.o.TOOL),this.view.on("drag",(e=>{null!=this._activePointerId&&e.stopPropagation()}),Tt.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),Tt.o.TOOL)]}_getClickModeViewHandles(){return[this.view.on("pointer-down",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,Ct.ZV)(e),this._activePointerId=e.pointerId,this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor(e.native)}),Tt.o.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,Ct.ZV)(e),null==this._activePointerId&&"touch"!==e.pointerType&&this._updateCursor(e.native)}),Tt.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._isDragging=!0)}),Tt.o.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=null,e.stopPropagation(),this._isDragging||this._vertexAddHandler(e),2!==this.vertices.length||this._isDragging||this._drawCompleteHandler(e),this._isDragging=!1)}),Tt.o.TOOL),this.view.on("key-down",(e=>{e.key===Pt.vertexAdd&&this._cursorScreenPoint&&(this._vertexAddHandler(e),2===this.vertices.length&&this._drawCompleteHandler(e)),e.key===Pt.complete&&this._cursorScreenPoint&&2===this.vertices.length&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}),Tt.o.TOOL)]}_removeViewHandles(){this._handles.remove(this._viewHandlesKey)}_addDrawTool(){this._drawTool=new Zn({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"segment",mode:this.mode}),this.view.addAndActivateTool(this._drawTool),this._handles.add([this._drawTool.on("vertex-add",(e=>{1===e.vertices.length&&this.emit("vertex-add",new At(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(e=>{1===e.vertices.length&&this.emit("cursor-update",new Mt(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(e=>{this.emit("draw-complete",new St(null,this._drawTool.getVertexCoords())),this._removeDrawTool()}))],this._drawToolHandlesKey)}_removeDrawTool(){this._handles.remove(this._drawToolHandlesKey),this.view.tools.remove(this._drawTool),this._drawTool=(0,b.pR)(this._drawTool)}_addVertex(e,t){const n=this._coordinateHelper.arrayToVector(e);if(this._isDuplicateOfLastVertex(n))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(n),1===this._committedVertices.length&&(this.viewAlignedCoordinateSystem=Wn(this.view,this._committedVertices[0]));const i=this._committedVertices.length-1,r=new At(this.view,t,i,this.vertices);this.emit("vertex-add",r)}_updateCursor(e){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null!=t&&this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new Mt(this.view,e,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new ue.A(this._stagedVertex):null))))}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this._cursorScreenPoint=null,this._isDragging=!1,this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const t=new St(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_resetGeometry(){this._editGeometryOperations.destroy(),this._editGeometryOperations=new pt(new Ge("polygon",this._coordinateHelper)),this._activeComponent=new ze(this._coordinateHelper.spatialReference,V.RT.Local),this._editGeometryOperations.data.components.push(this._activeComponent)}};(0,i._)([(0,o.MZ)({type:Kn})],Yn.prototype,"mode",void 0),Yn=(0,i._)([(0,l.$)("geoscene/views/2d/engine/markup/SegmentDrawAction")],Yn);let Xn=class extends C.A{constructor(){super(...arguments),this.activeAction=null,this.type="draw",this.view=null}destroy(){this.activeAction&&(this.activeAction.destroy(),this.activeAction=null)}create(e,t){this.reset();const n={view:this.view,...t};switch(e){case"point":n.editGeometryType="point",this.activeAction=new Rn(n);break;case"polyline":n.editGeometryType="polyline",this.activeAction=new Hn(n);break;case"multipoint":n.editGeometryType="polygon",this.activeAction=new Ot(n);break;case"polygon":n.editGeometryType="polygon",this.activeAction=new Ln(n);break;case"rectangle":case"circle":case"ellipse":case"triangle":n.editGeometryType="polygon",this.activeAction=new Yn(n)}return this.activeAction}complete(){this.activeAction&&this.activeAction.complete(),this.activeAction=null}reset(){this.activeAction&&this.activeAction.destroy(),this.activeAction=null}};(0,i._)([(0,o.MZ)()],Xn.prototype,"activeAction",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],Xn.prototype,"type",void 0),(0,i._)([(0,o.MZ)()],Xn.prototype,"view",void 0),Xn=(0,i._)([(0,l.$)("geoscene.views.draw.Draw")],Xn);const Qn=Xn;var jn=n(71008),Jn=n(9693);function $n(e){let t=0,n=0,i=0;return e?("cim"===e.type&&e.data.symbol&&"symbolLayers"in e.data.symbol&&e.data.symbol.symbolLayers&&e.data.symbol.symbolLayers.map((e=>{"CIMVectorMarker"===e.type&&e.anchorPoint&&(Math.abs(e.anchorPoint.x)>t&&(t=e.anchorPoint.x),Math.abs(e.anchorPoint.y)>n&&(n=e.anchorPoint.y),null!=e.size&&e.size>i&&(i=e.size))})),t=(0,L.Lz)(t),n=(0,L.Lz)(n),i=(0,L.Lz)(i),{offsetX:t,offsetY:n,size:i}):{offsetX:t,offsetY:n,size:i}}var ei=n(70568);let ti=class extends C.A{set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const{layer:e}=this.graphic,t=e&&"elevationInfo"in e?e.elevationInfo:null,n=(0,Zt.ky)(this.graphic),i=t?t.offset:0;return new Jn.A({mode:n,offset:i})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new E.A.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const n=t.geometry;if(null==n)return null;const i=this._get("focusedSymbol"),r=null!=i?i:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,n,r):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),null!=this.layer&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),null!=this.layer&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=(0,c.wB)((()=>this.graphic?.symbol),(e=>{null!=e&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&null!=this.focusedSymbol&&(this.graphic.symbol=this.focusedSymbol))}),c.OH)}detachSymbolChanged(){null!=this._graphicSymbolChangedHandle&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&null!=this.focusedSymbol?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,n,i){if(null==(i=i||(0,jn.SF)(n)))return null;const r=1;let s=this._circleCollisionCache;if("point"===n.type&&"cim"===i.type&&"CIMPointSymbol"===i.data.symbol?.type&&i.data.symbol.symbolLayers){const{offsetX:s,offsetY:o,size:a}=$n(i),l=(0,L.WA)(t,ii),h=a/2,c=e.toScreen(n),u=c.x+s,d=c.y+o;return(0,I.k)(l,[u,d])<h*h?r:null}if("point"!==n.type||"simple-marker"!==i.type)return(0,ei.t)(t,n,e)?r:null;if(null==s||!s.originalPoint.equals(n)){const t=n,r=e.spatialReference;if((0,u._q)(t.spatialReference,r)){const e=(0,u.Cv)(t,r);s={originalPoint:t.clone(),mapPoint:e,radiusPx:(0,L.Lz)(i.size)},this._circleCollisionCache=s}}if(null!=s){const n=(0,L.WA)(t,ii),o=e.toScreen?.(s.mapPoint);if(!o)return null;const a=s.radiusPx,l=o.x+(0,L.Lz)(i.xoffset),h=o.y-(0,L.Lz)(i.yoffset);return(0,I.k)(n,[l,h])<a*a?r:null}return null}_intersectDistance3D(e,t,n){const i=e.toMap(t,{include:[n]});return i&&(0,u.gk)(i,ni,e.renderSpatialReference)?(0,ee.i)(ni,e.state.camera.eye):null}};(0,i._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],ti.prototype,"graphic",null),(0,i._)([(0,o.MZ)()],ti.prototype,"elevationInfo",null),(0,i._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],ti.prototype,"view",void 0),(0,i._)([(0,o.MZ)({value:null})],ti.prototype,"focusedSymbol",null),(0,i._)([(0,o.MZ)({constructOnly:!0})],ti.prototype,"layer",void 0),(0,i._)([(0,o.MZ)()],ti.prototype,"interactive",void 0),(0,i._)([(0,o.MZ)()],ti.prototype,"selectable",void 0),(0,i._)([(0,o.MZ)()],ti.prototype,"grabbable",void 0),(0,i._)([(0,o.MZ)({value:!1})],ti.prototype,"grabbing",null),(0,i._)([(0,o.MZ)()],ti.prototype,"dragging",void 0),(0,i._)([(0,o.MZ)()],ti.prototype,"hovering",null),(0,i._)([(0,o.MZ)({value:!1})],ti.prototype,"selected",null),(0,i._)([(0,o.MZ)()],ti.prototype,"cursor",void 0),ti=(0,i._)([(0,l.$)("geoscene.views.interactive.GraphicManipulator")],ti);const ni=(0,z.c)(),ii=(0,L.gs)();var ri=n(51490),si=n(77728),oi=n(73773),ai=n(35371);const li=1e5;let hi=class extends En{constructor(e){super(e),this._drawActive=!1,this._measurementLayer=new P.A({internal:!0,listMode:"hide",visible:!1}),this._manipulatorLayer=new P.A({internal:!0,listMode:"hide",visible:!1}),this._vertices=[],this.geodesicDistanceThreshold=1e5,this.measurement=null,this.measurementLabel=null}initialize(){(0,ri.ud)("geoscene/core/t9n/Units").then((e=>{this.messages=e})),this.addHandles((0,si.oQ)((async()=>{this.messages=await(0,ri.ud)("geoscene/core/t9n/Units")})));const e=this.view;this._draw=new Qn({view:e}),e.map.addMany([this._measurementLayer,this._manipulatorLayer]),e.focus(),this.addHandles((0,c.wB)((()=>[this.unit,this.geodesicDistanceThreshold,this.messages]),(()=>{this._updatePolylines()}),c.Vh))}destroy(){const{map:e}=this.view;this._draw.view=null,this._draw=(0,b.pR)(this._draw),e.removeMany([this._measurementLayer,this._manipulatorLayer]),this._measurementLayer.removeAll(),this._manipulatorLayer.removeAll(),this._set("measurement",null),this._set("measurementLabel",null),this._measurementLayer=(0,b.pR)(this._measurementLayer),this._manipulatorLayer=(0,b.pR)(this._manipulatorLayer),this._resetVertices()}get cursor(){return this._drawActive?"crosshair":null}set editable(e){this._set("editable",e),e||this._draw.reset()}onActivate(){this._drawActive||0!==this._vertices.length||this._startSketch()}onShow(){this._measurementLayer.visible=!0,this._manipulatorLayer.visible=!0}onHide(){this._measurementLayer.visible=!1,this._manipulatorLayer.visible=!1}reset(){this._resetVertices(),this._measurementLayer.removeAll(),this._set("measurement",null),this._set("measurementLabel",null),this._draw.reset(),this._drawActive=!1,this._updateSketch([])}_resetVertices(){for(const{handle:e}of this._vertices)e.remove();this._vertices=[]}_startSketch(){this._drawActive=!0;const e=this._draw.create("polyline",{mode:"click"});e.on(["vertex-add","vertex-update","vertex-remove","cursor-update","undo","redo"],(e=>this._updateSketch(e.vertices))),e.on("draw-complete",(()=>{this._stopSketch()}))}_stopSketch(){this.manipulators.forEach((({manipulator:e})=>{e.interactive=!0})),this._drawActive=!1,this.finishToolCreation()}_updateSketch(e){const{spatialReference:t}=this.view;for(;this._vertices.length>e.length;){const{handle:e,manipulator:t}=this._vertices.pop();e.remove(),this.manipulators.remove(t)}for(let a=this._vertices.length;a<e.length;a++){const[n,i]=e[a],r=ci(new ue.A({x:n,y:i,spatialReference:t}),this.view,this._manipulatorLayer);this.manipulators.add(r);const s=Yt(r,((e,t)=>{t.next(en(this.view)).next(Xt(e.graphic,V.RT.Local)).next((()=>{const t=e.graphic.geometry;this._vertices[a].coord=[t.x,t.y],this._updatePolylines()}))}));this._vertices.push({manipulator:r,coord:[n,i],handle:s})}const n=this._vertices.length-1,i=this._vertices[n],[r,s]=e[n];i.coord[0]===r&&i.coord[1]===s||(i.coord=[r,s],i.manipulator.graphic.geometry=new ue.A({x:r,y:s,spatialReference:t}));const o=this._drawActive?this._vertices[n].manipulator:null;this.manipulators.forEach((({manipulator:e})=>{e.interactive=null==o||e!==o})),this._updatePolylines()}_updatePolylines(){if(this._vertices.length<2)return void this._measurementLayer.removeAll();const e=this._vertices.map((({coord:e})=>e)),{measurement:t,drawing:n,original:i}=ui(e,this.view.spatialReference,this.geodesicDistanceThreshold);this._set("measurement",t);const r=gi(this.messages,t,this.unit);let s,o;this._set("measurementLabel",r);const{graphics:a}=this._measurementLayer;2===a.length?(s=a.at(0),o=a.at(1)):(s=new p.A({symbol:new ce.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[14,12],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:3.5,color:w().toArray()},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:5,color:y().toArray()}]}}})}),o=new p.A({symbol:new oi.A({color:x(),haloColor:A(.5),haloSize:2,font:new ai.A({size:14,family:"sans-serif"})})}),a.removeAll(),a.addMany([s,o])),s.geometry=n,o.geometry=i.extent?.center,o.symbol.text=r}};function ci(e,t,n){const i=y(.5),r={type:"simple-line",width:0},s=8,o=new le.A({style:"circle",color:i,size:s,outline:r}),a=new le.A({style:"circle",color:i,size:1.5*s,outline:r}),l=new p.A({geometry:e,symbol:o});return new ti({view:t,layer:n,graphic:l,focusedSymbol:a})}function ui(e,t,n){const i=new de.A({paths:[e],spatialReference:t});let r,s;if(t.isGeographic)if((0,T.TT)(t))r=(0,T.l1)([i],"meters")[0],s=(0,T.Ow)(i,li);else{const e=(0,u.Cv)(i,zt.A.WGS84),n=(0,T.Ow)(e,li);r=(0,T.l1)([e],"meters")[0],s=(0,u.Cv)(n,t)}else if(t.isWebMercator)r=(0,S.geodesicLength)(i,"meters"),s=(0,S.geodesicDensify)(i,li,"meters");else{const e=(0,S.planarLength)(i,"meters");if(e>=n){const e=(0,u.Cv)(i,zt.A.WGS84),n=(0,T.Ow)(e,li);r=(0,T.l1)([e],"meters")[0],s=(0,u.Cv)(n,t)}else r=e,s=i}return{measurement:{geometry:s,length:r},original:i,drawing:s}}function di(e){return null!=e}function pi(e){if(!e)return!1;const{isGeographic:t,isWebMercator:n,isWGS84:i}=e;return t&&!i&&!(0,T.TT)(e)||!t&&!n}function gi(e,t,n){if(!t||!e)return"";switch(n){case"metric":return(0,M.Ee)(e,t.length,"meters");case"imperial":return(0,M.tr)(e,t.length,"meters");default:return(0,M.zJ)(e,(0,s.oU)(t.length,"meters",n),n)}}(0,i._)([(0,o.MZ)()],hi.prototype,"_drawActive",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],hi.prototype,"cursor",null),(0,i._)([(0,o.MZ)({value:!0})],hi.prototype,"editable",null),(0,i._)([(0,o.MZ)({type:Number})],hi.prototype,"geodesicDistanceThreshold",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],hi.prototype,"measurement",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],hi.prototype,"measurementLabel",void 0),(0,i._)([(0,o.MZ)()],hi.prototype,"messages",void 0),(0,i._)([(0,o.MZ)()],hi.prototype,"unit",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],hi.prototype,"view",void 0),hi=(0,i._)([(0,l.$)("geoscene.widgets.DistanceMeasurement2D.DistanceMeasurement2DTool")],hi);let mi=class extends C.A{constructor(e){super(e),this.tool=null,this._baseHandles=new Z.A,this._loggedUnsupportedErrorOnce=!1,this.logger=O.A.getLogger(this),e&&null!=e.visible&&(this.visible=e.visible)}initialize(){this._baseHandles.add((0,c.wB)((()=>({ready:null!=this.view&&this.view.ready,supported:this.supported})),(({ready:e,supported:t})=>{!e||t||this._loggedUnsupportedErrorOnce||(this.logError(this.unsupportedErrorMessage),this._loggedUnsupportedErrorOnce=!0)}),c.pc))}destroy(){this.removeTool(),this.view=null,this._baseHandles=(0,b.pR)(this._baseHandles)}get active(){return null!=this.tool&&this.tool.active}get disabled(){return null==this.view||!this.view.ready||!this.supported}get supported(){return null==this.view||this.view.type===this.supportedViewType}get view(){return this._get("view")}set view(e){if(e===this.view)return;this.removeTool(),this._set("view",e);const t="tools";this._baseHandles.remove(t),null!=e&&this._baseHandles.add(e.tools.on("after-remove",(e=>{e.item===this.tool&&this._set("tool",null)})),t)}set visible(e){this._set("visible",e),null!=this.tool&&(this.tool.visible=e)}createTool(e={interactive:!1}){if(this.removeTool(),null==this.view||!this.view.ready||!this.supported)return;const t=this.constructTool();t.created?(this._set("tool",t),this.view.tools.add(t)):e.interactive?(this._set("tool",t),this.view.addAndActivateTool(t),(0,c.z7)((()=>t.created),(()=>{t.active&&null!=this.view&&(this.view.activeTool=null)}),{initial:!0,once:!0})):t.destroy()}removeTool(){const e=this.tool;if(null==e)return;const t=(0,b.Rh)(this.view,(e=>e.tools));null!=t?t.remove(e):e.destroy(),this._set("tool",null)}logError(...e){this.logger.error(...e)}};(0,i._)([(0,o.MZ)({constructOnly:!0})],mi.prototype,"tool",void 0),(0,i._)([(0,o.MZ)()],mi.prototype,"active",null),(0,i._)([(0,o.MZ)()],mi.prototype,"disabled",null),(0,i._)([(0,o.MZ)()],mi.prototype,"supported",null),(0,i._)([(0,o.MZ)({value:null})],mi.prototype,"view",null),(0,i._)([(0,o.MZ)({type:Boolean,value:!0})],mi.prototype,"visible",null),mi=(0,i._)([(0,l.$)("geoscene.widgets.support.InteractiveToolViewModel")],mi);let _i=class extends mi{constructor(e){super(e),this.supportedViewType="2d",this.unsupportedErrorMessage="DistanceMeasurement2DViewModel is only supported in 2D views.",this.geodesicDistanceThreshold=1e5}initialize(){this.addHandles([(0,c.wB)((()=>this.view?.spatialReference),(()=>this.clear())),(0,c.wB)((()=>this.unit),(e=>{null!=this.tool&&(this.tool.unit=e)}),c.Vh),(0,c.wB)((()=>this.geodesicDistanceThreshold),(e=>{null!=this.tool&&(this.tool.geodesicDistanceThreshold=e)}),c.Vh)])}get measurement(){return null!=this.tool?this.tool.measurement:null}get measurementLabel(){return null!=this.tool?this.tool.measurementLabel:null}get state(){return this.disabled||null==this.view||!di(this.view?.spatialReference)?"disabled":null!=this.tool&&this.measurement?this.tool.active?"measuring":"measured":"ready"}get unit(){return this._validateUnit(this.defaultUnit)}set unit(e){this._overrideIfSome("unit",this._validateUnit(e))}get unitOptions(){return s.GB}set unitOptions(e){this._overrideIfSome("unitOptions",this._validateUnits(e))}async start(){const e=this.view;null!=e&&(await(0,c.C_)((()=>e.ready)),pi(e.spatialReference)&&await(0,u.Hh)()),this.createTool({interactive:!0})}clear(){this.removeTool()}constructTool(){return new hi({view:this.view,visible:this.visible,geodesicDistanceThreshold:this.geodesicDistanceThreshold,unit:this.unit})}_validateUnit(e){const{unitOptions:t,defaultUnit:n}=this;return null!=e&&t.includes(e)?e:t.includes(n)?n:t.length>0?t[0]:n}_validateUnits(e){if(null==e)return[];const t=e.filter((e=>s.GB.includes(e)));return 0===t.length?s.GB.slice():t}};(0,i._)([(0,o.MZ)(d.q)],_i.prototype,"defaultUnit",void 0),(0,i._)([(0,o.MZ)({type:Number})],_i.prototype,"geodesicDistanceThreshold",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],_i.prototype,"measurement",null),(0,i._)([(0,o.MZ)({readOnly:!0})],_i.prototype,"measurementLabel",null),(0,i._)([(0,o.MZ)({readOnly:!0})],_i.prototype,"state",null),(0,i._)([(0,o.MZ)({type:String})],_i.prototype,"unit",null),(0,i._)([(0,o.MZ)({type:[String]})],_i.prototype,"unitOptions",null),_i=(0,i._)([(0,l.$)("geoscene.widgets.DistanceMeasurement2D.DistanceMeasurement2DViewModel")],_i);const fi=_i;var vi=n(39757),yi=n(688),wi=n(45283);n(80568);const xi="geoscene-distance-measurement-2d",Ai=`${xi}__measurement`,bi=`${xi}__units`,Mi={buttonDisabled:"geoscene-button--disabled",widgetIcon:"geoscene-icon-measure-line",base:`${xi} geoscene-widget geoscene-widget--panel`,container:`${xi}__container`,hint:`${xi}__hint`,hintText:`${xi}__hint-text`,panelError:`${xi}__panel--error`,measurement:Ai,measurementItem:`${Ai}-item`,measurementItemDisabled:`${Ai}-item--disabled`,measurementItemTitle:`${Ai}-item-title`,measurementItemValue:`${Ai}-item-value`,settings:`${xi}__settings`,units:bi,unitsLabel:`${bi}-label`,unitsSelect:`${bi}-select geoscene-select`,unitsSelectWrapper:`${bi}-select-wrapper`,actionSection:`${xi}__actions`,newMeasurementButton:`${xi}__clear-button geoscene-button geoscene-button--primary`};let Si=class extends h.A{constructor(e,t){super(e,t),this.iconClass=Mi.widgetIcon,this.icon=null,this.messages=null,this.messagesUnits=null,this.viewModel=new fi}get active(){return this.viewModel.active}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get unit(){return this.viewModel.unit}set unit(e){this.viewModel.unit=e}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(e){this.viewModel.unitOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}render(){const{id:e,messages:t,messagesUnits:n,viewModel:i,visible:r}=this,{active:o,supported:a,measurementLabel:l,state:h,unit:c,unitOptions:u}=i,d="disabled"===h,p="measuring"===h||"measured"===h,g=o&&"ready"===h?(0,wi.K)("section",{key:"hint",class:Mi.hint},(0,wi.K)("p",{class:Mi.hintText},t.hint)):null,m=a?null:(0,wi.K)("section",{key:"unsupported",class:Mi.panelError},(0,wi.K)("p",null,t.unsupported)),_=(e,t,n)=>null!=t?(0,wi.K)("div",{key:`${n}-enabled`,class:Mi.measurementItem},(0,wi.K)("span",{class:Mi.measurementItemTitle},e),(0,wi.K)("span",{"aria-live":"polite",class:Mi.measurementItemValue},t)):(0,wi.K)("div",{key:`${n}-disabled`,class:this.classes(Mi.measurementItem,Mi.measurementItemDisabled),"aria-disabled":"true"},(0,wi.K)("span",{class:Mi.measurementItemTitle},e)),f=p?(0,wi.K)("section",{key:"measurement",class:Mi.measurement},_(t.distance,l,"distance")):null,v=`${e}-units`,y=p?(0,wi.K)("section",{key:"units",class:Mi.units},(0,wi.K)("label",{class:Mi.unitsLabel,for:v},t.unit),(0,wi.K)("div",{class:Mi.unitsSelectWrapper},(0,wi.K)("select",{class:Mi.unitsSelect,id:v,onchange:this._changeUnit,bind:this,value:c},u.map((e=>(0,wi.K)("option",{key:e,value:e},(0,s.GT)(e)?n.systems[e]:n.units[e]?.pluralCapitalized)))))):null,w=p?(0,wi.K)("div",{key:"settings",class:Mi.settings},y):null,x=!a||o&&!p?null:(0,wi.K)("div",{class:Mi.actionSection},(0,wi.K)("button",{"aria-label":t.newMeasurement,bind:this,class:this.classes(Mi.newMeasurementButton,d&&Mi.buttonDisabled),disabled:d,onclick:this._newMeasurement,title:t.newMeasurement,type:"button"},t.newMeasurement)),A=r?(0,wi.K)("div",{class:Mi.container},m,g,w,f,x):null;return(0,wi.K)("div",{"aria-label":t.widgetLabel,class:Mi.base,role:"region"},A)}_newMeasurement(){(0,r.QZ)(this.viewModel.start())}_changeUnit(e){const t=e.target,n=t.options[t.selectedIndex];n&&(this.viewModel.unit=n.value)}};(0,i._)([(0,o.MZ)({readOnly:!0})],Si.prototype,"active",null),(0,i._)([(0,o.MZ)()],Si.prototype,"iconClass",void 0),(0,i._)([(0,o.MZ)()],Si.prototype,"icon",void 0),(0,i._)([(0,o.MZ)()],Si.prototype,"label",null),(0,i._)([(0,o.MZ)()],Si.prototype,"uiStrings",void 0),(0,i._)([(0,o.MZ)(),(0,yi.G)("geoscene/widgets/DistanceMeasurement2D/t9n/DistanceMeasurement2D")],Si.prototype,"messages",void 0),(0,i._)([(0,o.MZ)(),(0,yi.G)("geoscene/core/t9n/Units")],Si.prototype,"messagesUnits",void 0),(0,i._)([(0,o.MZ)()],Si.prototype,"unit",null),(0,i._)([(0,o.MZ)()],Si.prototype,"unitOptions",null),(0,i._)([(0,o.MZ)()],Si.prototype,"view",null),(0,i._)([(0,o.MZ)({type:fi})],Si.prototype,"viewModel",void 0),(0,i._)([(0,o.MZ)({type:Boolean})],Si.prototype,"visible",null),(0,i._)([(0,vi.$)()],Si.prototype,"_newMeasurement",null),(0,i._)([(0,vi.$)()],Si.prototype,"_changeUnit",null),Si=(0,i._)([(0,l.$)("geoscene.widgets.DistanceMeasurement2D")],Si);const Ti=Si},87923:function(e,t,n){n.d(t,{A:function(){return z}});var i=n(71457),r=n(76379),s=n(15114),o=n(87400),a=n(18513),l=n(76543),h=(n(37679),n(69292),n(51020),n(29916)),c=n(14811),u=n(70343),d=n(43895);const p="geoscene-scale-bar",g={base:`${p} geoscene-widget`,labelContainer:`${p}__label-container`,rulerLabelContainer:`${p}__label-container--ruler`,lineLabelContainer:`${p}__label-container--line`,topLabelContainer:`${p}__label-container--top`,bottomLabelContainer:`${p}__label-container--bottom`,label:`${p}__label`,line:`${p}__line`,topLine:`${p}__line--top`,bottomLine:`${p}__line--bottom`,ruler:`${p}__ruler`,rulerBlock:`${p}__ruler-block`,barContainer:`${p}__bar-container`,rulerBarContainer:`${p}__bar-container--ruler`,lineBarContainer:`${p}__bar-container--line`,disabled:"geoscene-disabled"};n(2516);var m=n(3734),_=n(79075),f=n(44655),v=n(42638),y=n(72465),w=n(30075),x=n(29726),A=n(12790),b=n(68491),M=n(74036);function S(e){return e>.5?{min:.5,max:1}:e>.2?{min:.2,max:.5}:{min:.1,max:.2}}function T(e,t){switch(t){case"metric":return e>1e3?{distance:(0,_.oU)(e,"meters","kilometers"),unit:"kilometer"}:e>1?{distance:e,unit:"meter"}:e>.01?{distance:(0,_.oU)(e,"meters","centimeters"),unit:"centimeter"}:{distance:(0,_.oU)(e,"meters","millimeters"),unit:"millimeter"};case"imperial":case"non-metric":return e>1609.344?{distance:(0,_.oU)(e,"meters","miles"),unit:"mile"}:e>.3048?{distance:(0,_.oU)(e,"meters","feet"),unit:"foot"}:{distance:(0,_.oU)(e,"meters","inches"),unit:"inch"}}}function P(e){const{isWebMercator:t,wkt:n}=e;return t||(n?.includes("WGS_1984_Web_Mercator")??!1)}function V(e){const{wkid:t,wkt:n}=e;if(null!=t&&null!=x.A[t])return x.A.values[x.A[t]];if(null!=n){const e=n.lastIndexOf(",")+1,t=n.lastIndexOf("]]");return parseFloat(n.substring(e,t))}return 1}function C({state:{paddedViewState:e},spatialReference:t,width:n}){return t.isWrappable&&e.worldScreenWidth<n}function O(e,t){const{x:n,y:i}=e?(0,w.ci)(t,!0):t;return[n,i]}let E=class extends m.A{constructor(e){super(e),this.scaleComputedFrom=(0,a.tc)(),this.view=null}get state(){return this.view?.ready&&"2d"===this.view?.type?"ready":"disabled"}getScaleBarProperties(e,t){if("disabled"===this.state||isNaN(e)||!t||!this.view)return null;const n=this._getDistanceInMeters();return null==n?null:this._getScaleBarProps(e,n,t)}_getDistanceInMeters(){const{state:e,spatialReference:t}=this.view;if(!(0,y.fn)(t))return null;const{isGeographic:n}=t,i=P(t);if(!n&&!i)return e.extent.width*V(t);const[r,s]=this._getScaleMeasuringPoints(),o=i||n&&!(0,f.TT)(t)?A.A.WGS84:t,a=new b.A({paths:[[O(i,r),O(i,s)]],spatialReference:o}),l=(0,v.XX)(a,10);let h;try{[h]=(0,f.l1)([l],"meters")}catch{return null}return h}_getScaleMeasuringPoints(){const e=this.view,{width:t,height:n,position:i,spatialReference:r}=e;if(C(e)){const e=(0,y.Vp)(r),{valid:t}=e;return[new M.A(t[0],0,r),new M.A(t[1],0,r)]}let s=this.scaleComputedFrom.y-i[1];s>n?s=n:s<0&&(s=0);const o=(0,a.tc)(0,s),l=(0,a.tc)(t,s);return[e.toMap(o),e.toMap(l)]}_getScaleBarProps(e,t,n){const i=this.view,r=e*t/(C(i)?i.state.paddedViewState.worldScreenWidth:i.width);if(r<.001)return null;const s=T(r,n),{distance:o,unit:a}=s;let l=o,h=0;for(;l>=1;)l/=10,h++;const{min:c,max:u}=S(l),d=u/l>=l/c?c:u;return{length:e*(d/l),value:10**h*d,unit:a}}};(0,i._)([(0,l.MZ)()],E.prototype,"scaleComputedFrom",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],E.prototype,"state",null),(0,i._)([(0,l.MZ)()],E.prototype,"view",void 0),E=(0,i._)([(0,h.$)("geoscene.widgets.Scalebar.ScaleBarViewModel")],E);const Z=E;n(80568);var R=n(688),L=n(45283);function H(e,t){return(0,c.ZV)(e,{style:"unit",unit:t,unitDisplay:"short"})}const D="geoscene.widgets.ScaleBar",I=s.A.getLogger(D);let k=class extends d.A{constructor(e,t){super(e,t),this.messages=null,this.style="line",this.viewModel=new Z}initialize(){this.addHandles((0,o.wB)((()=>{const{view:e}=this;return[e?.stationary,e?.center,e?.scale,e?.zoom]}),(([e])=>{e&&this.scheduleRender()})))}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get unit(){return this._defaultUnit}set unit(e){"non-metric"===e&&(0,r.Lx)(I,"unit",{replacement:"Please use 'imperial' instead of 'non-metric'.",see:"https://doc.geoscene.cn/javascript/4.27/api-reference/geoscene-widgets-ScaleBar.html#unit",version:"4.27",warnOnce:!0}),this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e="disabled"===this.viewModel.state,t={[g.disabled]:e};let n,i;if(!e){const{unit:e,style:t}=this,r="metric"===e||"dual"===e,s=100,o="dual"===e?"line":t;if("imperial"===e||"non-metric"===e||"dual"===e){const e=this.viewModel.getScaleBarProperties(s,"imperial");e&&(i="ruler"===o?this._renderRuler(e):this._renderLine(e,"bottom"))}if(r){const e=this.viewModel.getScaleBarProperties(s,"metric");e&&(n="ruler"===o?this._renderRuler(e):this._renderLine(e,"top"))}}return(0,L.K)("div",{afterCreate:this._handleRootCreateOrUpdate,afterUpdate:this._handleRootCreateOrUpdate,bind:this,class:this.classes(g.base,t)},n,i)}_renderRuler(e){const{length:t,unit:n,value:i}=e,r=Math.round(t),s=H(i,n);return(0,L.K)("div",{class:this.classes(g.barContainer,g.rulerBarContainer),key:g.rulerBarContainer},(0,L.K)("div",{class:g.ruler,styles:{width:`${r}px`}},(0,L.K)("div",{class:g.rulerBlock}),(0,L.K)("div",{class:g.rulerBlock}),(0,L.K)("div",{class:g.rulerBlock}),(0,L.K)("div",{class:g.rulerBlock})),(0,L.K)("div",{class:this.classes(g.labelContainer,g.rulerLabelContainer)},(0,L.K)("div",{class:g.label},"0"),(0,L.K)("div",{class:g.label},s)))}_renderLine(e,t){const{length:n,unit:i,value:r}=e,s=Math.round(n),o=H(r,i),a={[g.topLabelContainer]:"top"===t,[g.bottomLabelContainer]:"bottom"===t},l=(0,L.K)("div",{class:this.classes(g.labelContainer,g.lineLabelContainer,a),key:g.labelContainer},(0,L.K)("div",{class:g.label},o)),h={[g.topLine]:"top"===t,[g.bottomLine]:"bottom"===t},c=(0,L.K)("div",{class:this.classes(g.line,h),key:g.line,styles:{width:`${s}px`}});return(0,L.K)("div",{class:this.classes(g.barContainer,g.lineBarContainer),key:g.lineBarContainer},[c,l])}_handleRootCreateOrUpdate(e){if(!this.viewModel)return;const{scaleComputedFrom:t}=this.viewModel,n=e.getBoundingClientRect(),i=n.left+window.pageXOffset,r=n.top+window.pageYOffset,s=(0,a.tc)(i,r);(s.x!==t.x||s.y!==t.y)&&(this.viewModel.scaleComputedFrom=s)}};(0,i._)([(0,l.MZ)(u.q)],k.prototype,"_defaultUnit",void 0),(0,i._)([(0,l.MZ)()],k.prototype,"label",null),(0,i._)([(0,l.MZ)(),(0,R.G)("geoscene/widgets/ScaleBar/t9n/ScaleBar")],k.prototype,"messages",void 0),(0,i._)([(0,l.MZ)({type:["ruler","line"]})],k.prototype,"style",void 0),(0,i._)([(0,l.MZ)({type:["metric","imperial","dual","non-metric"]})],k.prototype,"unit",null),(0,i._)([(0,l.MZ)()],k.prototype,"view",null),(0,i._)([(0,l.MZ)()],k.prototype,"viewModel",void 0),k=(0,i._)([(0,h.$)(D)],k);const z=k}}]);
//# sourceMappingURL=2931.0d718df6.js.map