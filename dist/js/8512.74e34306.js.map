{"version":3,"file":"js/8512.74e34306.js","mappings":"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","sources":["webpack://sun-glare-project/./node_modules/@geoscene/core/layers/support/fetchService.js","webpack://sun-glare-project/./node_modules/@geoscene/core/portal/support/jsonContext.js","webpack://sun-glare-project/./node_modules/@geoscene/core/portal/support/layersLoader.js","webpack://sun-glare-project/./node_modules/@geoscene/core/support/requestPresets.js"],"sourcesContent":["/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport{fetchArcGISServiceJSON as e}from\"../../support/requestPresets.js\";async function r(r,s){const a=await e(r,s);a.layers=a.layers.filter(t);const n={serviceJSON:a};if((a.currentVersion??0)<10.5)return n;const i=await e(r+\"/layers\",s);return n.layersJSON={layers:i.layers.filter(t),tables:i.tables},n}function t(e){return!e.type||\"Feature Layer\"===e.type}export{r as fetchFeatureService};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport{urlToObject as r}from\"../../core/urlUtils.js\";import t from\"../Portal.js\";function e(e){return{origin:\"portal-item\",url:r(e.itemUrl),portal:e.portal||t.getDefault(),portalItem:e,readResourcePaths:[]}}function o(e){return{origin:\"portal-item\",messages:[],writtenProperties:[],url:e.itemUrl?r(e.itemUrl):null,portal:e.portal||t.getDefault(),portalItem:e}}export{e as createForItemRead,o as createForItemWrite};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport e from\"../../core/Error.js\";import t from\"../../layers/Layer.js\";import{isArcGISUrl as r}from\"../../layers/support/arcgisLayerUrl.js\";import{fetchFeatureService as a}from\"../../layers/support/fetchService.js\";import n from\"../Portal.js\";import o from\"../PortalItem.js\";import{createForItemRead as l}from\"./jsonContext.js\";import{hasTypeKeyword as s}from\"./portalItemUtils.js\";import{loadStyleRenderer as i}from\"../../renderers/support/styleUtils.js\";import{fetchArcGISServiceJSON as u}from\"../../support/requestPresets.js\";async function p(e,t){const r=e.instance.portalItem;if(r&&r.id)return await r.load(t),c(e),y(e,t)}function c(t){const r=t.instance.portalItem;if(!r?.type||!t.supportedTypes.includes(r.type))throw new e(\"portal:invalid-layer-item-type\",\"Invalid layer item type '${type}', expected '${expectedType}'\",{type:r?.type,expectedType:t.supportedTypes.join(\", \")})}async function y(e,t){const r=e.instance,a=r.portalItem;if(!a)return;const{url:n,title:o}=a,s=l(a);if(\"group\"===r.type)return r.read({title:o},s),f(r,e);n&&r.read({url:n},s);const u=await h(e,t);return u&&r.read(u,s),r.resourceReferences={portalItem:a,paths:s.readResourcePaths??[]},\"subtype-group\"!==r.type&&r.read({title:o},s),i(r,s)}async function f(t,r){let a;const{portalItem:n}=t;if(!n)return;const o=n.type,l=r.layerModuleTypeMap,i=s(n,\"Oriented Imagery Layer\")??!1;switch(o){case\"Feature Service\":a=i?l.OrientedImageryLayer:l.FeatureLayer;break;case\"Stream Service\":a=l.StreamLayer;break;case\"Scene Service\":a=l.SceneLayer;break;case\"Feature Collection\":a=l.FeatureLayer;break;default:throw new e(\"portal:unsupported-item-type-as-group\",`The item type '${o}' is not supported as a 'IGroupLayer'`)}let[u,p]=await Promise.all([a(),h(r)]),c=()=>u;if(\"Feature Service\"===o){p=n.url?await w(p,n.url):{};if(j(p).length){const e=l.SubtypeGroupLayer,t=await e();c=e=>\"SubtypeGroupLayer\"===e.layerType?t:u}return b(t,c,p,await P(n.url))}return v(p)>0?b(t,c,p):d(t,c)}async function d(e,t){const{portalItem:r}=e;if(!r?.url)return;const a=await u(r.url);a&&b(e,t,{layers:a.layers?.map(m),tables:a.tables?.map(m)})}function m(e){return{id:e.id,name:e.name}}function b(e,t,r,a){let n=r.layers||[];const o=r.tables||[];if(\"Feature Collection\"===e.portalItem?.type&&(n.forEach((e=>{\"Table\"===e?.layerDefinition?.type&&o.push(e)})),n=n.filter((e=>\"Table\"!==e?.layerDefinition?.type))),\"coverage\"in r){const t=T(r);t&&e.add(t)}n.reverse().forEach((n=>{const o=a?.(n);if(o||!a){const a=g(e,t(n),r,n,o);e.add(a)}})),o.reverse().forEach((n=>{const o=a?.(n);if(o||!a){const a=g(e,t(n),r,n,o);e.tables.add(a)}}))}function g(e,t,r,a,o){const l=e.portalItem,s=new t({portalItem:l.clone(),layerId:a.id});if(\"sourceJSON\"in s&&(s.sourceJSON=o),\"subtype-group\"!==s.type&&(s.sublayerTitleMode=\"service-name\"),\"Feature Collection\"===l.type){const e={origin:\"portal-item\",portal:l.portal||n.getDefault()};s.read(a,e);const t=r.showLegend;null!=t&&s.read({showLegend:t},e)}return s}async function h(e,t){if(!1===e.supportsData)return;const r=e.instance,a=r.portalItem;if(!a)return;let n=null;try{n=await a.fetchData(\"json\",t)}catch(o){}if(S(r)){let e=null,t=!0;if(n&&v(n)>0){if(null==r.layerId){const e=j(n);r.layerId=\"subtype-group\"===r.type?e?.[0]:I(n)}e=L(n,r),e&&(1===v(n)&&(t=!1),null!=n.showLegend&&(e.showLegend=n.showLegend))}return t&&\"sublayerTitleMode\"in r&&\"service-name\"!==r.sublayerTitleMode&&(r.sublayerTitleMode=\"item-title-and-service-name\"),e}return n}async function w(e,t){if(null==e?.layers||null==e?.tables){const r=await u(t);(e=e||{}).layers=e.layers||r?.layers,e.tables=e.tables||r?.tables}return e}function I(e){const t=e.layers;if(t&&t.length)return t[0].id;const r=e.tables;return r&&r.length?r[0].id:null}function L(e,t){const{layerId:r}=t,a=e.layers?.find((e=>e.id===r))||e.tables?.find((e=>e.id===r));return a&&F(a,t)?a:null}function v(e){return(e?.layers?.length??0)+(e?.tables?.length??0)}function S(e){return\"stream\"!==e.type&&\"oriented-imagery\"!==e.type&&\"layerId\"in e}function T(a){const{coverage:n}=a;if(!n)return null;const l=new URL(n);if(n.toLowerCase().includes(\"item.html\")){const e=l.searchParams.get(\"id\"),r=l.origin;return t.fromPortalItem({portalItem:new o({id:e,url:r})})}if(r(n))return t.fromGeoSceneServerUrl({url:n});throw new e(\"portal:oriented-imagery-layer-coverage\",\"the provided coverage url couldn't be loaded as a layer\")}function j(e){const t=[];return e?.layers?.forEach((e=>{\"SubtypeGroupLayer\"===e.layerType&&t.push(e.id)})),t}function F(e,t){return!(\"feature\"===t.type&&\"layerType\"in e&&\"SubtypeGroupLayer\"===e.layerType||\"subtype-group\"===t.type&&!(\"layerType\"in e))}async function P(e){const{layersJSON:t}=await a(e);if(!t)return null;const r=[...t.layers,...t.tables];return e=>r.find((t=>t.id===e.id))}export{I as getFirstLayerOrTableId,v as getNumLayersAndTables,j as getSubtypeGroupLayerIds,p as load,w as preprocessFSItemData};","/*\r\nAll material copyright GeoScene, All Rights Reserved, unless otherwise specified.\r\nSee https://js.geoscene.cn/4.27/geoscene/copyright.txt for details.\r\n*/\r\nimport e from\"../request.js\";async function t(t,o){const{data:r}=await e(t,{responseType:\"json\",query:{f:\"json\",...o?.customParameters,token:o?.apiKey}});return r}export{t as fetchArcGISServiceJSON};"],"names":["async","r","s","a","e","layers","filter","t","n","serviceJSON","currentVersion","i","layersJSON","tables","type","origin","url","itemUrl","portal","getDefault","portalItem","readResourcePaths","o","messages","writtenProperties","p","instance","id","load","c","y","supportedTypes","includes","expectedType","join","title","l","read","f","u","h","resourceReferences","paths","layerModuleTypeMap","OrientedImageryLayer","FeatureLayer","StreamLayer","SceneLayer","Promise","all","w","j","length","SubtypeGroupLayer","layerType","b","P","v","d","map","m","name","forEach","layerDefinition","push","T","add","reverse","g","clone","layerId","sourceJSON","sublayerTitleMode","showLegend","supportsData","fetchData","S","I","L","find","F","coverage","URL","toLowerCase","searchParams","get","fromPortalItem","fromGeoSceneServerUrl","data","responseType","query","customParameters","token","apiKey"],"sourceRoot":""}