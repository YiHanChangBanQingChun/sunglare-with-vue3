"use strict";(self["webpackChunksun_glare_project"]=self["webpackChunksun_glare_project"]||[]).push([[6351,5762],{9030:function(t,e,n){n.d(e,{a:function(){return s},b:function(){return a},c:function(){return o},d:function(){return u},e:function(){return c},n:function(){return f},s:function(){return l},t:function(){return i}});var r=n(28672);function o(t,e,n){i(t.typedBuffer,e.typedBuffer,n,t.typedBufferStride,e.typedBufferStride)}function i(t,e,n,o=3,i=o){if(t.length/o!==Math.ceil(e.length/i))return r.J.error("source and destination buffers need to have the same number of elements"),t;const a=t.length/o,s=n[0],c=n[1],l=n[2],u=n[4],f=n[5],h=n[6],p=n[8],m=n[9],d=n[10],g=n[12],x=n[13],y=n[14];let _=0,A=0;for(let r=0;r<a;r++){const n=e[_],r=e[_+1],a=e[_+2];t[A]=s*n+u*r+p*a+g,t[A+1]=c*n+f*r+m*a+x,t[A+2]=l*n+h*r+d*a+y,_+=i,A+=o}return t}function a(t,e,n){s(t.typedBuffer,e.typedBuffer,n,t.typedBufferStride,e.typedBufferStride)}function s(t,e,n,o=3,i=o){if(t.length/o!==Math.ceil(e.length/i))return void r.J.error("source and destination buffers need to have the same number of elements");const a=t.length/o,s=n[0],c=n[1],l=n[2],u=n[3],f=n[4],h=n[5],p=n[6],m=n[7],d=n[8];let g=0,x=0;for(let r=0;r<a;r++){const n=e[g],r=e[g+1],a=e[g+2];t[x]=s*n+u*r+p*a,t[x+1]=c*n+f*r+m*a,t[x+2]=l*n+h*r+d*a,g+=i,x+=o}}function c(t,e,n){l(t.typedBuffer,e,n,t.typedBufferStride)}function l(t,e,n,r=3){const o=Math.min(t.length/r,e.count),i=e.typedBuffer,a=e.typedBufferStride;let s=0,c=0;for(let l=0;l<o;l++)t[c]=n*i[s],t[c+1]=n*i[s+1],t[c+2]=n*i[s+2],s+=a,c+=r}function u(t,e){f(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function f(t,e,n=3,r=n){const o=Math.min(t.length/n,e.length/r);let i=0,a=0;for(let s=0;s<o;s++){const o=e[i],s=e[i+1],c=e[i+2],l=o*o+s*s+c*c;if(l>0){const e=1/Math.sqrt(l);t[a]=e*o,t[a+1]=e*s,t[a+2]=e*c}i+=r,a+=n}}function h(t,e,n){const r=Math.min(t.count,e.count),o=t.typedBuffer,i=t.typedBufferStride,a=e.typedBuffer,s=e.typedBufferStride;let c=0,l=0;for(let u=0;u<r;u++)o[l]=a[c]>>n,o[l+1]=a[c+1]>>n,o[l+2]=a[c+2]>>n,c+=s,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:f,normalizeView:u,scale:l,scaleView:c,shiftRight:h,transformMat3:s,transformMat3View:a,transformMat4:i,transformMat4View:o},Symbol.toStringTag,{value:"Module"}))},69843:function(t,e,n){n.d(e,{w:function(){return s}});n(44114);var r=n(69292),o=n(79908),i=n(42079),a=n(10434);class s{constructor(t=9,e){this._compareMinX=f,this._compareMinY=h,this._toBBox=t=>t,this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&("function"==typeof e?this._toBBox=e:this._initFormat(e)),this.clear()}destroy(){this.clear(),A.prune(),M.prune(),v.prune(),w.prune()}all(t){this._all(this._data,t)}search(t,e){let n=this._data;const r=this._toBBox;if(y(t,n))for(A.clear();n;){for(let o=0,i=n.children.length;o<i;o++){const i=n.children[o],a=n.leaf?r(i):i;y(t,a)&&(n.leaf?e(i):x(t,a)?this._all(i,e):A.push(i))}n=A.pop()}}collides(t){let e=this._data;const n=this._toBBox;if(!y(t,e))return!1;for(A.clear();e;){for(let r=0,o=e.children.length;r<o;r++){const o=e.children[r],i=e.leaf?n(o):o;if(y(t,i)){if(e.leaf||x(t,i))return!0;A.push(o)}}e=A.pop()}return!1}load(t){if(!t.length)return this;if(t.length<this._minEntries){for(let e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}let e=this._build(t.slice(0,t.length),0,t.length-1,0);if(this._data.children.length)if(this._data.height===e.height)this._splitRoot(this._data,e);else{if(this._data.height<e.height){const t=this._data;this._data=e,e=t}this._insert(e,this._data.height-e.height-1,!0)}else this._data=e;return this}insert(t){return t&&this._insert(t,this._data.height-1),this}clear(){return this._data=new Y([]),this}remove(t){if(!t)return this;let e,n=this._data,i=null,a=0,s=!1;const c=this._toBBox(t);for(v.clear(),w.clear();n||v.length>0;){if(n||(n=(0,o.jg)(v.pop()),i=v.data[v.length-1],a=w.pop()??0,s=!0),n.leaf&&(e=(0,r.qh)(n.children,t,n.children.length,n.indexHint),-1!==e))return n.children.splice(e,1),v.push(n),this._condense(v),this;s||n.leaf||!x(n,c)?i?(a++,n=i.children[a],s=!1):n=null:(v.push(n),w.push(a),a=0,i=n,n=n.children[0])}return this}toJSON(){return this._data}fromJSON(t){return this._data=t,this}_all(t,e){let n=t;for(M.clear();n;){if(!0===n.leaf)for(const t of n.children)e(t);else M.pushArray(n.children);n=M.pop()??null}}_build(t,e,n,r){const o=n-e+1;let i=this._maxEntries;if(o<=i){const r=new Y(t.slice(e,n+1));return c(r,this._toBBox),r}r||(r=Math.ceil(Math.log(o)/Math.log(i)),i=Math.ceil(o/i**(r-1)));const a=new b([]);a.height=r;const s=Math.ceil(o/i),l=s*Math.ceil(Math.sqrt(i));_(t,e,n,l,this._compareMinX);for(let c=e;c<=n;c+=l){const e=Math.min(c+l-1,n);_(t,c,e,s,this._compareMinY);for(let n=c;n<=e;n+=s){const o=Math.min(n+s-1,e);a.children.push(this._build(t,n,o,r-1))}}return c(a,this._toBBox),a}_chooseSubtree(t,e,n,r){for(;r.push(e),!0!==e.leaf&&r.length-1!==n;){let n,r=1/0,o=1/0;for(let i=0,a=e.children.length;i<a;i++){const a=e.children[i],s=p(a),c=d(t,a)-s;c<o?(o=c,r=s<r?s:r,n=a):c===o&&s<r&&(r=s,n=a)}e=n||e.children[0]}return e}_insert(t,e,n){const r=this._toBBox,o=n?t:r(t);v.clear();const i=this._chooseSubtree(o,this._data,e,v);for(i.children.push(t),u(i,o);e>=0&&v.data[e].children.length>this._maxEntries;)this._split(v,e),e--;this._adjustParentBBoxes(o,v,e)}_split(t,e){const n=t.data[e],r=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,r);const i=this._chooseSplitIndex(n,o,r);if(!i)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const a=n.children.splice(i,n.children.length-i),s=n.leaf?new Y(a):new b(a);s.height=n.height,c(n,this._toBBox),c(s,this._toBBox),e?t.data[e-1].children.push(s):this._splitRoot(n,s)}_splitRoot(t,e){this._data=new b([t,e]),this._data.height=t.height+1,c(this._data,this._toBBox)}_chooseSplitIndex(t,e,n){let r,o,i;r=o=1/0;for(let a=e;a<=n-e;a++){const e=l(t,0,a,this._toBBox),s=l(t,a,n,this._toBBox),c=g(e,s),u=p(e)+p(s);c<r?(r=c,i=a,o=u<o?u:o):c===r&&u<o&&(o=u,i=a)}return i}_chooseSplitAxis(t,e,n){const r=t.leaf?this._compareMinX:f,o=t.leaf?this._compareMinY:h;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,o)&&t.children.sort(r)}_allDistMargin(t,e,n,r){t.children.sort(r);const o=this._toBBox,i=l(t,0,e,o),a=l(t,n-e,n,o);let s=m(i)+m(a);for(let c=e;c<n-e;c++){const e=t.children[c];u(i,t.leaf?o(e):e),s+=m(i)}for(let c=n-e-1;c>=e;c--){const e=t.children[c];u(a,t.leaf?o(e):e),s+=m(a)}return s}_adjustParentBBoxes(t,e,n){for(let r=n;r>=0;r--)u(e.data[r],t)}_condense(t){for(let e=t.length-1;e>=0;e--){const n=t.data[e];if(0===n.children.length)if(e>0){const o=t.data[e-1],i=o.children;i.splice((0,r.qh)(i,n,i.length,o.indexHint),1)}else this.clear();else c(n,this._toBBox)}}_initFormat(t){const e=["return a"," - b",";"];this._compareMinX=new Function("a","b",e.join(t[0])),this._compareMinY=new Function("a","b",e.join(t[1])),this._toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}function c(t,e){l(t,0,t.children.length,e,t)}function l(t,e,n,r,o){o||(o=new Y([])),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let i,a=e;a<n;a++)i=t.children[a],u(o,t.leaf?r(i):i);return o}function u(t,e){t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY)}function f(t,e){return t.minX-e.minX}function h(t,e){return t.minY-e.minY}function p(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function m(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function g(t,e){const n=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),o=Math.min(t.maxX,e.maxX),i=Math.min(t.maxY,e.maxY);return Math.max(0,o-n)*Math.max(0,i-r)}function x(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function y(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function _(t,e,n,r,i){const s=[e,n];for(;s.length;){const e=(0,o.jg)(s.pop()),n=(0,o.jg)(s.pop());if(e-n<=r)continue;const c=n+Math.ceil((e-n)/r/2)*r;(0,a.q)(t,c,n,e,i),s.push(n,c,c,e)}}const A=new i.A,M=new i.A,v=new i.A,w=new i.A({deallocator:void 0});class B{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class X extends B{constructor(){super(...arguments),this.height=1,this.indexHint=new r.vW}}class Y extends X{constructor(t){super(),this.children=t,this.leaf=!0}}class b extends X{constructor(t){super(),this.children=t,this.leaf=!1}}},44240:function(t,e,n){n.d(e,{lO:function(){return l}});var r=n(48585),o=n(12790),i=n(72465);const a=new o.A(r.fv),s=new o.A(r.FY),c=new o.A(r.LJ);new o.A(r.Ro);function l(t){return t&&((0,i.q8)(t)||(0,i.aI)(t,s))?s:t&&((0,i.KQ)(t)||(0,i.aI)(t,c))?c:a}},35337:function(t,e,n){n.d(e,{Ns:function(){return c},jh:function(){return o},l5:function(){return a},s:function(){return s},xm:function(){return i}});n(16573),n(78100),n(77936),n(37467),n(44732),n(79577);var r=n(48119);function o(t,e=!1){return t<=r.tt?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function i(t){return((0,r.cy)(t)?t.length:t.byteLength/8)<=r.tt?Array.from(t):new Float64Array(t)}function a(t,e,n){return Array.isArray(t)?t.slice(e,e+n):t.subarray(e,e+n)}function s(t,e){for(let n=0;n<e.length;++n)t[n]=e[n];return t}function c(t){return Array.isArray(t)?new Float64Array(t):t}},24580:function(t,e,n){n.d(e,{A:function(){return h}});var r=n(71457),o=n(67872),i=n(28920),a=n(76543),s=(n(37679),n(69292),n(51020),n(42267)),c=n(29916),l=n(456),u=n(74036);let f=class extends((0,o.O)(i.oY)){constructor(t){super(t),this.type="georeferenced-relative",this.isRelative=!0,this.isGeoreferenced=!0,this.origin=(0,l.c)()}getOriginPoint(t){const[e,n,r]=this.origin;return new u.A({x:e,y:n,z:r,spatialReference:t})}setOriginFormPoint({x:t,y:e,z:n}){this.origin=(0,l.f)(t,e,n??0)}};(0,r._)([(0,s.e)({georeferencedRelative:"georeferenced-relative"},{readOnly:!0})],f.prototype,"type",void 0),(0,r._)([(0,a.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"origin",void 0),f=(0,r._)([(0,c.$)("geoscene.geometry.support.MeshGeoreferencedRelativeVertexSpace")],f);const h=f},90700:function(t,e,n){n.d(e,{A:function(){return l}});var r=n(71457),o=n(67872),i=n(28920),a=(n(15114),n(37679),n(69292),n(51020),n(47966),n(42267)),s=n(29916);let c=class extends((0,o.O)(i.oY)){constructor(){super({}),this.type="georeferenced",this.isRelative=!1,this.isGeoreferenced=!0}};(0,r._)([(0,a.e)({georeferenced:"georeferenced"},{readOnly:!0})],c.prototype,"type",void 0),c=(0,r._)([(0,s.$)("geoscene.geometry.support.MeshGeoreferencedVertexSpace")],c);const l=c},38943:function(t,e,n){n.d(e,{A:function(){return h}});var r=n(71457),o=n(67872),i=n(28920),a=n(76543),s=(n(37679),n(69292),n(51020),n(42267)),c=n(29916),l=n(456),u=n(74036);let f=class extends((0,o.O)(i.oY)){constructor(t){super(t),this.type="local",this.isRelative=!0,this.isGeoreferenced=!1,this.origin=(0,l.c)()}getOriginPoint(t){const[e,n,r]=this.origin;return new u.A({x:e,y:n,z:r,spatialReference:t})}setOriginFormPoint({x:t,y:e,z:n}){this.origin=(0,l.f)(t,e,n??0)}};(0,r._)([(0,s.e)({local:"local"},{readOnly:!0})],f.prototype,"type",void 0),(0,r._)([(0,a.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"origin",void 0),f=(0,r._)([(0,c.$)("geoscene.geometry.support.MeshLocalVertexSpace")],f);const h=f},528:function(t,e,n){n.d(e,{A:function(){return x}});var r,o=n(71457),i=n(28920),a=n(76543),s=(n(37679),n(69292),n(51020),n(29916)),c=n(90183),l=n(26671),u=n(34350),f=n(71784),h=n(67886),p=n(456),m=n(12958);let d=r=class extends i.oY{constructor(t){super(t),this.translation=(0,p.c)(),this.rotationAxis=(0,p.g)(m.UP),this.rotationAngle=0,this.scale=(0,p.f)(1,1,1)}get rotation(){return(0,m.i4)(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=(0,p.a)((0,m.yo)(t)),this.rotationAngle=(0,m.g7)(t)}get localMatrix(){const t=(0,l.c)();return(0,u.s)(g,(0,m.yo)(this.rotation),(0,m.$I)(this.rotation)),(0,c.g)(t,g,this.translation,this.scale),t}get localMatrixInverse(){return(0,c.a)((0,l.c)(),this.localMatrix)}applyLocal(t,e){return(0,h.m)(e,t,this.localMatrix)}applyLocalInverse(t,e){return(0,h.m)(e,t,this.localMatrixInverse)}equals(t){return this===t||null!=t&&(0,c.h)(this.localMatrix,t.localMatrix)}clone(){const t={translation:(0,p.a)(this.translation),rotationAxis:(0,p.a)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,p.a)(this.scale)};return new r(t)}};(0,o._)([(0,a.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],d.prototype,"translation",void 0),(0,o._)([(0,a.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],d.prototype,"rotationAxis",void 0),(0,o._)([(0,a.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],d.prototype,"rotationAngle",void 0),(0,o._)([(0,a.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],d.prototype,"scale",void 0),(0,o._)([(0,a.MZ)()],d.prototype,"rotation",null),(0,o._)([(0,a.MZ)()],d.prototype,"localMatrix",null),(0,o._)([(0,a.MZ)()],d.prototype,"localMatrixInverse",null),d=r=(0,o._)([(0,s.$)("geoscene.geometry.support.MeshTransform")],d);const g=(0,f.a)(),x=d},12958:function(t,e,n){n.d(e,{$I:function(){return m},AU:function(){return f},UP:function(){return g},Zz:function(){return u},g7:function(){return p},i4:function(){return l},vt:function(){return c},yo:function(){return h}});var r=n(26011),o=n(34350),i=n(71784),a=n(67886),s=n(456);function c(t=g){return[t[0],t[1],t[2],t[3]]}function l(t,e,n=c()){return(0,a.c)(h(n),t),n[3]=e,n}function u(t,e,n=c()){return(0,o.s)(x,h(t),m(t)),(0,o.s)(y,h(e),m(e)),(0,o.m)(x,y,x),d(n,(0,r.KJ)((0,o.g)(h(n),x)))}function f(t,e,n,r=c()){return l(s.d,t,_),l(s.e,e,A),l(s.U,n,M),u(_,A,_),u(_,M,r),r}function h(t){return t}function p(t){return t[3]}function m(t){return(0,r.kU)(t[3])}function d(t,e){return t[3]=e,t}const g=[0,0,1,0],x=(0,i.a)(),y=(0,i.a)(),_=(c(),c()),A=c(),M=c()},28672:function(t,e,n){n.d(e,{J:function(){return o}});var r=n(15114);const o=r.A.getLogger("geoscene.views.3d.support.buffer.math")},16351:function(t,e,n){n.r(e),n.d(e,{default:function(){return a}});n(16573),n(78100),n(77936),n(37467),n(44732),n(79577);var r=n(51020),o=n(69843),i=n(55762);class a{async createIndex(t,e){const n=new Array;if(!t.vertexAttributes||!t.vertexAttributes.position)return new o.w;const r=this._createMeshData(t),i=null!=e?await e.invoke("createIndexThread",r,{transferList:n}):this.createIndexThread(r).result;return this._createPooledRBush().fromJSON(i)}createIndexThread(t){const e=new Float64Array(t.position),n=this._createPooledRBush();return t.components?this._createIndexComponentsThread(n,e,t.components.map((t=>new Uint32Array(t)))):this._createIndexAllThread(n,e)}_createIndexAllThread(t,e){const n=new Array(e.length/9);let r=0;for(let o=0;o<e.length;o+=9)n[r++]=s(e,o,o+3,o+6);return t.load(n),{result:t.toJSON()}}_createIndexComponentsThread(t,e,n){let r=0;for(const a of n)r+=a.length/3;const o=new Array(r);let i=0;for(const a of n)for(let t=0;t<a.length;t+=3)o[i++]=s(e,3*a[t],3*a[t+1],3*a[t+2]);return t.load(o),{result:t.toJSON()}}_createMeshData(t){const e=(t.vertexSpace.isRelative?(0,i.bA)({position:t.vertexAttributes.position,normal:null,tangent:null},t.vertexSpace,t.transform,t.spatialReference).position:t.vertexAttributes.position).buffer;return!t.components||t.components.some((t=>!t.faces))?{position:e}:{position:e,components:t.components.map((t=>t.faces))}}_createPooledRBush(){return new o.w(9,(0,r.A)("geoscene-csp-restrictions")?t=>t:[".minX",".minY",".maxX",".maxY"])}}function s(t,e,n,r){return{minX:Math.min(t[e],t[n],t[r]),maxX:Math.max(t[e],t[n],t[r]),minY:Math.min(t[e+1],t[n+1],t[r+1]),maxY:Math.max(t[e+1],t[n+1],t[r+1]),p0:[t[e],t[e+1],t[e+2]],p1:[t[n],t[n+1],t[n+2]],p2:[t[r],t[r+1],t[r+2]]}}},29174:function(t,e,n){n.d(e,{D:function(){return o},O:function(){return i}});var r=n(15114);function o(t,e){return t.isGeographic||t.isWebMercator&&(e?.geographic??!0)}function i(t,e,n){const o=!t.isGeoreferenced;null!=n?.geographic&&n.geographic!==o&&r.A.getLogger(e).warnOnce(`Specifying the 'geographic' parameter (${n.geographic}) for a Mesh vertex space of type "${t.type}" is not supported. This parameter will be ignored.`)}},55762:function(t,e,n){n.d(e,{$y:function(){return A},YL:function(){return w},bA:function(){return M},h7:function(){return B},project:function(){return X},qD:function(){return v}});n(16573),n(78100),n(77936),n(37467),n(44732),n(79577);var r=n(79075),o=n(37072),i=n(90183),a=n(26671),s=n(67886),c=n(456),l=n(13030),u=n(39582),f=n(44240),h=n(35337),p=n(24580),m=n(90700),d=n(38943),g=n(528),x=n(9030),y=n(29174),_=n(25977);function A(t,e,n){return(0,y.D)(e.spatialReference,n)?b(t,e,n):Y(t,e,n)}function M(t,e,n,r){const{position:o,normal:i,tangent:s}=t;if(!e.isRelative)return{position:o,normal:i,tangent:s};const c=n?.localMatrix??a.I;return A({position:(0,x.t)(new Float64Array(o.length),o,c),normal:null!=i?(0,_.qs)(i,new Float32Array(i.length),c):null,tangent:null!=s?(0,_.KM)(s,new Float32Array(s.length),c):null},e.getOriginPoint(r),{geographic:!e.isGeoreferenced})}function v(t,e,n){if(n?.useTransform){const{position:r,normal:o,tangent:i}=t,{x:a,y:s,z:l}=e,u=(0,c.f)(a,s,l??0);return{vertexAttributes:{position:r,normal:o,tangent:i},vertexSpace:n.geographic??1?new d.A({origin:u}):new p.A({origin:u}),transform:new g.A}}return{vertexAttributes:A(t,e,n),vertexSpace:new m.A,transform:null}}function w(t,e,n){return(0,y.D)(e.spatialReference,n)?S(t,e,n):O(t,e,n)}function B(t,e,n,r,o){if(!e.isRelative)return w(t,r,o);const{spatialReference:i}=r,a=M(t,e,n,i);return r.equals(e.getOriginPoint(i))?O(a,r,o):w(a,r,o)}function X({positions:t,transform:e,vertexSpace:n,inSpatialReference:r,outSpatialReference:o,outPositions:l,local:p}){const m=n.isRelative?n.origin:c.Z,d=n.isRelative?e?.localMatrix??a.I:a.I;if(n.isGeoreferenced){const e=l??(0,h.jh)(t.length);if((0,i.j)(d,a.I)?(0,h.s)(e,t):(0,x.t)(e,t,d),!(0,s.k)(m,c.Z)){const[t,n,r]=m;for(let o=0;o<e.length;o+=3)e[o]+=t,e[o+1]+=n,e[o+2]+=r}return(0,u.projectBuffer)(e,r,0,e,o,0,e.length/3),e}const g=(0,f.lO)(r),y=!p&&(0,u._q)(r,g)?g:r;(0,u.l)(r,m,E,y),(0,i.m)(E,E,d);const _=l??(0,h.jh)(t.length);return(0,x.t)(_,t,E),(0,u.projectBuffer)(_,y,0,_,o,0,_.length/3),_}function Y(t,e,n){const r=new Float64Array(t.position.length),o=t.position,i=e.x,a=e.y,s=e.z??0,c=N(n?n.unit:null,e.spatialReference);for(let l=0;l<o.length;l+=3)r[l]=o[l]*c+i,r[l+1]=o[l+1]*c+a,r[l+2]=o[l+2]*c+s;return{position:r,normal:t.normal,tangent:t.tangent}}function b(t,e,n){const r=e.spatialReference,o=T(e,n,E),i=new Float64Array(t.position.length),a=P(t.position,o,r,i),s=(0,l.b)(V,o);return{position:a,normal:F(a,i,t.normal,s,r),tangent:R(a,i,t.tangent,s,r)}}function P(t,e,n,r){(0,x.t)(r,t,e);const o=new Float64Array(t.length);return(0,_.$5)(r,o,n)}function F(t,e,n,r,o){if(null==n)return null;const i=new Float32Array(n.length);return(0,x.a)(i,n,r),(0,_.si)(i,t,e,o,i),i}function R(t,e,n,r,o){if(null==n)return null;const i=new Float32Array(n.length);(0,x.a)(i,n,r,4);for(let a=3;a<i.length;a+=4)i[a]=n[a];return(0,_.Mv)(i,t,e,o,i),i}function O(t,e,n){const r=new Float64Array(t.position.length),o=t.position,i=e.x,a=e.y,s=e.z??0,c=N(n?n.unit:null,e.spatialReference);for(let l=0;l<o.length;l+=3)r[l]=(o[l]-i)/c,r[l+1]=(o[l+1]-a)/c,r[l+2]=(o[l+2]-s)/c;return{position:r,normal:t.normal,tangent:t.tangent}}function S(t,e,n){const r=e.spatialReference;T(e,n,E);const o=(0,i.a)(q,E),a=new Float64Array(t.position.length),s=j(t.position,r,o,a),c=(0,l.b)(V,o);return{position:s,normal:C(t.normal,t.position,a,r,c),tangent:I(t.tangent,t.position,a,r,c)}}function T(t,e,n){(0,u.l)(t.spatialReference,[t.x,t.y,t.z??0],n,(0,f.lO)(t.spatialReference));const r=N(e?e.unit:null,t.spatialReference);return(0,i.k)(n,n,[r,r,r]),n}function j(t,e,n,r){const o=(0,_.gr)(t,e,r),i=new Float64Array(o.length);return(0,x.t)(i,o,n),i}function C(t,e,n,r,o){if(null==t)return null;const i=(0,_.X4)(t,e,n,r,new Float32Array(t.length));return(0,x.a)(i,i,o),i}function I(t,e,n,r,o){if(null==t)return null;const i=(0,_.xA)(t,e,n,r,new Float32Array(t.length));return(0,x.a)(i,i,o,4),i}function N(t,e){if(null==t)return 1;const n=(0,r.KX)(e);return 1/(0,r.oU)(n,"meters",t)}const E=(0,a.c)(),q=(0,a.c)(),V=(0,o.c)()},25977:function(t,e,n){n.d(e,{$5:function(){return _},KM:function(){return M},Mv:function(){return w},X4:function(){return g},gr:function(){return y},qs:function(){return A},si:function(){return x},xA:function(){return v}});n(16573),n(78100),n(77936),n(37467),n(44732),n(79577);var r=n(15114),o=n(13030),i=n(37072),a=n(26671),s=n(67886),c=n(456),l=n(39582),u=n(44240),f=n(72465),h=n(30075),p=n(44050),m=n(9030);const d=r.A.getLogger("geoscene.geometry.support.meshUtils.normalProjection");function g(t,e,n,r,o){return X(r)?(B(P.TO_PCPF,p.xs.fromTypedArray(t),p.Xm.fromTypedArray(e),p.Xm.fromTypedArray(n),r,p.xs.fromTypedArray(o)),o):(d.error("Cannot convert spatial reference to PCPF"),o)}function x(t,e,n,r,o){return X(r)?(B(P.FROM_PCPF,p.xs.fromTypedArray(t),p.Xm.fromTypedArray(e),p.Xm.fromTypedArray(n),r,p.xs.fromTypedArray(o)),o):(d.error("Cannot convert to spatial reference from PCPF"),o)}function y(t,e,n){return(0,l.projectBuffer)(t,e,0,n,(0,u.lO)(e),0,t.length/3),n}function _(t,e,n){return(0,l.projectBuffer)(t,(0,u.lO)(n),0,e,n,0,t.length/3),e}function A(t,e,n){return(0,o.b)(S,n),(0,m.a)(e,t,S),(0,o.i)(S)||(0,m.n)(e,e),e}function M(t,e,n){if((0,o.b)(S,n),(0,m.a)(e,t,S,4),(0,o.i)(S)||(0,m.n)(e,e,4),t!==e)for(let r=3;r<t.length;r+=4)e[r]=t[r];return e}function v(t,e,n,r,o){if(!X(r))return d.error("Cannot convert spatial reference to PCPF"),o;B(P.TO_PCPF,p.xs.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),p.Xm.fromTypedArray(e),p.Xm.fromTypedArray(n),r,p.xs.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT));for(let i=3;i<t.length;i+=4)o[i]=t[i];return o}function w(t,e,n,r,o){if(!X(r))return d.error("Cannot convert to spatial reference from PCPF"),o;B(P.FROM_PCPF,p.xs.fromTypedArray(t,16),p.Xm.fromTypedArray(e),p.Xm.fromTypedArray(n),r,p.xs.fromTypedArray(o,16));for(let i=3;i<t.length;i+=4)o[i]=t[i];return o}function B(t,e,n,r,i,a){if(!e)return;const c=n.count,f=(0,u.lO)(i);if(Y(i))for(let u=0;u<c;u++)r.getVec(u,F),e.getVec(u,R),(0,l.l)(f,F,O,f),(0,o.f)(S,O),t===P.FROM_PCPF&&(0,o.t)(S,S),(0,s.t)(R,R,S),a.setVec(u,R);else for(let u=0;u<c;u++){r.getVec(u,F),e.getVec(u,R),(0,l.l)(f,F,O,f),(0,o.f)(S,O);const i=(0,h.jg)(n.get(u,1));let c=Math.cos(i);t===P.TO_PCPF&&(c=1/c),S[0]*=c,S[1]*=c,S[2]*=c,S[3]*=c,S[4]*=c,S[5]*=c,t===P.FROM_PCPF&&(0,o.t)(S,S),(0,s.t)(R,R,S),(0,s.n)(R,R),a.setVec(u,R)}return a}function X(t){return Y(t)||b(t)}function Y(t){return t.isWGS84||(0,f.x1)(t)||(0,f.q8)(t)||(0,f.KQ)(t)}function b(t){return t.isWebMercator}var P;!function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"}(P||(P={}));const F=(0,c.c)(),R=(0,c.c)(),O=(0,a.c)(),S=(0,i.c)()}}]);
//# sourceMappingURL=6351.0a0b3e14.js.map