"use strict";(self["webpackChunksun_glare_project"]=self["webpackChunksun_glare_project"]||[]).push([[527],{10527:function(e,t,n){n.r(t),n.d(t,{default:function(){return g}});var r=n(49067),s=n(47966),i=n(15114),a=n(71120),u=n(72465),o=n(41312),c=n(29153),l=n(33292),h=n(86121),y=n(95477),p=n(59316),d=n(66607),f=n(27678);class g{constructor(){this._queryEngine=null,this._customParameters=null,this._snapshotFeatures=async e=>{const{objectIdField:t}=this._queryEngine,n=await(0,d.x$)(this._getFeatureUrl??"",this._featureType.typeName,this._getFeatureOutputFormat,{customParameters:this._customParameters,dateFields:this._queryEngine.fieldsIndex.dateFields.map((e=>e.name)),signal:e});await(0,y.sO)(n),(0,a.Te)(e);const r=(0,y.bd)(n,{geometryType:this._queryEngine.geometryType,hasZ:!1,objectIdField:t});if(!(0,u.aI)(this._queryEngine.spatialReference,u.w5))for(const i of r)null!=i.geometry&&(i.geometry=(0,o.Ux)((0,l.Cv)((0,o.zv)(i.geometry,this._queryEngine.geometryType,!1,!1),u.w5,this._queryEngine.spatialReference)));let s=1;for(const i of r){const e={};(0,p.MB)(this._fieldsIndex,e,i.attributes,!0),i.attributes=e,null==i.attributes[t]&&(i.objectId=i.attributes[t]=s++)}return r}}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}async load(e,t){const{getFeatureUrl:n,getFeatureOutputFormat:r,spatialReference:s,fields:i,geometryType:u,featureType:o,objectIdField:l,customParameters:y}=e;this._featureType=o,this._customParameters=y,this._getFeatureUrl=n,this._getFeatureOutputFormat=r,this._fieldsIndex=new f.A(i),await this._checkProjection(s),(0,a.Te)(t),this._queryEngine=new h.d({fields:i,geometryType:u,hasM:!1,hasZ:!1,objectIdField:l,spatialReference:s,timeInfo:null,featureStore:new c.A({geometryType:u,hasM:!1,hasZ:!1})});const p=await this._snapshotFeatures(t.signal);return this._queryEngine.featureStore.addMany(p),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new s.A("wfs-source:editing-not-supported","applyEdits() is not supported on WFSLayer")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(e){return this._customParameters=e,this._snapshotTask?.abort(),this._snapshotTask=(0,r.UT)(this._snapshotFeatures),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(e=>{this._queryEngine.featureStore.clear(),(0,a.zf)(e)||i.A.getLogger("geoscene.layers.WFSLayer").error(new s.A("wfs-layer:getfeature-error","An error occurred during the GetFeature request",{error:e}))})),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _checkProjection(e){try{await(0,l.Nk)(u.w5,e)}catch{throw new s.A("unsupported-projection","Projection not supported",{spatialReference:e})}}}},59316:function(e,t,n){n.d(t,{$1:function(){return g},CR:function(){return d},MB:function(){return h},Yx:function(){return u},bP:function(){return c}});n(44114),n(17642),n(58004),n(33853),n(45876),n(32475),n(15024),n(31698);var r=n(72465),s=n(30104);class i{constructor(){this.code=null,this.description=null}}class a{constructor(e){this.error=new i,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e}}function u(e){return new a(e)}class o{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}function c(e){return new o(e)}const l=new Set;function h(e,t,n,r=!1,i){l.clear();for(const a in n){const o=e.get(a);if(!o)continue;const c=n[a],h=y(o,c);if(h!==c&&i&&i.push({name:"invalid-value-type",message:"attribute value was converted to match the field type",details:{field:o,originalValue:c,sanitizedValue:h}}),l.add(o.name),o&&(r||o.editable)){const e=(0,s.CJ)(o,h);if(e)return u((0,s.uo)(e,o,h));t[o.name]=h}}for(const s of e?.requiredFields??[])if(!l.has(s.name))return u(`missing required field "${s.name}"`);return null}function y(e,t){let n=t;return"string"==typeof t&&(0,s.WA)(e)?n=parseFloat(t):null!=t&&(0,s.yM)(e)&&"string"!=typeof t&&(n=String(t)),(0,s.WX)(n)}let p;function d(e,t){if(!e||!(0,r.fn)(t))return e;if("rings"in e||"paths"in e){if(null==p)throw new TypeError("geometry engine not loaded");return p.simplify(t,e)}return e}async function f(){return null==p&&(p=await n.e(8675).then(n.bind(n,68675))),p}async function g(e,t){!(0,r.fn)(e)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t||await f()}}}]);
//# sourceMappingURL=527.b43dc4fd.js.map